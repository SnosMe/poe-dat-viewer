var it=Object.defineProperty,rt=Object.defineProperties;var dt=Object.getOwnPropertyDescriptors;var $e=Object.getOwnPropertySymbols;var ut=Object.prototype.hasOwnProperty,ct=Object.prototype.propertyIsEnumerable;var Se=(e,t,n)=>t in e?it(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,le=(e,t)=>{for(var n in t||(t={}))ut.call(t,n)&&Se(e,n,t[n]);if($e)for(var n of $e(t))ct.call(t,n)&&Se(e,n,t[n]);return e},oe=(e,t)=>rt(e,dt(t));import{r as xe,w as ft,t as ye,s as _,o as ht,b as ve,a as ae,p as Z,d as pt,c as M,e as U,f as ke,g as yt,h as Te,i as ie,j as Ce,k as h,l as Me,m as N,n as v,q as vt,u as p,v as m,x as S,y as d,z as b,A as B,B as gt,C as mt,D as w,E as ge,F as ze,G as $,H as E,I as C,J as bt,K as W,L as re,M as wt,N as Ie,O as _t,P as D,Q as O,R as $t,S as St,T as xt,U as kt,V as Tt}from"./vendor.afc9997f.js";const Ct=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&l(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function l(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}};Ct();const Mt="Bundles2",L=xe({totalSize:0,received:0,active:!1,bundleName:""});async function me(e,t){if(e==null&&(e=localStorage.getItem("POE_PATCH_VER"),!e))throw new Error("never");try{return await zt(e,t)}catch(n){throw window.alert("You may need to adjust the patch version."),n}}async function zt(e,t){const n=`${e}/${Mt}/${t}`;let l=await caches.open("bundles"),o=await l.match(n);if(!o){if(L.totalSize=0,L.received=0,L.active=!0,L.bundleName=t,o=await fetch(`https://poe-bundles.snos.workers.dev/${n}`),o.status!==200)throw L.active=!1,new Error(`patchcdn: ${o.status} ${o.statusText}`);L.totalSize=Number(o.headers.get("content-length"));let a;try{const s=o.body.getReader(),r=[];for(;;){const{done:i,value:u}=await s.read();if(i)break;r.push(u),L.received+=u.length}a=new Uint8Array(L.received);let c=0;for(const i of r)a.set(i,c),c+=i.length}finally{L.active=!1}return localStorage.getItem("POE_PATCH_VER")!==e&&(await caches.delete("bundles"),l=await caches.open("bundles")),await l.put(n,new Response(a,{headers:{"content-length":String(a.byteLength),"content-type":"application/octet-stream"}})),a.buffer}return await o.arrayBuffer()}function It(){return new Worker("/poe-dat-viewer/assets/script.aed4df77.js",{type:"module"})}const de=ft(new It);async function Ee(e){return await de.decompressSliceInBundle(ye(e,[e]))}async function Pe(e,t,n){return await de.decompressSliceInBundle(ye(e,[e]),t,n)}async function Re(e,t){return await de.analyzeDatFile(ye(e,(t==null?void 0:t.transfer)?[e.dataFixed.buffer]:[]))}async function Et(e,t,n){return await de.getBatchFileInfo(e,t,n)}const ue=_([]),be=ht("poe-dat-viewer",3,{upgrade(e){e.createObjectStore("dat-schemas",{keyPath:"name"})}});async function Le(e){const t=await(await be).get("dat-schemas",e);return(t==null?void 0:t.headers)||Ht(e)||[]}async function Pt(e,t){await(await be).put("dat-schemas",{name:e,headers:Lt(t)})}async function Rt(e){await(await be).delete("dat-schemas",e)}function Lt(e){return e.map(t=>oe(le({},t),{length:t.type.string||t.type.array||t.type.key||t.type.boolean||t.type.decimal||t.type.integer?void 0:t.length}))}function Ht(e){const t=ue.value.find(n=>n.name===e);return t?t.columns.map(n=>{var l,o;return{name:n.name||"",type:{array:n.array,byteView:n.type==="array"?{array:!0}:void 0,integer:n.type==="u8"?{unsigned:!0,size:1}:n.type==="u16"?{unsigned:!0,size:2}:n.type==="u32"?{unsigned:!0,size:4}:n.type==="u64"?{unsigned:!0,size:8}:n.type==="i8"?{unsigned:!1,size:1}:n.type==="i16"?{unsigned:!1,size:2}:n.type==="i32"?{unsigned:!1,size:4}:n.type==="i64"?{unsigned:!1,size:8}:void 0,decimal:n.type==="f32"?{size:4}:n.type==="f64"?{size:8}:void 0,string:n.type==="string"?{}:void 0,boolean:n.type==="bool"?{}:void 0,key:n.type==="row"||n.type==="foreignrow"?{foreign:n.type==="foreignrow",table:(o=(l=n.references)==null?void 0:l.table)!=null?o:null}:void 0},textLength:4*3-1}}):null}const k=_(null);async function Dt(e){const t=ve.getFileInfo(e,k.value.bundlesInfo,k.value.filesInfo),n=await me(null,t.bundle),{slice:l}=await Pe(n.slice(0),t.offset,t.size);return l}async function Ot(e){const{slice:t}=await Ee(e),n=ve.readIndexBundle(t),{slice:l}=await Ee(n.pathRepsBundle.slice().buffer);k.value={bundlesInfo:n.bundlesInfo,filesInfo:n.filesInfo,dirsInfo:n.dirsInfo,pathReps:l,tableStats:ae([])}}async function Vt(e){const t=ve.getDirContent("Data",k.value.pathReps,k.value.dirsInfo).files.filter(o=>o.endsWith(".dat64"));e.value=t.length;const l=(await Et(t,k.value.bundlesInfo,k.value.filesInfo)).reduce((o,a,s)=>{const r=o.find(i=>i.name===a.bundle),c=t[s];return r?r.files.push({fullPath:c,location:a}):o.push({name:a.bundle,files:[{fullPath:t[s],location:a}]}),o},[]);for(const o of l){let a=await me(null,o.name);for(const{fullPath:s,location:r}of o.files){const c=await Pe(a,r.offset,r.size);a=c.bundle;const i=Z.readDatFile(s,c.slice),u=await Re(i,{transfer:!0}),f=s.replace("Data/","").replace(".dat64",""),y=await Le(f);let g=!0,T=!1;{let R=0;for(const q of y){if(q.name==null){g=!1;break}const K=Z.getHeaderLength(q,i);if(!pt.validateHeader(oe(le({},q),{offset:R}),u)){g=!1;break}R+=K}T=R<i.rowLength}k.value.tableStats.push({name:f,totalRows:i.rowCount,headersValid:g,increasedRowLength:T})}}}var z=(e,t)=>{for(const[n,l]of t)e[n]=l;return e};const Bt=M({props:{tag:{type:String,default:"div"}},emits:["resize"],setup(e,t){const n=U(null);return ke(()=>{const l=new ResizeObserver(o=>{t.emit("resize",{width:o[0].contentRect.width,height:o[0].contentRect.height})});l.observe(n.value),yt(()=>{l.unobserve(n.value)})}),{rootEl:n}}});function Ft(e,t,n,l,o,a){return h(),Te(Ce(e.tag),{ref:"rootEl","data-role":"resize-observer"},{default:ie(()=>[Me(e.$slots,"default")]),_:3},512)}var He=z(Bt,[["render",Ft]]);const At="_scrollable_66dfd_2",Nt="_track_66dfd_8",Wt="_y_66dfd_11",Yt="_x_66dfd_12",jt="_thumb_66dfd_15";var Gt={scrollable:At,track:Nt,y:Wt,x:Yt,thumb:jt};const Ut=40,De=15,Xt=100,Oe=(e,t)=>Math.max(1,Math.pow(e*(3/1e3)*t,2))*Math.sign(e);function Ve(e,t,n,l,o){var i;if(n<=t)return null;const a=Math.max(0,t-((i=l==null?void 0:l.fixedSize)!=null?i:0)),s=Math.max(Ut,Math.floor(t*a/n)),r=(a-s)/(n-t),c=Math.round(o*r);return{trackSize:a,thumbSize:s,fixedSize:e,thumbRatio:r,thumbPos:c}}function qt(e){let t=0,n=0,l=0,o=0,a=null,s=0,r=0;function c(y){y.button===1&&(y.preventDefault(),y.stopPropagation(),document.body.style.cursor="all-scroll",a=null,t=y.clientY,n=y.clientX,l=0,o=0,s=0,r=requestAnimationFrame(f),document.addEventListener("mousemove",u),document.addEventListener("mouseup",i),document.addEventListener("mouseleave",i))}function i(){cancelAnimationFrame(r),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",i),document.removeEventListener("mouseleave",i),document.body.style.removeProperty("cursor")}function u(y){const g=y.clientY-t,T=y.clientX-n;if(a===null)if(Math.abs(g)>De)a="vertical",document.body.style.cursor="ns-resize";else if(Math.abs(T)>De)a="horizontal",document.body.style.cursor="ew-resize";else return;a==="vertical"?l=g:o=T}function f(y){const g=y-(s||y);s=y,r=requestAnimationFrame(f),e(Oe(o,g),Oe(l,g))}return{handleMousedown:c}}function Kt(e){function t(n){e(0,Math.sign(n.deltaY)*Xt)}return{handleMousewheel:t}}function Be(e,t,n){let l=0,o=0;const a=t==="y"?"y":"x",s=t==="y"?"clientY":"clientX";function r(u){u.preventDefault(),u.stopPropagation();const f=u.currentTarget;if(l=f.getBoundingClientRect()[a],u.target!==f){const y=u.target;o=u[s]-y.getBoundingClientRect()[a]}else o=e.value.thumbSize/2,c(u),o=u[s]-l-e.value.thumbPos;document.addEventListener("mousemove",c),document.addEventListener("mouseup",i),document.addEventListener("mouseleave",i)}function c(u){const f=(u[s]-l-o)/e.value.thumbRatio;t==="x"?n(f,void 0):n(void 0,f)}function i(){document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",i),document.removeEventListener("mouseleave",i)}return{handleTrackMousedown:r}}const Jt=M({props:{paintSize:{type:Object,required:!0},fullSize:{type:Object,required:!0},widthY:{type:Number,default:14},widthX:{type:Number,default:12}},emits:["scroll"],setup(e,t){const n=ae({y:0,x:0});N(()=>[e.paintSize,e.fullSize],()=>{const{paintSize:r,fullSize:c}=e;n.x=Math.max(0,Math.min(n.x,c.width-r.width)),n.y=Math.max(0,Math.min(n.y,c.height-r.height))},{deep:!0}),N(n,()=>{t.emit("scroll",{y:n.y,x:n.x})});const l=v(()=>Ve(e.widthY,e.paintSize.height,e.fullSize.height,null,n.y)),o=v(()=>Ve(e.widthX,e.paintSize.width,e.fullSize.width,l.value,n.x));function a(r,c){const{paintSize:i,fullSize:u}=e;n.y=Math.max(0,Math.min(n.y+Math.floor(c),u.height-i.height)),n.x=Math.max(0,Math.min(n.x+Math.floor(r),u.width-i.width))}function s(r,c){const{paintSize:i,fullSize:u}=e;r!==void 0&&(n.x=Math.max(0,Math.min(Math.floor(r),u.width-i.width))),c!==void 0&&(n.y=Math.max(0,Math.min(Math.floor(c),u.height-i.height)))}return{scrollbarY:l,scrollbarX:o,scrollPos:vt(n),scrollTo:s,scrollByDelta:a,handleMousedown:qt(a).handleMousedown,handleMousewheel:Kt(a).handleMousewheel,handleTrackMousedownY:Be(l,"y",s).handleTrackMousedown,handleTrackMousedownX:Be(o,"x",s).handleTrackMousedown}}});function Zt(e,t,n,l,o,a){return h(),p("div",{class:m(e.$style.scrollable),style:S({width:e.paintSize.width+"px",height:e.paintSize.height+"px"}),onMousedown:t[2]||(t[2]=(...s)=>e.handleMousedown&&e.handleMousedown(...s)),onWheel:t[3]||(t[3]=(...s)=>e.handleMousewheel&&e.handleMousewheel(...s))},[Me(e.$slots,"default"),e.scrollbarY?(h(),p("div",{key:0,class:m(`${e.$style.track} ${e.$style.y}`),onMousedown:t[0]||(t[0]=(...s)=>e.handleTrackMousedownY&&e.handleTrackMousedownY(...s)),style:S({width:e.scrollbarY.fixedSize+"px",height:e.scrollbarY.trackSize+"px"})},[d("div",{class:m(e.$style.thumb),style:S({transform:`translate(0, ${e.scrollbarY.thumbPos}px)`,width:e.scrollbarY.fixedSize+"px",height:e.scrollbarY.thumbSize+"px"})},null,6)],38)):b("",!0),e.scrollbarX?(h(),p("div",{key:1,class:m(`${e.$style.track} ${e.$style.x}`),onMousedown:t[1]||(t[1]=(...s)=>e.handleTrackMousedownX&&e.handleTrackMousedownX(...s)),style:S({width:e.scrollbarX.trackSize+"px",height:e.scrollbarX.fixedSize+"px"})},[d("div",{class:m(e.$style.thumb),style:S({transform:`translate(${e.scrollbarX.thumbPos}px, 0)`,width:e.scrollbarX.thumbSize+"px",height:e.scrollbarX.fixedSize+"px"})},null,6)],38)):b("",!0)],38)}const Fe={};Fe.$style=Gt;var Ae=z(Jt,[["render",Zt],["__cssModules",Fe]]);function Qt(e,t){for(let n=e.offset;n<e.offset+e.length;++n)t[n]=!0}function Ne(e,t,n,l){const o=Math.min(t,n),a=Math.max(t,n);l=l.filter(s=>s.type.byteView&&!s.type.byteView.array);for(let s=o;s<=a;++s)l.some(r=>s>=r.offset&&s<r.offset+r.length)&&(e[s]=!e[s])}function We(e){e.fill(!1)}function Ye(e){const t=[];let n=e.indexOf(!0),l;if(n<0)return t;for(l=n,t.push([l]),n+=1;n<e.length;++n)if(e[n]){const o=n;o-l==1?t[t.length-1].push(o):t.push([o]),l=o}return t}const Y=()=>({byteView:{array:!1}});function en(e,t){for(let n=0;n<t.length;){const l=t[n];l.name!=null&&e.some(o=>o>=l.offset&&o<l.offset+l.length)?Ge(l,t):n+=1}}function je(e,t){const n=Ye(e);if(n.length===0)throw new Error("No bytes selected");if(n.length>1)throw new Error("Cannot create header from non-contiguous selection");const l=n[0];en(l,t);const o=t.find(r=>l[0]>=r.offset&&l[0]+l.length<=r.offset+r.length);let a=[{name:null,offset:o.offset,length:l[0]-o.offset,type:Y()},{name:"",offset:l[0],length:l.length,type:Y(),textLength:4*3-1},{name:null,offset:l[0]+l.length,length:o.length-(l[0]-o.offset+l.length),type:Y()}];const s=a[1];return a=a.filter(r=>r.length),t.splice(t.indexOf(o),1,...a),s}function Ge(e,t){if(e.name==null)throw new Error("Cannot remove empty header");e.name=null,e.type=Y();for(let n=0;n<t.length-1;){const l=tn(t[n],t[n+1]);l?t.splice(n,2,l):n+=1}}function tn(e,t){return e.name===null&&t.name===null?{name:null,offset:e.offset,length:e.length+t.length,type:Y()}:null}function nn(e,t){const n=Z.readDatFile(e,t),l={headers:_(n.rowLength?[{name:null,offset:0,length:n.rowLength,type:Y()}]:[]),datFile:n,name:on(e),columnStats:_([]),columnSelection:_(new Array(n.rowLength).fill(!1)),editHeader:_(null),selectedRow:_(null),rowSorting:_(null),scrollPos:ae({x:0,y:0})};return Re(l.datFile).then(async o=>{l.columnStats.value=o,await Ue(l)}),l}async function Ue(e){e.editHeader.value=null,e.headers.value=e.datFile.rowLength?[{name:null,offset:0,length:e.datFile.rowLength,type:Y()}]:[];const t=await Le(e.name);try{sn(t,e)}catch(n){window.alert(`WARN: ${n.message}`)}finally{B(e.headers)}}function sn(e,t){let n=0;for(const l of e){const o=l.length||gt(l,t.datFile);if(l.name==null){n+=o;continue}const a=oe(le({},l),{length:o,offset:n});if(!(l.length?t.datFile.rowLength-a.offset>=a.length:mt(a,t.columnStats.value)))throw new Error("The schema is invalid.");Qt(a,t.columnSelection.value);const r=je(t.columnSelection.value,t.headers.value);Object.assign(r,a),We(t.columnSelection.value),n+=o}}function ln(e,t){const n=e.filter(({type:l})=>l.boolean||l.decimal||l.integer||l.key||l.string).map((l,o)=>({name:l.name||`Unknown${o+1}`,data:(()=>{var s;const a=Z.readColumn(l,t);return((s=l.type.key)==null?void 0:s.foreign)?l.type.array?a.map(c=>c.map(i=>i.rid)):a.map(c=>c==null?void 0:c.rid):a})()}));return n.unshift({name:"_rid",data:Array(t.rowCount).fill(void 0).map((l,o)=>o)}),Array(t.rowCount).fill(void 0).map((l,o)=>Object.fromEntries(n.map(a=>[a.name,a.data[o]])))}function on(e){return e.match(/[^/]+(?=\..+$)/)[0]}async function ce(e){await Pt(e.name,e.headers.value)}async function an(e){await Rt(e.name)}const rn=M({props:{args:{type:Object,required:!0}},setup(e){return{text:v(()=>{var o,a,s,r,c,i,u;const{name:t,headers:n}=e.args;let l="";for(const f of n){if(f.name==null)break;let y="";if(f.type.boolean?y="bool":f.type.string?y="string":((o=f.type.integer)==null?void 0:o.size)===1?y=f.type.integer.unsigned?"u8":"i8":((a=f.type.integer)==null?void 0:a.size)===2?y=f.type.integer.unsigned?"u16":"i16":((s=f.type.integer)==null?void 0:s.size)===4?y=f.type.integer.unsigned?"u32":"i32":((r=f.type.integer)==null?void 0:r.size)===8?y=f.type.integer.unsigned?"u64":"i64":((c=f.type.decimal)==null?void 0:c.size)===4?y="f32":((i=f.type.decimal)==null?void 0:i.size)===8?y="f64":f.type.key&&(y=f.type.key.foreign?(u=f.type.key.table)!=null?u:"rid":t),f.type.array)l+=`  ${f.name||"_"}: [${y||"_"}]
`;else if(y)l+=`  ${f.name||"_"}: ${y}
`;else break}return`type ${t} {
${l}}
`})}}}),dn={class:"p-4 overflow-auto border-l flex-1 text-base"};function un(e,t,n,l,o,a){return h(),p("div",dn,[d("pre",null,w(e.text),1)])}var cn=z(rn,[["render",un]]);const fn="_bar_5acw6_2";var hn={bar:fn};const pn=M({setup(){const e=ge("viewer"),t=v(()=>Ye(e.columnSelection.value).map(s=>s.map(r=>String(r)).join(" ")));function n(){const{editHeader:s,columnSelection:r,headers:c}=e;s.value=je(r.value,c.value),We(r.value),B(c),B(r),ce(e)}function l(){const s=ln(e.headers.value,e.datFile);ze.saveAs(new File([JSON.stringify(s,null,2)],`${e.name}.json`,{type:"application/json;charset=utf-8"}))}function o(){ne({id:"poe-dat-viewer@show-schema",title:"Schema",type:cn,args:{name:e.name,headers:JSON.parse(JSON.stringify(e.headers.value))}})}async function a(){await an(e),await Ue(e)}return{rowSorting:e.rowSorting,selections:t,defineColumn:n,exportDataJson:l,showSchema:o,restoreSchema:a}}}),yn={class:"flex"},vn={key:0,class:"text-gray-400 italic px-1.5 self-center"},gn=d("i",{class:"codicon codicon-add"},null,-1),mn=C(" Define column"),bn=[gn,mn],wn=d("div",{class:"text-gray-300 px-1.5 mr-1 self-center"},"Selections",-1),_n=["textContent"],$n={class:"flex gap-x-1"},Sn=d("i",{class:"codicon codicon-discard"},null,-1),xn=C(" Restore schema"),kn=[Sn,xn],Tn=d("i",{class:"codicon codicon-json"},null,-1),Cn=C(" Show schema"),Mn=[Tn,Cn],zn=d("i",{class:"codicon codicon-database"},null,-1),In=C(" Export data"),En=[zn,In];function Pn(e,t,n,l,o,a){return h(),p("div",{class:m(e.$style.bar)},[d("div",yn,[e.selections.length===0?(h(),p("div",vn,"No bytes selected")):e.selections.length===1?(h(),p("button",{key:1,class:"hover:bg-gray-300 hover:text-black px-1.5 flex gap-x-1 items-center",onClick:t[0]||(t[0]=(...s)=>e.defineColumn&&e.defineColumn(...s))},bn)):e.selections.length>1?(h(),p($,{key:2},[wn,(h(!0),p($,null,E(e.selections,s=>(h(),p("div",{class:"px-1.5 mr-1 font-mono bg-gray-200 text-black flex items-center",textContent:w(s)},null,8,_n))),256))],64)):b("",!0)]),d("div",$n,[e.rowSorting?(h(),p("button",{key:0,class:"bg-gray-600 hover:bg-gray-300 hover:text-black px-1.5 border border-gray-500",onClick:t[1]||(t[1]=s=>e.rowSorting=null)},"Clear sorting")):b("",!0),d("button",{class:"hover:bg-gray-300 hover:text-black px-1.5 flex gap-x-1 items-center",onClick:t[2]||(t[2]=(...s)=>e.restoreSchema&&e.restoreSchema(...s))},kn),d("button",{class:"hover:bg-gray-300 hover:text-black px-1.5 flex gap-x-1 items-center",onClick:t[3]||(t[3]=(...s)=>e.showSchema&&e.showSchema(...s))},Mn),d("button",{class:"hover:bg-gray-300 hover:text-black px-1.5 flex gap-x-1 items-center",onClick:t[4]||(t[4]=(...s)=>e.exportDataJson&&e.exportDataJson(...s))},En)])],2)}const Xe={};Xe.$style=hn;var Rn=z(pn,[["render",Pn],["__cssModules",Xe]]);function Ln(e,t,n){const l=Z.readColumn(e,n),o=Array.from({length:n.rowCount},(a,s)=>s);return e.type.array?o.sort((a,s)=>{const r=l[a];return(l[s].length-r.length)*t}):e.type.boolean?o.sort((a,s)=>{const r=Number(l[a]),c=Number(l[s]);return(r-c)*t}):e.type.string?o.sort((a,s)=>{const r=l[a],c=l[s];return r.localeCompare(c)*t}):e.type.integer||e.type.decimal?o.sort((a,s)=>{const r=l[a];return(l[s]-r)*t}):e.type.key&&(e.type.key.foreign?o.sort((a,s)=>{const r=l[a],c=l[s];return(((c==null?void 0:c.rid)||0)-((r==null?void 0:r.rid)||0))*t}):o.sort((a,s)=>{const r=Number(l[a]);return(Number(l[s])-r)*t})),o}function Hn(e,t){t.text=String(e),t.color="#098658"}function Dn(e,t){t.text=`[${e.join(", ")}]`,t.color="#098658"}function On(e,t){t.text=String(e),t.color="#0000ff"}function Vn(e,t){t.text=`[${e.join(", ")}]`,t.color="#0000ff"}function Bn(e,t){e===""?(t.text="null",t.color="#0000ff"):(t.text=String(e),t.color="#001080")}function Fn(e,t){t.text=`[${e.map(n=>'"'+n+'"').join(", ")}]`,t.color="#001080"}function An(e,t){e===null?(t.text="null",t.color="#0000ff"):(t.text=`<${e}, self>`,t.color="#098658")}function Nn(e,t){t.text=`[${e.map(n=>`<${n}, self>`).join(", ")}]`,t.color="#098658"}function Wn(e,t){e===null?(t.text="null",t.color="#0000ff"):(t.text=`<${e.rid}, fk>`,t.color="#098658")}function Yn(e,t){t.text=`[${e.map(n=>`<${n.rid}, fk>`).join(", ")}]`,t.color="#098658"}function jn(e,t,n,l){const o=bt.getFieldReader(t,n),a={text:"",color:""},s=(()=>{var i,u;if(t.type.array){if(t.type.boolean)return Vn;if(t.type.string)return Fn;if(t.type.integer||t.type.decimal)return Dn;if((i=t.type.key)==null?void 0:i.foreign)return Yn;if(t.type.key)return Nn}else{if(t.type.boolean)return On;if(t.type.string)return Bn;if(t.type.integer||t.type.decimal)return Hn;if((u=t.type.key)==null?void 0:u.foreign)return Wn;if(t.type.key)return An}throw new Error("never")})();let r=0,c="";for(const i of l)s(o(i),a),c!==a.color&&(e.fillStyle=a.color,c=a.color),e.fillText(a.text,0,r),r+=I}function Gn(e,t,n,l,o,a){e.fillStyle="#000";let s=0;for(const r of l){const c=n.dataFixed.subarray(r*n.rowLength+t.offset+o,r*n.rowLength+t.offset+a),i=Array.from(c,u=>u.toString(16).padStart(2,"0")).join(" ");e.fillText(i,o*(H*3),s),s+=I}}function Un(e,t,n,l,o){e.fillStyle="#000";const a=o.refArray,s=Math.max(a.keyForeign?n.fieldSize.KEY_FOREIGN:0,a.keySelf?n.fieldSize.KEY:0,a.string?n.fieldSize.STRING:0,a.numeric32?n.fieldSize.LONG:0,n.fieldSize.BYTE),r=Math.ceil(t.textLength/3);let c=0;for(const i of l){const u=n.readerFixed.getSizeT(i*n.rowLength+t.offset);if(u===0)e.fillText("[]",0,c);else{const f=n.readerFixed.getSizeT(i*n.rowLength+t.offset+n.memsize),y=n.dataVariable.subarray(f,f+Math.min(s*u,r)),g=Array.from(y,T=>T.toString(16).padStart(2,"0")).join(" ");e.fillText(`${u} { ${g} }`,0,c)}c+=I}}const j='Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',F=14,H=Qn(F,j),Xn=es(F,j),I=19,qn=3,G=1,Kn=7,Q=Math.round(H*3),X=Q*2+Kn*3;function Jn(e){const t=String(e-1).length;return Math.max(t,qn)}function qe(e){return Math.ceil(Jn(e)*H)}function Zn(e){return qe(e)+8*2}function Qn(e,t){const l=document.createElement("canvas").getContext("2d");return l.font=`${e}px ${t}`,l.measureText("0").width}function es(e,t){const l=document.createElement("canvas").getContext("2d");l.font=`${e}px ${t}`,l.textBaseline="middle";const o=l.measureText("0");return e/2+(o.alphabeticBaseline!==void 0?-o.alphabeticBaseline:o.actualBoundingBoxDescent)}function ts(e){return 1+(e-F)/2+Xn}function ns(e){const{ctx:t}=e;if(t.fillStyle="#fff",t.fillRect(0,0,t.canvas.width,t.canvas.height),e.viewer.selectedRow.value!==null){const l=e.rows.indexOf(e.viewer.selectedRow.value);l!==-1&&(t.fillStyle="#bee3f8",t.fillRect(0,e.top+l*I,t.canvas.width,I))}t.save(),t.translate(-e.left,0),ss(t,e.columns),t.restore(),t.font=`${F}px ${j}`,t.fillStyle="#000";const n=ls(e.viewer,e.left,e.left+e.paintWidth);for(const l of n)t.save(),t.beginPath(),t.translate(l.left-e.left,0),t.rect(0,0,l.width,t.canvas.height),t.clip(),t.translate(H/2,e.top+ts(I)),l.exec(t,e.rows),t.restore();{const l=t.createLinearGradient(0,-16,0,4);l.addColorStop(0,"rgba(254,254,254,0.6)"),l.addColorStop(1,"transparent"),t.fillStyle=l,t.fillRect(0,0,t.canvas.width,6);const o=t.createLinearGradient(-16,0,4,0);o.addColorStop(0,"rgba(254,254,254,0.5)"),o.addColorStop(1,"transparent"),t.fillStyle=o,t.fillRect(0,0,6,t.canvas.height)}}function ss(e,t){for(const n of t)n.selected&&(e.fillStyle="#bee3f8",e.fillRect(n.leftPx+(n.border?G:0),0,n.widthPx,e.canvas.height)),n.border&&(e.fillStyle="#bdbdbd",e.fillRect(n.leftPx,0,G,e.canvas.height))}function ls(e,t,n){const l=e.headers.value,o=e.columnStats.value,a=e.datFile,s=[];let r=0;for(const c of l){const i=fe(c);if(r+i.borderWidth>=t)if(c.type.byteView)if(c.type.byteView.array)s.push({left:r+(i.borderWidth?G:0),width:i.paddingWidth,exec:(u,f)=>Un(u,c,a,f,o[c.offset])});else{const u=Math.max(0,Math.floor((t-r)/(H*3))),f=Math.min(c.length,Math.ceil((n-r)/(H*3)));s.push({left:r+(i.borderWidth?G:0),width:i.paddingWidth,exec:(y,g)=>Gn(y,c,a,g,u,f)})}else s.push({left:r+(i.borderWidth?G:0),width:i.paddingWidth,exec:(u,f)=>jn(u,c,a,f)});if(r+=i.borderWidth,r>=n)return s}return s}function fe(e){const t=e.type.byteView&&!e.type.byteView.array?e.length*3-1:e.textLength;return{paddingWidth:Math.ceil((t+1)*H),borderWidth:Math.ceil((t+1)*H)+(e.offset>0?G:0),hasBorder:e.offset>0}}function os(e){let t=0;for(const n of e)t+=fe(n).borderWidth;return t}function Ke(e,t,n,l){const o=[];let a=0;for(const s of e){const r=fe(s);if(a+r.borderWidth>=n&&o.push({offset:s.offset,border:r.hasBorder,active:s===t,widthPx:r.borderWidth,leftPx:a,name:s.name}),a+=r.borderWidth,a>=l)return o}return o}const as=M({props:{left:{type:Number,required:!0},width:{type:Number,required:!0},columns:{type:Array,required:!0}},setup(e){const t=_(0);let n=-1,l=[];const o=ge("viewer");function a(u){n=u,l=[...o.columnSelection.value],Ne(o.columnSelection.value,n,n,o.headers.value),B(o.columnSelection),document.addEventListener("mouseup",f),document.addEventListener("mouseleave",f);function f(){n=-1,document.removeEventListener("mouseup",f),document.removeEventListener("mouseleave",f)}}function s(u,f){if(n===-1||f.buttons!==1)return;const{memsize:y}=o.datFile,g=u-n;g>=y?u=n+y*2-1:g>=4?u=n+8-1:g>=2&&(u=n+4-1),g<=-y?u=n-y*2+1:g<=-4?u=n-8+1:g<=-2&&(u=n-4+1),o.columnSelection.value=[...l],Ne(o.columnSelection.value,n,u,o.headers.value)}function r(u){const f=o.headers.value.find(y=>y.offset===u);o.editHeader.value===f&&(!f.type.byteView||f.type.byteView.array)?(t.value===0?t.value=1:t.value===1?t.value=-1:t.value===-1&&(t.value=1),o.rowSorting.value=Ln(f,t.value,o.datFile)):(o.editHeader.value=f,t.value=0)}function c(u,f){f.preventDefault();const y=o.headers.value.find(g=>g.offset===u);y.textLength!=null&&(y.textLength=Math.max(1,y.textLength-Math.sign(f.deltaY)*(f.ctrlKey?4*3-2:1)),B(o.headers),ce(o))}return{headers:v(()=>Ke(o.headers.value,o.editHeader.value,e.left,e.left+e.width)),selectStart:a,selectContinue:s,editHeader:r,handleHeaderWheel:c,headersRowStyle:v(()=>({transform:`translate(${-e.left}px, 0)`,lineHeight:Q+"px",fontFamily:j,fontSize:F+"px"})),colsRowStyle:v(()=>({transform:`translate(${-e.left}px, ${Q}px)`,lineHeight:Q+"px",fontFamily:j,fontSize:F+"px"})),statsRowStyle:v(()=>({transform:`translate(${-e.left}px, ${Q*2}px)`,fontFamily:j,fontSize:F+"px"}))}}}),is={class:"datv-header-layer"},rs=["title","onClick","onWheel"],ds=C("\xA0"),us={key:1,class:"bg-gray-500 text-gray-200 px-1"},cs=["onMousedown","onMouseenter","title","textContent"],fs={key:0,class:"datv-stat__line bg-yellow-500",style:{top:"0"}},hs={key:1,class:"datv-stat__line bg-green-500",style:{top:"7px"}},ps={key:2,class:"datv-stat__line bg-gray-800",style:{top:"14px"}},ys={key:3,class:"datv-stat__line bg-pink-400",style:{top:"14px"}},vs=["textContent"],gs={key:1,class:"inline-flex mx-auto items-center h-full"},ms=d("i",{class:"codicon codicon-key"},null,-1),bs=[ms];function ws(e,t,n,l,o,a){return h(),p("div",is,[d("div",{style:S(e.headersRowStyle),class:"absolute"},[(h(!0),p($,null,E(e.headers,s=>(h(),p("button",{key:s.offset,class:m(["datv-header",{"datv-col--border":s.border,"datv-header--active":s.active}]),style:S({width:s.widthPx+"px",transform:`translate(${s.leftPx}px, 0)`}),title:s.name==null?"unidentified":s.name||"unnamed",onClick:r=>e.editHeader(s.offset),onWheel:r=>e.handleHeaderWheel(s.offset,r)},[s.name===null?(h(),p($,{key:0},[ds],64)):s.name===""?(h(),p("span",us,"?")):(h(),p($,{key:2},[C(w(s.name),1)],64))],46,rs))),128))],4),d("div",{style:S(e.colsRowStyle),class:"absolute"},[(h(!0),p($,null,E(e.columns,s=>(h(),p("button",{key:s.offset,class:m(["datv-byte",{"datv-col--border":s.border,"datv-byte--selected":s.selected}]),style:S({width:s.widthPx+"px",transform:`translate(${s.leftPx}px, 0)`}),onMousedown:r=>e.selectStart(s.offset),onMouseenter:r=>e.selectContinue(s.offset,r),title:String(s.offset),textContent:w(s.text)},null,46,cs))),128))],4),d("div",{style:S(e.statsRowStyle),class:"absolute datv-stats_row"},[(h(!0),p($,null,E(e.columns,s=>(h(),p("div",{key:s.offset,class:m(["datv-stat",{"datv-col--border":s.border,"datv-byte--selected":s.selected}]),style:S({width:s.widthPx+"px",transform:`translate(${s.leftPx}px, 0)`})},[s.stat?(h(),p($,{key:0},[s.stat.string?(h(),p("div",fs)):b("",!0),s.stat.array?(h(),p("div",hs)):b("",!0),s.stat.zero?(h(),p("div",ps)):s.stat.nullable?(h(),p("div",ys)):b("",!0),d("div",{class:"datv-stat__max",textContent:w(s.stat.max)},null,8,vs)],64)):s.key?(h(),p("span",gs,bs)):b("",!0)],6))),128))],4)])}var _s=z(as,[["render",ws]]);function $s(e,t,n){const l=[],{fieldSize:o}=n,a=e.length;return a===o.ARRAY&&t.refArray&&l.push({label:"Array",value:"array"}),a===o.STRING&&t.refString&&l.push({label:"String",value:"string"}),a===o.KEY&&t.keySelf&&l.push({label:"Key (self)",value:"key_self"}),a===o.KEY_FOREIGN&&t.keyForeign&&l.push({label:"Key (foreign)",value:"key_foreign"}),a===4&&l.push({label:"Integer",value:"integer"}),a===4&&l.push({label:"Decimal",value:"decimal"}),a===1&&t.maxValue<=1&&l.push({label:"Boolean",value:"boolean"}),l}function Ss(e,t){const n=[];if(!e.type.array||!t.refArray)return n;const l=t.refArray;return l.string&&n.push({label:"String",value:"string"}),l.keySelf&&n.push({label:"Key (self)",value:"key_self"}),l.keyForeign&&n.push({label:"Key (foreign)",value:"key_foreign"}),l.numeric32&&n.push({label:"Integer - 4 bytes",value:"integer_4"}),l.numeric32&&n.push({label:"Decimal - 4 bytes",value:"decimal_4"}),l.boolean&&n.push({label:"Boolean",value:"boolean"}),n}const xs=M({setup(){const e=ge("viewer"),t=v(()=>e.editHeader.value&&xe(e.editHeader.value));{let i=null;N(t,u=>{i&&(i(),i=null),u&&(i=N(u,()=>{B(e.headers),ce(e)},{deep:!0}))})}const n=v(()=>e.columnStats.value[t.value.offset]),l=v({get(){const i=t.value.type;return i.array?"array":i.string?"string":i.key?i.key.foreign?"key_foreign":"key_self":i.integer?"integer":i.decimal?"decimal":i.boolean?"boolean":void 0},set(i){const u=t.value;u.type={},i==="array"?(u.type.array=!0,u.type.byteView={array:!0}):i==="string"?u.type.string={}:i==="key_foreign"?u.type.key={foreign:!0,table:null}:i==="key_self"?u.type.key={foreign:!1,table:e.name}:i==="integer"?u.type.integer={unsigned:!1,size:u.length}:i==="decimal"?u.type.decimal={size:u.length}:i==="boolean"&&(u.type.boolean={})}}),o=v({get(){const i=t.value.type;return i.string?"string":i.key?i.key.foreign?"key_foreign":"key_self":i.integer?`integer_${i.integer.size}`:i.decimal?`decimal_${i.decimal.size}`:i.boolean?"boolean":void 0},set(i){const u=t.value;u.type={array:!0},i==="string"?u.type.string={}:i==="key_foreign"?u.type.key={foreign:!0,table:null}:i==="key_self"?u.type.key={foreign:!1,table:e.name}:i==="integer_1"?u.type.integer={unsigned:!1,size:1}:i==="integer_2"?u.type.integer={unsigned:!1,size:2}:i==="integer_4"?u.type.integer={unsigned:!1,size:4}:i==="integer_8"?u.type.integer={unsigned:!1,size:8}:i==="decimal_4"?u.type.decimal={size:4}:i==="decimal_8"?u.type.decimal={size:8}:i==="boolean"&&(u.type.boolean={})}}),a=v(()=>{const i=[],u=t.value.type;return i.push({label:"Bytes",value:"bytes"}),u.array&&i.push({label:"Var. bytes",value:"array-bytes"}),i.push({label:"Data",value:"data",disabled:!l.value||l.value==="array"&&!o.value}),i}),s=v({get(){const i=t.value.type;return i.byteView?i.byteView.array?"array-bytes":"bytes":"data"},set(i){const u=t.value.type;i==="data"?u.byteView=void 0:u.byteView={array:i==="array-bytes"}}});function r(){e.editHeader.value=null}function c(){Ge(t.value,e.headers.value),e.editHeader.value=null,B(e.headers),ce(e)}return{isVisible:v(()=>e.editHeader.value!=null),HEADERS_HEIGHT:X,header:t,byteViewMode:s,dataType:l,arrayType:o,close:r,remove:c,viewModeOpts:a,dataTypeOpts:v(()=>$s(t.value,n.value,e.datFile)),arrayTypeOpts:v(()=>Ss(t.value,n.value))}}}),ks={key:0,style:{width:"300px"},class:"relative overflow-hidden"},Ts={class:"m-2 shadow border border-gray-300 bg-white absolute inset-0 flex flex-col"},Cs={class:"p-2 bg-gray-100 text-gray-600 shadow flex items-center"},Ms=d("span",{class:"px-2"},"Column properties",-1),zs=d("i",{class:"codicon codicon-close"},null,-1),Is=[zs],Es={key:0,class:"p-4"},Ps={key:1,class:"p-4 overflow-auto"},Rs={class:"mb-4"},Ls=d("label",{for:"datv-header-name"},"Name",-1),Hs={class:"mb-4 flex items-baseline"},Ds=d("div",{class:"mr-2"},"View mode",-1),Os={class:"gap-x-px flex"},Vs=["onClick","disabled","textContent"],Bs={class:"mb-4"},Fs={class:"mb-2 flex justify-between items-baseline"},As=d("span",null,"Data type",-1),Ns={class:"inline-flex items-center"},Ws=["value"],Ys={class:"ml-2 cursor-pointer"},js={key:0,class:"mt-3"},Gs=d("div",{class:"mb-1"},"of ...",-1),Us={class:"inline-flex items-center"},Xs=["value"],qs={class:"ml-2 cursor-pointer"},Ks={key:0,class:"mb-4"},Js={class:"inline-flex items-center"},Zs=d("span",{class:"ml-2 cursor-pointer"},"Unsigned",-1),Qs={key:1,class:"mb-4 border-t pt-4"},el=d("label",{class:"mr-4"},"Width",-1),tl=C(" chars "),nl=d("div",{class:"italic mt-2"},"(move mouse over the column name in Viewer and use `ScrollWheel`, hold `Ctrl` to increase resize step)",-1);function sl(e,t,n,l,o,a){return e.isVisible?(h(),p("div",ks,[d("div",{style:S({height:e.HEADERS_HEIGHT+"px"}),class:"bg-gray-100"},null,4),d("div",Ts,[d("div",Cs,[Ms,d("button",{class:"border border-gray-400 rounded-full px-3",onClick:t[0]||(t[0]=s=>e.$emit("focus-editing-header"))},"Focus"),d("button",{onClick:t[1]||(t[1]=(...s)=>e.close&&e.close(...s)),class:"px-2 py-1 ml-auto",title:"Close"},Is)]),e.header.name===null?(h(),p("div",Es,[d("div",null,w(e.header.length)+" bytes of unidentified data",1)])):(h(),p("div",Ps,[d("div",Rs,[Ls,W(d("input",{id:"datv-header-name",placeholder:"Unnamed","onUpdate:modelValue":t[2]||(t[2]=s=>e.header.name=s),class:"border p-1 mt-1 w-full focus:border-blue-500",spellcheck:"false"},null,512),[[re,e.header.name,void 0,{trim:!0}]])]),d("div",Hs,[Ds,d("div",Os,[(h(!0),p($,null,E(e.viewModeOpts,s=>(h(),p("button",{key:s.value,class:m(["px-2",e.byteViewMode===s.value?"bg-blue-600 text-white":"bg-gray-100 hover:bg-gray-300"]),onClick:r=>e.byteViewMode=s.value,disabled:s.disabled,textContent:w(s.label)},null,10,Vs))),128))])]),d("div",Bs,[d("div",Fs,[As,d("button",{class:"text-red-700 bg-red-100 px-2",onClick:t[3]||(t[3]=(...s)=>e.remove&&e.remove(...s))},"Delete")]),d("div",null,[(h(!0),p($,null,E(e.dataTypeOpts,s=>(h(),p("div",{key:s.value,class:"mb-0.5"},[d("label",Ns,[W(d("input",{type:"radio","onUpdate:modelValue":t[4]||(t[4]=r=>e.dataType=r),value:s.value},null,8,Ws),[[Ie,e.dataType]]),d("span",Ys,w(s.label),1)])]))),128)),e.arrayTypeOpts.length?(h(),p("div",js,[Gs,(h(!0),p($,null,E(e.arrayTypeOpts,s=>(h(),p("div",{key:s.value,class:"mb-0.5"},[d("label",Us,[W(d("input",{type:"radio","onUpdate:modelValue":t[5]||(t[5]=r=>e.arrayType=r),value:s.value},null,8,Xs),[[Ie,e.arrayType]]),d("span",qs,w(s.label),1)])]))),128))])):b("",!0)])]),e.header.type.integer?(h(),p("div",Ks,[d("label",Js,[W(d("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=s=>e.header.type.integer.unsigned=s)},null,512),[[wt,e.header.type.integer.unsigned]]),Zs])])):b("",!0),e.dataType?(h(),p("div",Qs,[el,W(d("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>e.header.textLength=s),class:"border w-16 text-center"},null,512),[[re,e.header.textLength,void 0,{number:!0}]]),tl,nl])):b("",!0)]))])])):b("",!0)}var ll=z(xs,[["render",sl]]);const ol=Math.ceil(H*3);function al(e,t,n,l,o){const a=[];let s=0;for(const r of n){const c=fe(r);if(r.type.byteView&&!r.type.byteView.array){let i=s;for(let u=0;u<r.length;++u){const f=c.hasBorder&&u===0,y=H*3+(f?G:0);if(Math.ceil(i)+y<l){i+=y;continue}const g=r.offset+u;if(a.push({offset:g,selected:e[g],border:f,widthPx:ol,leftPx:Math.ceil(i),text:String(g%100).padStart(2,"0"),stat:t[g],key:!1}),i+=y,Math.ceil(i)>=o)return a}}else s+c.borderWidth>=l&&a.push({offset:r.offset,selected:!1,border:c.hasBorder,widthPx:c.paddingWidth,leftPx:s,text:String(r.offset%100).padStart(2,"0"),key:r.type.key!=null});if(s+=c.borderWidth,s>=o)return a}return a}function il(e,t){const n=e.map(o=>({max:o.maxValue.toString(16).padStart(2,"0"),array:!1,string:!1,nullable:!1,zero:o.maxValue===0})),{fieldSize:l}=t;for(let o=0;o<e.length;++o){const a=e[o];if(a.refString)for(let s=0;s<l.STRING;++s)n[o+s].string=!0;if(a.refArray)for(let s=0;s<l.ARRAY;++s)n[o+s].array=!0;if(a.nullableMemsize)for(let s=0;s<t.memsize;++s)n[o+s].nullable=!0}return n}const rl="_rowsOverlay_wksgp_2";var dl={rowsOverlay:rl};const ul=M({components:{ResizeObserver:He,CanvasScroll:Ae,ViewerActions:Rn,ViewerHead:_s,HeaderProps:ll},emits:["update:kaState"],props:{args:{type:Object,required:!0},kaState:{type:Object,default:void 0}},setup(e,t){let n;e.kaState?n=e.kaState:(n=nn(e.args.fullPath,e.args.fileContent),t.emit("update:kaState",n)),_t("viewer",n);const l=U(null),o=U(null);ke(()=>{o.value.scrollTo(n.scrollPos.x,n.scrollPos.y)});const a=v(()=>n.rowSorting.value?n.rowSorting.value:Array.from({length:n.datFile.rowCount},(x,V)=>V)),s=U(0),r=U(0);function c(x){s.value=x.width,r.value=x.height}const{scrollPos:i}=n;function u(x){i.x=x.x,i.y=x.y}const f=v(()=>os(n.headers.value)),y=v(()=>n.datFile.rowCount*I),g=v(()=>Zn(n.datFile.rowCount)),T=v(()=>Math.max(0,s.value-g.value)),R=v(()=>Math.max(0,r.value-X));N([T,R],()=>{const x=window.devicePixelRatio;l.value.style.width=T.value+"px",l.value.style.height=R.value+"px",l.value.width=T.value*x,l.value.height=R.value*x,l.value.getContext("2d",{alpha:!1}).scale(x,x),he()});const q=v(()=>il(n.columnStats.value,n.datFile)),K=v(()=>al(n.columnSelection.value,q.value,n.headers.value,i.x,i.x+Math.min(f.value,T.value)));N([i,K,a,n.selectedRow],()=>{he()});function he(){const x=l.value.getContext("2d",{alpha:!1});ns({left:i.x,paintWidth:T.value,top:pe.value.top,rows:pe.value.ids,columns:K.value,viewer:n,ctx:x})}const pe=v(()=>{const x=i.y,V=Math.ceil(R.value/I)+1,A=Math.floor(x/I);return{top:A*I-x,ids:a.value.slice(A,A+V)}});function ot(){const x=n.editHeader.value,A=Ke(n.headers.value,null,0,0+1/0).find(J=>J.offset===x.offset);o.value.scrollTo(A.leftPx-T.value*.33,void 0)}function at(x){const{selectedRow:V}=n,A=Math.floor((x.offsetY+i.y)/I),J=a.value[A];V.value=V.value!==J?J:null}return{headerBlockStyle:v(()=>({height:X+"px",width:s.value+"px"})),headerOverlayContentStyle:v(()=>({left:g.value+"px",height:X+"px",width:T.value+"px"})),scrollableStyle:v(()=>({top:X+"px",left:g.value+"px"})),scrollablePaintSize:v(()=>({width:T.value,height:R.value})),scrollableFullSize:v(()=>({width:f.value,height:y.value})),rowsOverlayStyle:v(()=>({top:X+"px",width:g.value+"px",height:R.value+"px",fontFamily:j,fontSize:F+"px",lineHeight:I+"px"})),handleScroll:u,handleResize:c,renderItems:pe,canvasRef:l,renderColumns:K,scrollLeft:v(()=>i.x),rowsWidth:v(()=>Math.min(f.value,T.value)),LINE_HEIGHT:I,canvasScroll:o,rowsNumberWidth:qe(n.datFile.rowCount)+"px",focusEditingHeader:ot,handleCanvasClick:at}}}),cl={class:"flex flex-1"},fl=["textContent"];function hl(e,t,n,l,o,a){const s=D("viewer-actions"),r=D("viewer-head"),c=D("canvas-scroll"),i=D("resize-observer"),u=D("header-props");return h(),p($,null,[O(s),d("div",cl,[O(i,{onResize:e.handleResize,class:"flex-1 min-h-0 relative"},{default:ie(()=>[d("div",{class:"bg-gray-100 absolute",style:S(e.headerBlockStyle)},[O(r,{style:S(e.headerOverlayContentStyle),left:e.scrollLeft,width:e.rowsWidth,columns:e.renderColumns},null,8,["style","left","width","columns"])],4),O(c,{ref:"canvasScroll",class:"absolute bg-white",onScroll:e.handleScroll,style:S(e.scrollableStyle),"paint-size":e.scrollablePaintSize,"full-size":e.scrollableFullSize},{default:ie(()=>[d("canvas",{ref:"canvasRef",onClick:t[0]||(t[0]=(...f)=>e.handleCanvasClick&&e.handleCanvasClick(...f))},null,512)]),_:1},8,["onScroll","style","paint-size","full-size"]),d("div",{class:m(e.$style.rowsOverlay),style:S(e.rowsOverlayStyle)},[d("div",{class:"absolute",style:S({transform:`translate(0, ${e.renderItems.top}px)`})},[(h(!0),p($,null,E(e.renderItems.ids,(f,y)=>(h(),p("div",{key:f,style:S({transform:`translate(0, ${y*e.LINE_HEIGHT}px)`,width:e.rowsNumberWidth,position:"absolute"}),textContent:w(f)},null,12,fl))),128))],4)],6)]),_:1},8,["onResize"]),O(u,{onFocusEditingHeader:e.focusEditingHeader},null,8,["onFocusEditingHeader"])])],64)}const Je={};Je.$style=dl;var Ze=z(ul,[["render",hl],["__cssModules",Je]]);const pl="_input_16vaf_2",yl="_label_16vaf_20",vl="_importVariant_16vaf_26";var gl={input:pl,label:yl,importVariant:vl};const ml=M({setup(){const e=_(localStorage.getItem("POE_PATCH_VER")||""),t=_(""),n=_(!1),l=_(!1);e.value&&!k.value&&a(),ue.value.length||s(),r();async function o(c){const i=c.target.files[0],u=new Uint8Array(await i.arrayBuffer()),f=i.name;ne({id:`file@${f}`,title:f,type:Ze,args:{fileContent:u,fullPath:f}})}async function a(){let c;try{n.value=!0,c=await me(e.value,"_.index.bin")}finally{n.value=!1}try{await Ot(c),localStorage.setItem("POE_PATCH_VER",e.value)}catch(i){throw window.alert(i.message),i}}async function s(){l.value=!0;const i=await(await fetch("https://poe-bundles.snos.workers.dev/schema.min.json")).json();i.version===$t.SCHEMA_VERSION?ue.value=i.tables:console.warn("Latest schema version is not supported."),l.value=!1}async function r(){const i=await(await fetch("https://raw.githubusercontent.com/poe-tool-dev/latest-patch-version/main/latest.txt")).text();t.value=i}return{poePatch:e,latestPoEPatch:t,isCdnImportRunning:n,isFetchingSchema:l,handleFile:o,cdnImport:a}}}),bl={class:"p-4 overflow-auto border-l flex-1 text-base"},wl={class:"flex gap-x-4 items-baseline mt-4"},_l=d("div",{class:"max-w-xl mb-4 font-semibold"},"Useful when a new league is released. While the update is still downloading, you can review files and fix schema directly from the update servers.",-1),$l={class:"inline-flex items-baseline pb-2"},Sl={style:{width:"200px"},class:"my-1"},xl={style:{width:"100px"},class:"m-1"},kl={style:{width:"220px"},class:"my-1"},Tl=["disabled","loading"],Cl={key:0},Ml=C(" Latest PoE patch is "),zl={class:"px-1 border border-gray-300 rounded"},Il={class:"flex gap-x-4 items-baseline mt-4 border-b pb-3"},El={class:"flex items-baseline"},Pl=d("span",{class:"pr-2"},"or just",-1),Rl=d("label",{class:"bg-gray-100 py-1 px-2 cursor-pointer hover:bg-gray-300",style:{width:"200px"},for:"import-local-file"},"Pick a local dat file",-1),Ll={class:"mt-3 flex gap-x-2 items-center"},Hl={key:0,class:"codicon codicon-loading animate-spin"},Dl={key:1,class:"codicon codicon-check"},Ol={key:0},Vl={key:1},Bl=d("a",{href:"https://github.com/poe-tool-dev/dat-schema",class:"underline",target:"_blank"},"github.com/poe-tool-dev/dat-schema",-1);function Fl(e,t,n,l,o,a){return h(),p("div",bl,[d("div",wl,[d("div",{class:m(e.$style.importVariant)},"1",2),d("div",null,[_l,d("div",$l,[d("div",Sl,[d("input",{value:"patchcdn.pathofexile.com/",readonly:"",class:m(e.$style.input)},null,2),d("label",{class:m(e.$style.label)},"Patch CDN",2)]),d("div",xl,[W(d("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>e.poePatch=s),placeholder:"3.12.x.x.x",class:m(e.$style.input)},null,2),[[re,e.poePatch,void 0,{trim:!0}]]),d("label",{class:m(e.$style.label)},"Patch #",2)]),d("div",kl,[d("input",{value:"/Bundles2/_.index.bin",readonly:"",class:m(e.$style.input)},null,2),d("label",{class:m(e.$style.label)},"Index",2)]),d("button",{class:"ml-1 py-1 px-3 bg-blue-600 text-white hover:bg-blue-800",onClick:t[1]||(t[1]=(...s)=>e.cdnImport&&e.cdnImport(...s)),disabled:e.isCdnImportRunning,loading:e.isCdnImportRunning},w(e.isCdnImportRunning?"Wait...":"Import"),9,Tl)]),e.latestPoEPatch&&e.poePatch!==e.latestPoEPatch?(h(),p("div",Cl,[Ml,d("code",zl,w(e.latestPoEPatch),1)])):b("",!0)])]),d("div",Il,[d("div",{class:m(e.$style.importVariant)},"2",2),d("div",El,[Pl,Rl,d("input",{class:"hidden",id:"import-local-file",type:"file",accept:".dat,.dat64",onInput:t[2]||(t[2]=(...s)=>e.handleFile&&e.handleFile(...s))},null,32)])]),d("div",Ll,[e.isFetchingSchema?(h(),p("i",Hl)):(h(),p("i",Dl)),d("div",null,[e.isFetchingSchema?(h(),p("span",Ol," Downloading schema from ")):(h(),p("span",Vl," Downloaded schema from ")),Bl])])])}const Qe={};Qe.$style=gl;var et=z(ml,[["render",Fl],["__cssModules",Qe]]);const ee=_("poe-dat-viewer@import");function te(e){ee.value=e}const P=_([{id:"poe-dat-viewer@import",title:"Import",type:et,args:void 0,kaState:void 0}]);function ne(e){P.value.find(n=>n.id===e.id)||P.value.push({id:e.id,title:e.title,type:e.type,args:e.args,kaState:void 0}),te(e.id),B(P)}function Al(e){const t=P.value.findIndex(n=>n.id===e);e===ee.value&&(t+1<P.value.length?te(P.value[t+1].id):te(t!==0?P.value[t-1].id:null)),P.value=P.value.filter(n=>n.id!==e)}const we=_(!1),_e=_(0),Nl=_(0),se=_(0),Wl=M({setup(){return{timeLeft:v(()=>{!se.value&&k.value.tableStats.length&&(se.value=Date.now()/1e3);const t=Date.now()/1e3,n=_e.value*(t-se.value)/k.value.tableStats.length;return Math.max(Math.ceil(n-t+se.value),0)}),totalTables:_e,isPreloading:we,preloadDataTables:async()=>{se.value=0,Nl.value=Date.now()/1e3,we.value=!0,await Vt(_e),we.value=!1},tables:v(()=>k.value.tableStats)}}}),Yl={class:"p-4 overflow-auto border-l flex-1 text-base"},jl={key:1,class:"flex items-center gap-x-4"},Gl=d("i",{class:"codicon codicon-loading animate-spin"},null,-1),Ul={key:0},Xl={class:"border mt-4"},ql=d("thead",null,[d("tr",null,[d("th",{class:"border-b px-4"},"Name"),d("th",{class:"border-b px-4"},"Rows"),d("th",{class:"border-b px-8"},"Valid"),d("th",{class:"border-b px-4"},"More data")])],-1),Kl={class:"border-b px-4"},Jl={class:"border-b px-4 text-right"},Zl={key:0},Ql=d("td",{colspan:"2",class:"px-8 py-4"},"Waiting for preload...",-1),eo=[Ql];function to(e,t,n,l,o,a){return h(),p("div",Yl,[!e.isPreloading&&!e.tables.length?(h(),p("button",{key:0,class:"py-1 px-3 bg-blue-600 text-white hover:bg-blue-800",onClick:t[0]||(t[0]=(...s)=>e.preloadDataTables&&e.preloadDataTables(...s))},"Preload Data tables")):e.tables.length!==e.totalTables?(h(),p("div",jl,[Gl,d("div",null,[C(w(e.tables.length)+" / "+w(e.totalTables)+" tables",1),e.tables.length?(h(),p("span",Ul,", estimated "+w(e.timeLeft)+" sec",1)):b("",!0)])])):b("",!0),d("table",Xl,[ql,d("tbody",null,[(h(!0),p($,null,E(e.tables,s=>(h(),p("tr",{key:s.name},[d("td",Kl,w(s.name),1),d("td",Jl,w(s.totalRows),1),d("td",{class:m(["border-b px-4 text-center",{"bg-red-400":!s.headersValid}])},w(s.headersValid),3),d("td",{class:m(["border-b px-4 text-center",{"bg-yellow-300":s.increasedRowLength}])},w(s.increasedRowLength),3)]))),128)),e.tables.length?b("",!0):(h(),p("tr",Zl,eo))])])])}var no=z(Wl,[["render",to]]);const so="_titlebar_1pf0f_2",lo="_tab_1pf0f_12",oo="_active_1pf0f_20",ao="_rightBtn_1pf0f_30";var io={titlebar:so,tab:lo,active:oo,rightBtn:ao};const ro=M({setup(){const e=v(()=>P.value.map(l=>({id:l.id,title:l.title,isActive:l.id===ee.value})));function t(){ne({id:"poe-dat-viewer@import",title:"Import",type:et,args:void 0})}function n(){ne({id:"poe-dat-viewer@data-tables",title:"Data Tables",type:no,args:void 0})}return{tabs:e,setActiveTab:te,closeTab:Al,openImport:t,openDataTables:n,showDataTables:v(()=>k.value!=null&&ue.value.length)}}}),uo={class:"flex overflow-hidden divide-x divide-gray-600"},co=["onClick","onMouseup"],fo=["onClick"],ho=d("i",{class:"codicon codicon-close"},null,-1),po=[ho],yo={class:"flex p-1.5 flex-shrink-0 gap-x-1"},vo=d("i",{class:"codicon codicon-cloud-download"},null,-1),go=C(" Import"),mo=[vo,go],bo=d("i",{class:"codicon codicon-table"},null,-1),wo=C(" Data Tables"),_o=[bo,wo];function $o(e,t,n,l,o,a){return h(),p("div",{class:m(e.$style.titlebar)},[d("div",uo,[(h(!0),p($,null,E(e.tabs,s=>(h(),p("div",{key:s.id,class:m([e.$style.tab,{[e.$style.active]:s.isActive}])},[d("button",{class:"pl-3 h-full",onClick:r=>e.setActiveTab(s.id),onMouseup:St(r=>e.closeTab(s.id),["middle"])},w(s.title),41,co),d("button",{class:"mx-2 w-7 h-7 hover:bg-gray-500 text-center",title:"Close",onClick:r=>e.closeTab(s.id)},po,8,fo)],2))),128))]),d("div",yo,[d("button",{class:m(e.$style.rightBtn),onClick:t[0]||(t[0]=(...s)=>e.openImport&&e.openImport(...s))},mo,2),e.showDataTables?(h(),p("button",{key:0,class:m(e.$style.rightBtn),onClick:t[1]||(t[1]=(...s)=>e.openDataTables&&e.openDataTables(...s))},_o,2)):b("",!0)])],2)}const tt={};tt.$style=io;var So=z(ro,[["render",$o],["__cssModules",tt]]);class xo{define(){return M({components:{ResizeObserver:He,CanvasScroll:Ae},props:{items:{type:Array,required:!0},itemHeight:{type:Number,required:!0},scrollableProps:{type:Object,default:()=>({})}},setup(t){const n=ae({width:0,height:0}),l=v(()=>({width:n.width,height:t.items.length*t.itemHeight}));function o(r){n.width=r.width,n.height=r.height}const a=U(null),s=v(()=>{var f,y;const r=(y=(f=a.value)==null?void 0:f.scrollPos.y)!=null?y:0,c=Math.ceil(n.height/t.itemHeight)+1,i=Math.floor(r/t.itemHeight),u=i*t.itemHeight-r;return t.items.slice(i,i+c).map((g,T)=>({top:u+T*t.itemHeight,item:g}))});return{handleResize:o,paintSize:n,fullSize:l,scrollable:a,renderItems:s}}})}}const ko=new xo().define();function To(){return ko}function Co(){return Date.now()}function Mo(e,t){const n=Date.now()-t;console.log(`${e}. Done in -> ${n} ms`)}function nt(e,t){const n=Co(),l=t();return Mo(e,n),l}const zo="_treeToggle_2880p_2",Io="_searchInput_2880p_12",Eo="_itemBtn_2880p_25",Po="_active_2880p_39";var Ro={treeToggle:zo,searchInput:Io,itemBtn:Eo,active:Po};function Lo(){const e=_("");N(k,()=>{e.value=""});const t=v(()=>{if(!k.value)return[];if(e.value==="")return nt("Getting root dirs",()=>xt(k.value.pathReps,k.value.dirsInfo)).map(a=>({label:a,fullPath:a,isFile:!1})).sort((a,s)=>a.label.localeCompare(s.label));const l=nt(`Getting "${e.value}" dir`,()=>kt(e.value,k.value.pathReps,k.value.dirsInfo));return[{label:"../",fullPath:e.value.indexOf("/")===-1?"":e.value.split("/").slice(0,-1).join("/"),isFile:!1},...l.dirs.map(o=>({label:o.substr(e.value.length+1),fullPath:o,isFile:!1})).sort((o,a)=>o.label.localeCompare(a.label)),...l.files.map(o=>({label:o.substr(e.value.length+1),fullPath:o,isFile:!0,isActive:`bundles@${o}`===ee.value})).sort((o,a)=>o.label.localeCompare(a.label))]});async function n(l){if(!l.isFile)e.value=l.fullPath;else{const o=await Dt(l.fullPath);l.fullPath.endsWith(".dat")||l.fullPath.endsWith(".dat64")?ne({id:`bundles@${l.fullPath}`,title:l.label,type:Ze,args:{fileContent:o,fullPath:l.fullPath}}):ze.saveAs(new File([o],l.fullPath.substring(l.fullPath.lastIndexOf("/")+1),{type:"application/octet-stream"}))}}return{currentDir:e,tree:t,handleTreeNav:n}}const Ho=M({components:{VirtualScroll:To()},setup(){const e=_(!0);function t(){e.value=!e.value}const n=v(()=>Boolean(k.value)),{tree:l,handleTreeNav:o,currentDir:a}=Lo(),s=_(".dat64"),r=v(()=>a.value.startsWith("Data")?[".dat",".dat64",".datl",".datl64"].map(u=>({value:u,active:s.value===u,handleClick:()=>{s.value=u}})):null),c=_(""),i=v(()=>{const u=c.value.toLowerCase(),f=r.value?s.value:"";return l.value.filter(y=>y.label.toLowerCase().includes(u)&&(y.isFile?y.label.endsWith(f):!0))});return{showTree:e,toggleTree:t,tree:i,handleTreeNav:o,searchText:c,isIndexLoaded:n,extensionOpts:r}}}),Do={class:"flex p-1 items-center mb-px"},Oo=d("i",{class:"codicon codicon-list-flat"},null,-1),Vo=[Oo],Bo={key:0,class:"flex gap-x-1 border-b pb-1.5 px-2 justify-end"},Fo=["onClick","textContent"],Ao={key:1,class:"italic text-center text-gray-500 p-2"},No={key:2,class:"italic text-center text-gray-500 p-2"},Wo=["onClick"],Yo={key:0,class:"codicon codicon-folder pr-3"};function jo(e,t,n,l,o,a){const s=D("virtual-scroll");return h(),p("div",{class:"layout-column flex-shrink-0",style:S({width:e.showTree?"300px":void 0})},[d("div",Do,[d("button",{title:"Toggle tree visibility",class:m(e.$style.treeToggle),onClick:t[0]||(t[0]=(...r)=>e.toggleTree&&e.toggleTree(...r))},Vo,2),e.showTree?W((h(),p("input",{key:0,"onUpdate:modelValue":t[1]||(t[1]=r=>e.searchText=r),placeholder:"Search in current folder",class:m(e.$style.searchInput),type:"search",spellcheck:"false"},null,2)),[[re,e.searchText,void 0,{trim:!0}]]):b("",!0)]),e.showTree?(h(),p($,{key:0},[e.extensionOpts?(h(),p("div",Bo,[(h(!0),p($,null,E(e.extensionOpts,r=>(h(),p("button",{key:r.value,onClick:r.handleClick,class:m(["px-2",r.active?"bg-gray-200":"hover:bg-gray-100"]),textContent:w(r.value)},null,10,Fo))),128))])):b("",!0),e.isIndexLoaded?b("",!0):(h(),p("div",Ao,"Waiting for Index bundle...")),e.isIndexLoaded&&!e.tree.length?(h(),p("div",No,"No results found")):b("",!0),O(s,{class:"flex-1","scrollable-props":{style:"background: #fff;",widthY:10},items:e.tree,"item-height":22},{default:ie(r=>[(h(!0),p($,null,E(r.entries,c=>(h(),p("button",{key:c.item.fullPath,class:m({[e.$style.itemBtn]:!0,[e.$style.active]:c.item.isActive}),style:S({transform:`translate(0, ${c.top}px`}),onClick:i=>e.handleTreeNav(c.item)},[c.item.isFile?b("",!0):(h(),p("i",Yo)),C(w(c.item.label),1)],14,Wo))),128))]),_:1},8,["items"])],64)):b("",!0)],4)}const st={};st.$style=Ro;var Go=z(Ho,[["render",jo],["__cssModules",st]]);const Uo="_notification_eng9d_2";var Xo={notification:Uo};const qo=M({setup(){return L}}),Ko=d("div",{class:"bg-gray-200 h-1"},null,-1),Jo={class:"p-3"},Zo={class:"font-semibold truncate"},Qo={class:"text-grey text-sm"},ea=C("Downloading...");function ta(e,t,n,l,o,a){return e.active?(h(),p("div",{key:0,class:m(e.$style.notification)},[e.totalSize?(h(),p($,{key:0},[Ko,d("div",{class:"bg-blue-500 h-1 absolute top-0",style:S({width:`${e.received/e.totalSize*100}%`})},null,4)],64)):b("",!0),d("div",Jo,[d("div",Zo,w(e.bundleName),1),d("div",Qo,[e.totalSize?(h(),p($,{key:0},[C(w((e.totalSize/1e6).toFixed(1))+" MB",1)],64)):(h(),p($,{key:1},[ea],64))])])],2)):b("",!0)}const lt={};lt.$style=Xo;var na=z(qo,[["render",ta],["__cssModules",lt]]),sa="/poe-dat-viewer/assets/discord-badge.9068e0df.svg";const la=M({components:{IndexTree:Go,ViewerTabs:So,DownloadProgress:na},setup(){return{activeTab:v(()=>P.value.find(t=>t.id===ee.value)),appVersion:"3.3.0"}}}),oa={class:"layout-column flex-1 min-w-0"},aa={class:"layout-column flex-1 min-h-0"},ia={key:1,class:"bg-gray-50 flex-1 text-lg text-gray-500 flex items-center justify-center"},ra={class:"app-footer"},da=d("a",{class:"q-link text-white border-b",href:"https://github.com/SnosMe/poe-dat-viewer"},"GitHub",-1),ua=d("a",{href:"https://discord.gg/SJjBdT3",class:"flex ml-8"},[d("img",{src:sa})],-1);function ca(e,t,n,l,o,a){const s=D("index-tree"),r=D("viewer-tabs"),c=D("download-progress");return h(),p($,null,[O(s),d("div",oa,[O(r),d("div",aa,[e.activeTab?(h(),Te(Ce(e.activeTab.type),{args:e.activeTab.args,key:e.activeTab.id,"ka-state":e.activeTab.kaState,"onUpdate:ka-state":t[0]||(t[0]=i=>e.activeTab.kaState=i)},null,8,["args","ka-state"])):(h(),p("div",ia,"The viewer is ready to fulfill your wishes \u{1F47E}"))]),d("div",ra,[d("div",null,[C("Made by Alexander Drozdov, v"+w(e.appVersion)+" ",1),da]),ua])]),O(c)],64)}var fa=z(la,[["render",ca]]);Tt(fa).mount("#app");
