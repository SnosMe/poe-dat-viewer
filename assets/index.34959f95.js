var et=Object.defineProperty,tt=Object.defineProperties;var nt=Object.getOwnPropertyDescriptors;var ge=Object.getOwnPropertySymbols;var st=Object.prototype.hasOwnProperty,ot=Object.prototype.propertyIsEnumerable;var me=(e,t,n)=>t in e?et(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ie=(e,t)=>{for(var n in t||(t={}))st.call(t,n)&&me(e,n,t[n]);if(ge)for(var n of ge(t))ot.call(t,n)&&me(e,n,t[n]);return e},re=(e,t)=>tt(e,nt(t));import{r as be,w as lt,t as we,s as S,a as at,g as it,o as rt,d as M,b as G,c as _e,e as dt,f as de,h as X,i as $e,j as h,k as ue,l as ce,m as V,n as v,p as ut,q as p,u as m,v as w,x as u,y as _,z as fe,A,B as ct,C as ft,D as x,E as he,F as Se,G as b,H as E,I as T,J as ht,K as W,L as ee,M as pt,N as xe,O as yt,P as I,Q as P,R as vt,S as gt,T as mt,U as bt,V as wt,W as _t}from"./vendor.c3ffdfe0.js";const $t=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const a of l)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(l){const a={};return l.integrity&&(a.integrity=l.integrity),l.referrerpolicy&&(a.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?a.credentials="include":l.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(l){if(l.ep)return;l.ep=!0;const a=n(l);fetch(l.href,a)}};$t();const St="Bundles2",H=be({totalSize:0,received:0,active:!1,bundleName:""});async function ke(e,t){if(e==null&&(e=localStorage.getItem("POE_PATCH_VER"),!e))throw new Error("never");try{return await xt(e,t)}catch(n){throw window.alert("You may need to adjust the patch version."),n}}async function xt(e,t){const n=`${e}/${St}/${t}`;let o=await caches.open("bundles"),l=await o.match(n);if(!l){if(H.totalSize=0,H.received=0,H.active=!0,H.bundleName=t,l=await fetch(`https://poe-bundles.snos.workers.dev/${n}`),l.status!==200)throw H.active=!1,new Error(`patchcdn: ${l.status} ${l.statusText}`);H.totalSize=Number(l.headers.get("content-length"));let a;try{const s=l.body.getReader(),i=[];for(;;){const{done:r,value:d}=await s.read();if(r)break;i.push(d),H.received+=d.length}a=new Uint8Array(H.received);let c=0;for(const r of i)a.set(r,c),c+=r.length}finally{H.active=!1}return localStorage.getItem("POE_PATCH_VER")!==e&&(await caches.delete("bundles"),o=await caches.open("bundles")),await o.put(n,new Response(a,{headers:{"content-length":String(a.byteLength),"content-type":"application/octet-stream"}})),a.buffer}return l.arrayBuffer()}function kt(){return new Worker("/poe-dat-viewer/assets/script.e3996ad5.js",{type:"module"})}const te=lt(new kt);function Me(e){if(e.byteOffset===0&&e.byteLength===e.buffer.byteLength)return te.decompressSliceInBundle(e);{const t=new Uint8Array(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength));return te.decompressSliceInBundle(we(e,[t.buffer]))}}function Mt(e,t,n){return te.decompressSliceInBundle(we(new Uint8Array(e),[e]),t,n)}function Ct(e){return te.analyzeDatFile(e)}const L=S(null);async function zt(e){const t=it(e,L.value.bundlesInfo,L.value.filesInfo),n=await ke(null,t.bundle);return Mt(n,t.offset,t.size)}async function Tt(e){const t=await Me(new Uint8Array(e)),n=at(t);L.value={bundlesInfo:n.bundlesInfo,filesInfo:n.filesInfo,dirsInfo:n.dirsInfo,pathReps:await Me(n.pathRepsBundle)}}const pe=S([]),ye=rt("poe-dat-viewer",3,{upgrade(e){e.createObjectStore("dat-schemas",{keyPath:"name"})}});async function Et(e){const t=await(await ye).get("dat-schemas",e);return(t==null?void 0:t.headers)||Pt(e)||[]}async function It(e,t){await(await ye).put("dat-schemas",{name:e,headers:Rt(t)})}async function Lt(e){await(await ye).delete("dat-schemas",e)}function Rt(e){return e.map(t=>re(ie({},t),{length:t.type.string||t.type.array||t.type.key||t.type.boolean||t.type.decimal||t.type.integer?void 0:t.length}))}function Pt(e){const t=pe.value.find(n=>n.name===e);return t?t.columns.map(n=>({name:n.name||"",type:{array:n.array,byteView:n.type==="array"?{array:!0}:void 0,integer:n.type==="u8"?{unsigned:!0,size:1}:n.type==="u16"?{unsigned:!0,size:2}:n.type==="u32"?{unsigned:!0,size:4}:n.type==="u64"?{unsigned:!0,size:8}:n.type==="i8"?{unsigned:!1,size:1}:n.type==="i16"?{unsigned:!1,size:2}:n.type==="i32"?{unsigned:!1,size:4}:n.type==="i64"?{unsigned:!1,size:8}:void 0,decimal:n.type==="f32"?{size:4}:n.type==="f64"?{size:8}:void 0,string:n.type==="string"?{}:void 0,boolean:n.type==="bool"?{}:void 0,key:n.type==="row"||n.type==="foreignrow"?{foreign:n.type==="foreignrow"}:void 0},textLength:4*3-1})):null}var C=(e,t)=>{for(const[n,o]of t)e[n]=o;return e};const Ht=M({props:{tag:{type:String,default:"div"}},emits:["resize"],setup(e,t){const n=G(null);return _e(()=>{const o=new ResizeObserver(l=>{t.emit("resize",{width:l[0].contentRect.width,height:l[0].contentRect.height})});o.observe(n.value),dt(()=>{o.unobserve(n.value)})}),{rootEl:n}}});function Ot(e,t,n,o,l,a){return h(),de($e(e.tag),{ref:"rootEl","data-role":"resize-observer"},{default:X(()=>[ue(e.$slots,"default")]),_:3},512)}var Ce=C(Ht,[["render",Ot]]);const Bt="_scrollable_66dfd_2",At="_track_66dfd_8",Ft="_y_66dfd_11",Nt="_x_66dfd_12",Vt="_thumb_66dfd_15";var Wt={scrollable:Bt,track:At,y:Ft,x:Nt,thumb:Vt};const Dt=40,ze=15,Yt=100,Te=(e,t)=>Math.max(1,Math.pow(e*(3/1e3)*t,2))*Math.sign(e);function Ee(e,t,n,o,l){var r;if(n<=t)return null;const a=Math.max(0,t-((r=o==null?void 0:o.fixedSize)!=null?r:0)),s=Math.max(Dt,Math.floor(t*a/n)),i=(a-s)/(n-t),c=Math.round(l*i);return{trackSize:a,thumbSize:s,fixedSize:e,thumbRatio:i,thumbPos:c}}function jt(e){let t=0,n=0,o=0,l=0,a=null,s=0,i=0;function c(y){y.button===1&&(y.preventDefault(),y.stopPropagation(),document.body.style.cursor="all-scroll",a=null,t=y.clientY,n=y.clientX,o=0,l=0,s=0,i=requestAnimationFrame(f),document.addEventListener("mousemove",d),document.addEventListener("mouseup",r),document.addEventListener("mouseleave",r))}function r(){cancelAnimationFrame(i),document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",r),document.removeEventListener("mouseleave",r),document.body.style.removeProperty("cursor")}function d(y){const g=y.clientY-t,k=y.clientX-n;if(a===null)if(Math.abs(g)>ze)a="vertical",document.body.style.cursor="ns-resize";else if(Math.abs(k)>ze)a="horizontal",document.body.style.cursor="ew-resize";else return;a==="vertical"?o=g:l=k}function f(y){const g=y-(s||y);s=y,i=requestAnimationFrame(f),e(Te(l,g),Te(o,g))}return{handleMousedown:c}}function Ut(e){function t(n){e(0,Math.sign(n.deltaY)*Yt)}return{handleMousewheel:t}}function Ie(e,t,n){let o=0,l=0;const a=t==="y"?"y":"x",s=t==="y"?"clientY":"clientX";function i(d){d.preventDefault(),d.stopPropagation();const f=d.currentTarget;if(o=f.getBoundingClientRect()[a],d.target!==f){const y=d.target;l=d[s]-y.getBoundingClientRect()[a]}else l=e.value.thumbSize/2,c(d),l=d[s]-o-e.value.thumbPos;document.addEventListener("mousemove",c),document.addEventListener("mouseup",r),document.addEventListener("mouseleave",r)}function c(d){const f=(d[s]-o-l)/e.value.thumbRatio;t==="x"?n(f,void 0):n(void 0,f)}function r(){document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",r),document.removeEventListener("mouseleave",r)}return{handleTrackMousedown:i}}const Gt=M({props:{paintSize:{type:Object,required:!0},fullSize:{type:Object,required:!0},widthY:{type:Number,default:14},widthX:{type:Number,default:12}},emits:["scroll"],setup(e,t){const n=ce({y:0,x:0});V(()=>[e.paintSize,e.fullSize],()=>{const{paintSize:i,fullSize:c}=e;n.x=Math.max(0,Math.min(n.x,c.width-i.width)),n.y=Math.max(0,Math.min(n.y,c.height-i.height))},{deep:!0}),V(n,()=>{t.emit("scroll",{y:n.y,x:n.x})});const o=v(()=>Ee(e.widthY,e.paintSize.height,e.fullSize.height,null,n.y)),l=v(()=>Ee(e.widthX,e.paintSize.width,e.fullSize.width,o.value,n.x));function a(i,c){const{paintSize:r,fullSize:d}=e;n.y=Math.max(0,Math.min(n.y+Math.floor(c),d.height-r.height)),n.x=Math.max(0,Math.min(n.x+Math.floor(i),d.width-r.width))}function s(i,c){const{paintSize:r,fullSize:d}=e;i!==void 0&&(n.x=Math.max(0,Math.min(Math.floor(i),d.width-r.width))),c!==void 0&&(n.y=Math.max(0,Math.min(Math.floor(c),d.height-r.height)))}return{scrollbarY:o,scrollbarX:l,scrollPos:ut(n),scrollTo:s,scrollByDelta:a,handleMousedown:jt(a).handleMousedown,handleMousewheel:Ut(a).handleMousewheel,handleTrackMousedownY:Ie(o,"y",s).handleTrackMousedown,handleTrackMousedownX:Ie(l,"x",s).handleTrackMousedown}}});function Xt(e,t,n,o,l,a){return h(),p("div",{class:m(e.$style.scrollable),style:w({width:e.paintSize.width+"px",height:e.paintSize.height+"px"}),onMousedown:t[2]||(t[2]=(...s)=>e.handleMousedown&&e.handleMousedown(...s)),onWheel:t[3]||(t[3]=(...s)=>e.handleMousewheel&&e.handleMousewheel(...s))},[ue(e.$slots,"default"),e.scrollbarY?(h(),p("div",{key:0,class:m(`${e.$style.track} ${e.$style.y}`),onMousedown:t[0]||(t[0]=(...s)=>e.handleTrackMousedownY&&e.handleTrackMousedownY(...s)),style:w({width:e.scrollbarY.fixedSize+"px",height:e.scrollbarY.trackSize+"px"})},[u("div",{class:m(e.$style.thumb),style:w({transform:`translate(0, ${e.scrollbarY.thumbPos}px)`,width:e.scrollbarY.fixedSize+"px",height:e.scrollbarY.thumbSize+"px"})},null,6)],38)):_("",!0),e.scrollbarX?(h(),p("div",{key:1,class:m(`${e.$style.track} ${e.$style.x}`),onMousedown:t[1]||(t[1]=(...s)=>e.handleTrackMousedownX&&e.handleTrackMousedownX(...s)),style:w({width:e.scrollbarX.trackSize+"px",height:e.scrollbarX.fixedSize+"px"})},[u("div",{class:m(e.$style.thumb),style:w({transform:`translate(${e.scrollbarX.thumbPos}px, 0)`,width:e.scrollbarX.thumbSize+"px",height:e.scrollbarX.fixedSize+"px"})},null,6)],38)):_("",!0)],38)}const Le={};Le.$style=Wt;var Re=C(Gt,[["render",Xt],["__cssModules",Le]]);function qt(e,t){for(let n=e.offset;n<e.offset+e.length;++n)t[n]=!0}function Pe(e,t,n,o){const l=Math.min(t,n),a=Math.max(t,n);o=o.filter(s=>s.type.byteView&&!s.type.byteView.array);for(let s=l;s<=a;++s)o.some(i=>s>=i.offset&&s<i.offset+i.length)&&(e[s]=!e[s])}function He(e){e.fill(!1)}function Oe(e){const t=[];let n=e.indexOf(!0),o;if(n<0)return t;for(o=n,t.push([o]),n+=1;n<e.length;++n)if(e[n]){const l=n;l-o==1?t[t.length-1].push(l):t.push([l]),o=l}return t}const D=()=>({byteView:{array:!1}});function Kt(e,t){for(let n=0;n<t.length;){const o=t[n];o.name!=null&&e.some(l=>l>=o.offset&&l<o.offset+o.length)?Ae(o,t):n+=1}}function Be(e,t){const n=Oe(e);if(n.length===0)throw new Error("No bytes selected");if(n.length>1)throw new Error("Cannot create header from non-contiguous selection");const o=n[0];Kt(o,t);const l=t.find(i=>o[0]>=i.offset&&o[0]+o.length<=i.offset+i.length);let a=[{name:null,offset:l.offset,length:o[0]-l.offset,type:D()},{name:"",offset:o[0],length:o.length,type:D(),textLength:4*3-1},{name:null,offset:o[0]+o.length,length:l.length-(o[0]-l.offset+o.length),type:D()}];const s=a[1];return a=a.filter(i=>i.length),t.splice(t.indexOf(l),1,...a),s}function Ae(e,t){if(e.name==null)throw new Error("Cannot remove empty header");e.name=null,e.type=D();for(let n=0;n<t.length-1;){const o=Jt(t[n],t[n+1]);o?t.splice(n,2,o):n+=1}}function Jt(e,t){return e.name===null&&t.name===null?{name:null,offset:e.offset,length:e.length+t.length,type:D()}:null}function Zt(e,t){const n=fe.readDatFile(e,t),o={headers:S(n.rowLength?[{name:null,offset:0,length:n.rowLength,type:D()}]:[]),datFile:n,name:tn(e),columnStats:S([]),columnSelection:S(new Array(n.rowLength).fill(!1)),editHeader:S(null),selectedRow:S(null),rowSorting:S(null),scrollPos:ce({x:0,y:0})};return Ct(o.datFile).then(async l=>{o.columnStats.value=l,await Fe(o)}),o}async function Fe(e){e.editHeader.value=null,e.headers.value=e.datFile.rowLength?[{name:null,offset:0,length:e.datFile.rowLength,type:D()}]:[];const t=await Et(e.name);try{Qt(t,e)}catch(n){window.alert(`WARN: ${n.message}`)}finally{A(e.headers)}}function Qt(e,t){let n=0;for(const o of e){const l=o.length||ct(o,t.datFile);if(o.name==null){n+=l;continue}const a=re(ie({},o),{length:l,offset:n});if(!(o.length?t.datFile.rowLength-a.offset>=a.length:ft(a,t.columnStats.value,t.datFile)))throw new Error("The schema is invalid.");qt(a,t.columnSelection.value);const i=Be(t.columnSelection.value,t.headers.value);Object.assign(i,a),He(t.columnSelection.value),n+=l}}function en(e,t){const n=e.filter(({type:o})=>o.boolean||o.decimal||o.integer||o.key||o.string).map((o,l)=>({name:o.name||`Unknown${l+1}`,data:(()=>{var s;const a=fe.readColumn(o,t);if((s=o.type.key)==null?void 0:s.foreign)if(o.type.array){const i=a;if(!i.every(c=>c.every(r=>r.unknown===0)))throw new Error("never");return i.map(c=>c.map(r=>r.rid))}else{const i=a;if(!i.every(c=>c==null||c.unknown===0))throw new Error("never");return i.map(c=>c&&c.rid)}return a})()}));return n.unshift({name:"_rid",data:Array(t.rowCount).fill(void 0).map((o,l)=>l)}),Array(t.rowCount).fill(void 0).map((o,l)=>Object.fromEntries(n.map(a=>[a.name,a.data[l]])))}function tn(e){return e.match(/[^/]+(?=\..+$)/)[0]}async function ne(e){await It(e.name,e.headers.value)}async function nn(e){await Lt(e.name)}const sn=M({props:{args:{type:Object,required:!0}},setup(e){return{text:v(()=>{var l,a,s,i,c,r;const{name:t,headers:n}=e.args;let o="";for(const d of n){if(d.name==null)break;let f="";if(d.type.boolean?f="bool":d.type.string?f="string":((l=d.type.integer)==null?void 0:l.size)===1?f=d.type.integer.unsigned?"u8":"i8":((a=d.type.integer)==null?void 0:a.size)===2?f=d.type.integer.unsigned?"u16":"i16":((s=d.type.integer)==null?void 0:s.size)===4?f=d.type.integer.unsigned?"u32":"i32":((i=d.type.integer)==null?void 0:i.size)===8?f=d.type.integer.unsigned?"u64":"i64":((c=d.type.decimal)==null?void 0:c.size)===4?f="f32":((r=d.type.decimal)==null?void 0:r.size)===8?f="f64":d.type.key&&(f=d.type.key.foreign?"rid":t),d.type.array)o+=`  ${d.name||"_"}: [${f||"_"}]
`;else if(f)o+=`  ${d.name||"_"}: ${f}
`;else break}return`type ${t} {
${o}}
`})}}}),on={class:"p-4 overflow-auto border-l flex-1 text-base"};function ln(e,t,n,o,l,a){return h(),p("div",on,[u("pre",null,x(e.text),1)])}var an=C(sn,[["render",ln]]);const rn="_bar_5acw6_2";var dn={bar:rn};const un=M({setup(){const e=he("viewer"),t=v(()=>Oe(e.columnSelection.value).map(s=>s.map(i=>String(i)).join(" ")));function n(){const{editHeader:s,columnSelection:i,headers:c}=e;s.value=Be(i.value,c.value),He(i.value),A(c),A(i),ne(e)}function o(){const s=en(e.headers.value,e.datFile);Se.saveAs(new File([JSON.stringify(s,null,2)],`${e.name}.json`,{type:"application/json;charset=utf-8"}))}function l(){oe({id:"poe-dat-viewer@show-schema",title:"Schema",type:an,args:{name:e.name,headers:JSON.parse(JSON.stringify(e.headers.value))}})}async function a(){await nn(e),await Fe(e)}return{rowSorting:e.rowSorting,selections:t,defineColumn:n,exportDataJson:o,showSchema:l,restoreSchema:a}}}),cn={class:"flex"},fn={key:0,class:"text-gray-400 italic px-1.5 self-center"},hn=u("i",{class:"codicon codicon-add"},null,-1),pn=T(" Define column"),yn=[hn,pn],vn=u("div",{class:"text-gray-300 px-1.5 mr-1 self-center"},"Selections",-1),gn=["textContent"],mn={class:"flex space-x-1"},bn=u("i",{class:"codicon codicon-discard"},null,-1),wn=T(" Restore schema"),_n=[bn,wn],$n=u("i",{class:"codicon codicon-json"},null,-1),Sn=T(" Show schema"),xn=[$n,Sn],kn=u("i",{class:"codicon codicon-database"},null,-1),Mn=T(" Export data"),Cn=[kn,Mn];function zn(e,t,n,o,l,a){return h(),p("div",{class:m(e.$style.bar)},[u("div",cn,[e.selections.length===0?(h(),p("div",fn,"No bytes selected")):e.selections.length===1?(h(),p("button",{key:1,class:"hover:bg-gray-300 hover:text-black px-1.5",onClick:t[0]||(t[0]=(...s)=>e.defineColumn&&e.defineColumn(...s))},yn)):e.selections.length>1?(h(),p(b,{key:2},[vn,(h(!0),p(b,null,E(e.selections,s=>(h(),p("div",{class:"px-1.5 mr-1 font-mono bg-gray-200 text-black flex items-center",textContent:x(s)},null,8,gn))),256))],64)):_("",!0)]),u("div",mn,[e.rowSorting?(h(),p("button",{key:0,class:"bg-gray-600 hover:bg-gray-300 hover:text-black px-1.5 border border-gray-500",onClick:t[1]||(t[1]=s=>e.rowSorting=null)},"Clear sorting")):_("",!0),u("button",{class:"hover:bg-gray-300 hover:text-black px-1.5",onClick:t[2]||(t[2]=(...s)=>e.restoreSchema&&e.restoreSchema(...s))},_n),u("button",{class:"hover:bg-gray-300 hover:text-black px-1.5",onClick:t[3]||(t[3]=(...s)=>e.showSchema&&e.showSchema(...s))},xn),u("button",{class:"hover:bg-gray-300 hover:text-black px-1.5",onClick:t[4]||(t[4]=(...s)=>e.exportDataJson&&e.exportDataJson(...s))},Cn)])],2)}const Ne={};Ne.$style=dn;var Tn=C(un,[["render",zn],["__cssModules",Ne]]);function En(e,t,n){const o=fe.readColumn(e,n),l=Array.from({length:n.rowCount},(a,s)=>s);return e.type.array?l.sort((a,s)=>{const i=o[a];return(o[s].length-i.length)*t}):e.type.boolean?l.sort((a,s)=>{const i=Number(o[a]),c=Number(o[s]);return(i-c)*t}):e.type.string?l.sort((a,s)=>{const i=o[a],c=o[s];return i.localeCompare(c)*t}):e.type.integer||e.type.decimal?l.sort((a,s)=>{const i=o[a];return(o[s]-i)*t}):e.type.key&&(e.type.key.foreign?l.sort((a,s)=>{const i=o[a],c=o[s];return(((c==null?void 0:c.rid)||0)-((i==null?void 0:i.rid)||0))*t}):l.sort((a,s)=>{const i=Number(o[a]);return(Number(o[s])-i)*t})),l}function In(e,t){t.text=String(e),t.color="#098658"}function Ln(e,t){t.text=`[${e.join(", ")}]`,t.color="#098658"}function Rn(e,t){t.text=String(e),t.color="#0000ff"}function Pn(e,t){t.text=`[${e.join(", ")}]`,t.color="#0000ff"}function Hn(e,t){e===""?(t.text="null",t.color="#0000ff"):(t.text=String(e),t.color="#001080")}function On(e,t){t.text=`[${e.map(n=>'"'+n+'"').join(", ")}]`,t.color="#001080"}function Bn(e,t){e===null?(t.text="null",t.color="#0000ff"):(t.text=`<${e}, self>`,t.color="#098658")}function An(e,t){t.text=`[${e.map(n=>`<${n}, self>`).join(", ")}]`,t.color="#098658"}function Fn(e,t){e===null?(t.text="null",t.color="#0000ff"):(t.text=`<${e.rid}, ${e.unknown}>`,t.color="#098658")}function Nn(e,t){t.text=`[${e.map(n=>`<${n.rid}, ${n.unknown}>`).join(", ")}]`,t.color="#098658"}function Vn(e,t,n,o){const l=ht.getFieldReader(t,n),a={text:"",color:""},s=(()=>{if(t.type.array){if(t.type.boolean)return Pn;if(t.type.string)return On;if(t.type.integer||t.type.decimal)return Ln;if(t.type.key&&t.type.key.foreign)return Nn;if(t.type.key&&!t.type.key.foreign)return An}else{if(t.type.boolean)return Rn;if(t.type.string)return Hn;if(t.type.integer||t.type.decimal)return In;if(t.type.key&&t.type.key.foreign)return Fn;if(t.type.key&&!t.type.key.foreign)return Bn}throw new Error("never")})();let i=0,c="";for(const r of o)s(l(r),a),c!==a.color&&(e.fillStyle=a.color,c=a.color),e.fillText(a.text,0,i),i+=z}function Wn(e,t,n,o,l,a){e.fillStyle="#000";let s=0;for(const i of o){const c=n.dataFixed.subarray(i*n.rowLength+t.offset+l,i*n.rowLength+t.offset+a),r=Array.from(c,d=>d.toString(16).padStart(2,"0")).join(" ");e.fillText(r,l*(O*3),s),s+=z}}function Dn(e,t,n,o,l){e.fillStyle="#000";const a=l.refArray,s=Math.max(a.keyForeign?n.fieldSize.KEY_FOREIGN:0,a.keySelf?n.fieldSize.KEY:0,a.string?n.fieldSize.STRING:0,a.longLong?n.fieldSize.LONGLONG:0,a.long?n.fieldSize.LONG:0,a.short?n.fieldSize.SHORT:0,n.fieldSize.BYTE),i=Math.ceil(t.textLength/3);let c=0;for(const r of o){const d=n.readerFixed.getSizeT(r*n.rowLength+t.offset);if(d===0)e.fillText("[]",0,c);else{const f=n.readerFixed.getSizeT(r*n.rowLength+t.offset+n.memsize),y=n.dataVariable.subarray(f,f+Math.min(s*d,i)),g=Array.from(y,k=>k.toString(16).padStart(2,"0")).join(" ");e.fillText(`${d} { ${g} }`,0,c)}c+=z}}const Y='Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',F=14,O=qn(F,Y),Yn=Kn(F,Y),z=19,jn=3,j=1,Un=7,J=Math.round(O*3),q=J*2+Un*3;function Gn(e){const t=String(e-1).length;return Math.max(t,jn)}function Ve(e){return Math.ceil(Gn(e)*O)}function Xn(e){return Ve(e)+8*2}function qn(e,t){const o=document.createElement("canvas").getContext("2d");return o.font=`${e}px ${t}`,o.measureText("0").width}function Kn(e,t){const o=document.createElement("canvas").getContext("2d");o.font=`${e}px ${t}`,o.textBaseline="middle";const l=o.measureText("0");return e/2+(l.alphabeticBaseline!==void 0?-l.alphabeticBaseline:l.actualBoundingBoxDescent)}function Jn(e){return 1+(e-F)/2+Yn}function Zn(e){const{ctx:t}=e;if(t.fillStyle="#fff",t.fillRect(0,0,t.canvas.width,t.canvas.height),e.viewer.selectedRow.value!==null){const o=e.rows.indexOf(e.viewer.selectedRow.value);o!==-1&&(t.fillStyle="#bee3f8",t.fillRect(0,e.top+o*z,t.canvas.width,z))}t.save(),t.translate(-e.left,0),Qn(t,e.columns),t.restore(),t.font=`${F}px ${Y}`,t.fillStyle="#000";const n=es(e.viewer,e.left,e.left+e.paintWidth);for(const o of n)t.save(),t.beginPath(),t.translate(o.left-e.left,0),t.rect(0,0,o.width,t.canvas.height),t.clip(),t.translate(O/2,e.top+Jn(z)),o.exec(t,e.rows),t.restore();{const o=t.createLinearGradient(0,-16,0,4);o.addColorStop(0,"rgba(254,254,254,0.6)"),o.addColorStop(1,"transparent"),t.fillStyle=o,t.fillRect(0,0,t.canvas.width,6);const l=t.createLinearGradient(-16,0,4,0);l.addColorStop(0,"rgba(254,254,254,0.5)"),l.addColorStop(1,"transparent"),t.fillStyle=l,t.fillRect(0,0,6,t.canvas.height)}}function Qn(e,t){for(const n of t)n.selected&&(e.fillStyle="#bee3f8",e.fillRect(n.leftPx+(n.border?j:0),0,n.widthPx,e.canvas.height)),n.border&&(e.fillStyle="#bdbdbd",e.fillRect(n.leftPx,0,j,e.canvas.height))}function es(e,t,n){const o=e.headers.value,l=e.columnStats.value,a=e.datFile,s=[];let i=0;for(const c of o){const r=se(c);if(i+r.borderWidth>=t)if(c.type.byteView)if(c.type.byteView.array)s.push({left:i+(r.borderWidth?j:0),width:r.paddingWidth,exec:(d,f)=>Dn(d,c,a,f,l[c.offset])});else{const d=Math.max(0,Math.floor((t-i)/(O*3))),f=Math.min(c.length,Math.ceil((n-i)/(O*3)));s.push({left:i+(r.borderWidth?j:0),width:r.paddingWidth,exec:(y,g)=>Wn(y,c,a,g,d,f)})}else s.push({left:i+(r.borderWidth?j:0),width:r.paddingWidth,exec:(d,f)=>Vn(d,c,a,f)});if(i+=r.borderWidth,i>=n)return s}return s}function se(e){const t=e.type.byteView&&!e.type.byteView.array?e.length*3-1:e.textLength;return{paddingWidth:Math.ceil((t+1)*O),borderWidth:Math.ceil((t+1)*O)+(e.offset>0?j:0),hasBorder:e.offset>0}}function ts(e){let t=0;for(const n of e)t+=se(n).borderWidth;return t}function We(e,t,n,o){const l=[];let a=0;for(const s of e){const i=se(s);if(a+i.borderWidth>=n&&l.push({offset:s.offset,border:i.hasBorder,active:s===t,widthPx:i.borderWidth,leftPx:a,name:s.name}),a+=i.borderWidth,a>=o)return l}return l}const ns=M({props:{left:{type:Number,required:!0},width:{type:Number,required:!0},columns:{type:Array,required:!0}},setup(e){const t=S(0);let n=-1,o=[];const l=he("viewer");function a(d){n=d,o=[...l.columnSelection.value],Pe(l.columnSelection.value,n,n,l.headers.value),A(l.columnSelection),document.addEventListener("mouseup",f),document.addEventListener("mouseleave",f);function f(){n=-1,document.removeEventListener("mouseup",f),document.removeEventListener("mouseleave",f)}}function s(d,f){if(n===-1||f.buttons!==1)return;const{memsize:y}=l.datFile,g=d-n;g>=y?d=n+y*2-1:g>=4?d=n+8-1:g>=2&&(d=n+4-1),g<=-y?d=n-y*2+1:g<=-4?d=n-8+1:g<=-2&&(d=n-4+1),l.columnSelection.value=[...o],Pe(l.columnSelection.value,n,d,l.headers.value)}function i(d){const f=l.headers.value.find(y=>y.offset===d);l.editHeader.value===f&&(!f.type.byteView||f.type.byteView.array)?(t.value===0?t.value=1:t.value===1?t.value=-1:t.value===-1&&(t.value=1),l.rowSorting.value=En(f,t.value,l.datFile)):(l.editHeader.value=f,t.value=0)}function c(d,f){f.preventDefault();const y=l.headers.value.find(g=>g.offset===d);y.textLength!=null&&(y.textLength=Math.max(1,y.textLength-Math.sign(f.deltaY)*(f.ctrlKey?4*3-2:1)),A(l.headers),ne(l))}return{headers:v(()=>We(l.headers.value,l.editHeader.value,e.left,e.left+e.width)),selectStart:a,selectContinue:s,editHeader:i,handleHeaderWheel:c,headersRowStyle:v(()=>({transform:`translate(${-e.left}px, 0)`,lineHeight:J+"px",fontFamily:Y,fontSize:F+"px"})),colsRowStyle:v(()=>({transform:`translate(${-e.left}px, ${J}px)`,lineHeight:J+"px",fontFamily:Y,fontSize:F+"px"})),statsRowStyle:v(()=>({transform:`translate(${-e.left}px, ${J*2}px)`,fontFamily:Y,fontSize:F+"px"}))}}}),ss={class:"datv-header-layer"},os=["title","onClick","onWheel"],ls=T("\xA0"),as={key:1,class:"bg-gray-500 text-gray-200 px-1"},is=["onMousedown","onMouseenter","title","textContent"],rs={key:0,class:"datv-stat__line bg-yellow-500",style:{top:"0"}},ds={key:1,class:"datv-stat__line bg-green-500",style:{top:"7px"}},us={key:2,class:"datv-stat__line bg-gray-800",style:{top:"14px"}},cs={key:3,class:"datv-stat__line bg-pink-400",style:{top:"14px"}},fs=["textContent"];function hs(e,t,n,o,l,a){return h(),p("div",ss,[u("div",{style:w(e.headersRowStyle),class:"absolute"},[(h(!0),p(b,null,E(e.headers,s=>(h(),p("button",{key:s.offset,class:m(["datv-header",{"datv-col--border":s.border,"datv-header--active":s.active}]),style:w({width:s.widthPx+"px",transform:`translate(${s.leftPx}px, 0)`}),title:s.name,onClick:i=>e.editHeader(s.offset),onWheel:i=>e.handleHeaderWheel(s.offset,i)},[s.name===null?(h(),p(b,{key:0},[ls],64)):s.name===""?(h(),p("span",as,"?")):(h(),p(b,{key:2},[T(x(s.name),1)],64))],46,os))),128))],4),u("div",{style:w(e.colsRowStyle),class:"absolute"},[(h(!0),p(b,null,E(e.columns,s=>(h(),p("button",{key:s.offset,class:m(["datv-byte",{"datv-col--border":s.border,"datv-byte--selected":s.selected}]),style:w({width:s.widthPx+"px",transform:`translate(${s.leftPx}px, 0)`}),onMousedown:i=>e.selectStart(s.offset),onMouseenter:i=>e.selectContinue(s.offset,i),title:s.offset,textContent:x(s.text)},null,46,is))),128))],4),u("div",{style:w(e.statsRowStyle),class:"absolute datv-stats_row"},[(h(!0),p(b,null,E(e.columns,s=>(h(),p("div",{key:s.offset,class:m(["datv-stat",{"datv-col--border":s.border,"datv-byte--selected":s.selected}]),style:w({width:s.widthPx+"px",transform:`translate(${s.leftPx}px, 0)`})},[s.stat?(h(),p(b,{key:0},[s.stat.string?(h(),p("div",rs)):_("",!0),s.stat.array?(h(),p("div",ds)):_("",!0),s.stat.zero?(h(),p("div",us)):s.stat.nullable?(h(),p("div",cs)):_("",!0),u("div",{class:"datv-stat__max",textContent:x(s.stat.max)},null,8,fs)],64)):_("",!0)],6))),128))],4)])}var ps=C(ns,[["render",hs]]);function ys(e,t,n){const o=[],{fieldSize:l}=n,a=e.length;return a===l.ARRAY&&t.refArray&&o.push({label:"Array",value:"array"}),a===l.STRING&&t.refString&&o.push({label:"String",value:"string"}),a===l.KEY&&t.keySelf&&o.push({label:"Key (self)",value:"key_self"}),a===l.KEY_FOREIGN&&o.push({label:"Key (foreign)",value:"key_foreign"}),(a===8||a===4||a===2||a===1)&&o.push({label:"Integer",value:"integer"}),(a===8||a===4)&&o.push({label:"Decimal",value:"decimal"}),a===1&&t.bMax<=1&&o.push({label:"Boolean",value:"boolean"}),o}function vs(e,t){const n=[];if(!e.type.array||!t.refArray)return n;const o=t.refArray;return o.string&&n.push({label:"String",value:"string"}),o.keySelf&&n.push({label:"Key (self)",value:"key_self"}),o.keyForeign&&n.push({label:"Key (foreign)",value:"key_foreign"}),o.longLong&&n.push({label:"Integer - 8 bytes",value:"integer_8"}),o.long&&n.push({label:"Integer - 4 bytes",value:"integer_4"}),o.short&&n.push({label:"Integer - 2 bytes",value:"integer_2"}),o.longLong&&n.push({label:"Decimal - 8 bytes",value:"decimal_8"}),o.long&&n.push({label:"Decimal - 4 bytes",value:"decimal_4"}),o.boolean&&n.push({label:"Boolean",value:"boolean"}),n.push({label:"Integer - byte",value:"integer_1"}),n}const gs=M({setup(){const e=he("viewer"),t=v(()=>e.editHeader.value&&be(e.editHeader.value));{let r=null;V(t,d=>{r&&(r(),r=null),d&&(r=V(d,()=>{A(e.headers),ne(e)},{deep:!0}))})}const n=v(()=>e.columnStats.value[t.value.offset]),o=v({get(){const r=t.value.type;return r.array?"array":r.string?"string":r.key?r.key.foreign?"key_foreign":"key_self":r.integer?"integer":r.decimal?"decimal":r.boolean?"boolean":void 0},set(r){const d=t.value;d.type={},r==="array"?(d.type.array=!0,d.type.byteView={array:!0}):r==="string"?d.type.string={}:r==="key_foreign"?d.type.key={foreign:!0}:r==="key_self"?d.type.key={foreign:!1}:r==="integer"?d.type.integer={unsigned:!1,size:d.length}:r==="decimal"?d.type.decimal={size:d.length}:r==="boolean"&&(d.type.boolean={})}}),l=v({get(){const r=t.value.type;return r.string?"string":r.key?r.key.foreign?"key_foreign":"key_self":r.integer?`integer_${r.integer.size}`:r.decimal?`decimal_${r.decimal.size}`:r.boolean?"boolean":void 0},set(r){const d=t.value;d.type={array:!0},r==="string"?d.type.string={}:r==="key_foreign"?d.type.key={foreign:!0}:r==="key_self"?d.type.key={foreign:!1}:r==="integer_1"?d.type.integer={unsigned:!1,size:1}:r==="integer_2"?d.type.integer={unsigned:!1,size:2}:r==="integer_4"?d.type.integer={unsigned:!1,size:4}:r==="integer_8"?d.type.integer={unsigned:!1,size:8}:r==="decimal_4"?d.type.decimal={size:4}:r==="decimal_8"?d.type.decimal={size:8}:r==="boolean"&&(d.type.boolean={})}}),a=v(()=>{const r=[],d=t.value.type;return r.push({label:"Bytes",value:"bytes"}),d.array&&r.push({label:"Var. bytes",value:"array-bytes"}),r.push({label:"Data",value:"data",disabled:!o.value||o.value==="array"&&!l.value}),r}),s=v({get(){const r=t.value.type;return r.byteView?r.byteView.array?"array-bytes":"bytes":"data"},set(r){const d=t.value.type;r==="data"?d.byteView=void 0:d.byteView={array:r==="array-bytes"}}});function i(){e.editHeader.value=null}function c(){Ae(t.value,e.headers.value),e.editHeader.value=null,A(e.headers),ne(e)}return{isVisible:v(()=>e.editHeader.value!=null),HEADERS_HEIGHT:q,header:t,byteViewMode:s,dataType:o,arrayType:l,close:i,remove:c,viewModeOpts:a,dataTypeOpts:v(()=>ys(t.value,n.value,e.datFile)),arrayTypeOpts:v(()=>vs(t.value,n.value))}}}),ms={key:0,style:{width:"300px"},class:"relative overflow-hidden"},bs={class:"m-2 shadow border border-gray-300 bg-white absolute inset-0 flex flex-col"},ws={class:"p-2 bg-gray-100 text-gray-600 shadow flex items-baseline"},_s=u("span",{class:"px-2"},"Column properties",-1),$s=u("i",{class:"codicon codicon-close"},null,-1),Ss=[$s],xs={key:0,class:"p-4"},ks={key:1,class:"p-4 overflow-auto"},Ms={class:"mb-4"},Cs=u("label",{for:"datv-header-name"},"Name",-1),zs={class:"mb-4 flex items-baseline"},Ts=u("div",{class:"mr-2"},"View mode",-1),Es={class:"space-x-px flex"},Is=["onClick","disabled","textContent"],Ls={class:"mb-4"},Rs={class:"mb-2 flex justify-between items-baseline"},Ps=u("span",null,"Data type",-1),Hs={class:"inline-flex items-center"},Os=["value"],Bs={class:"ml-2 cursor-pointer"},As={key:0,class:"mt-3"},Fs=u("div",{class:"mb-1"},"of ...",-1),Ns={class:"inline-flex items-center"},Vs=["value"],Ws={class:"ml-2 cursor-pointer"},Ds={key:0,class:"mb-4"},Ys={class:"inline-flex items-center"},js=u("span",{class:"ml-2 cursor-pointer"},"Unsigned",-1),Us={key:1,class:"mb-4 border-t pt-4"},Gs=u("label",{class:"mr-4"},"Width",-1),Xs=T(" chars ");function qs(e,t,n,o,l,a){return e.isVisible?(h(),p("div",ms,[u("div",{style:w({height:e.HEADERS_HEIGHT+"px"}),class:"bg-gray-100"},null,4),u("div",bs,[u("div",ws,[_s,u("button",{class:"border border-gray-400 rounded-full px-3",onClick:t[0]||(t[0]=s=>e.$emit("focus-editing-header"))},"Focus"),u("button",{onClick:t[1]||(t[1]=(...s)=>e.close&&e.close(...s)),class:"px-2 py-1 ml-auto",title:"Close"},Ss)]),e.header.name===null?(h(),p("div",xs,[u("div",null,x(e.header.length)+" bytes of unidentified data",1)])):(h(),p("div",ks,[u("div",Ms,[Cs,W(u("input",{id:"datv-header-name",placeholder:"Unnamed","onUpdate:modelValue":t[2]||(t[2]=s=>e.header.name=s),class:"border p-1 mt-1 w-full focus:border-blue-500",spellcheck:"false"},null,512),[[ee,e.header.name,void 0,{trim:!0}]])]),u("div",zs,[Ts,u("div",Es,[(h(!0),p(b,null,E(e.viewModeOpts,s=>(h(),p("button",{key:s.value,class:m(["px-2",e.byteViewMode===s.value?"bg-blue-600 text-white":"bg-gray-100 hover:bg-gray-300"]),onClick:i=>e.byteViewMode=s.value,disabled:s.disabled,textContent:x(s.label)},null,10,Is))),128))])]),u("div",Ls,[u("div",Rs,[Ps,u("button",{class:"text-red-700 bg-red-100 px-2",onClick:t[3]||(t[3]=(...s)=>e.remove&&e.remove(...s))},"Delete")]),u("div",null,[(h(!0),p(b,null,E(e.dataTypeOpts,s=>(h(),p("div",{key:s.value,class:"mb-0.5"},[u("label",Hs,[W(u("input",{type:"radio","onUpdate:modelValue":t[4]||(t[4]=i=>e.dataType=i),value:s.value},null,8,Os),[[xe,e.dataType]]),u("span",Bs,x(s.label),1)])]))),128)),e.arrayTypeOpts.length?(h(),p("div",As,[Fs,(h(!0),p(b,null,E(e.arrayTypeOpts,s=>(h(),p("div",{key:s.value,class:"mb-0.5"},[u("label",Ns,[W(u("input",{type:"radio","onUpdate:modelValue":t[5]||(t[5]=i=>e.arrayType=i),value:s.value},null,8,Vs),[[xe,e.arrayType]]),u("span",Ws,x(s.label),1)])]))),128))])):_("",!0)])]),e.header.type.integer?(h(),p("div",Ds,[u("label",Ys,[W(u("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=s=>e.header.type.integer.unsigned=s)},null,512),[[pt,e.header.type.integer.unsigned]]),js])])):_("",!0),e.dataType?(h(),p("div",Us,[Gs,W(u("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>e.header.textLength=s),class:"border w-16 text-center"},null,512),[[ee,e.header.textLength,void 0,{number:!0}]]),Xs])):_("",!0)]))])])):_("",!0)}var Ks=C(gs,[["render",qs]]);const Js=Math.ceil(O*3);function Zs(e,t,n,o,l){const a=[];let s=0;for(const i of n){const c=se(i);if(i.type.byteView&&!i.type.byteView.array){let r=s;for(let d=0;d<i.length;++d){const f=c.hasBorder&&d===0,y=O*3+(f?j:0);if(Math.ceil(r)+y<o){r+=y;continue}const g=i.offset+d;if(a.push({offset:g,selected:e[g],border:f,widthPx:Js,leftPx:Math.ceil(r),text:String(g%100).padStart(2,"0"),stat:t[g]}),r+=y,Math.ceil(r)>=l)return a}}else s+c.borderWidth>=o&&a.push({offset:i.offset,selected:!1,border:c.hasBorder,widthPx:c.paddingWidth,leftPx:s,text:String(i.offset%100).padStart(2,"0")});if(s+=c.borderWidth,s>=l)return a}return a}function Qs(e,t){const n=e.map(l=>({max:l.bMax.toString(16).padStart(2,"0"),array:!1,string:!1,nullable:!1,zero:l.bMax===0})),{fieldSize:o}=t;for(let l=0;l<e.length;++l){const a=e[l];if(a.refString)for(let s=0;s<o.STRING;++s)n[l+s].string=!0;if(a.refArray)for(let s=0;s<o.ARRAY;++s)n[l+s].array=!0;if(a.nullableMemsize)for(let s=0;s<t.memsize;++s)n[l+s].nullable=!0}return n}const eo="_rowsOverlay_wksgp_2";var to={rowsOverlay:eo};const no=M({components:{ResizeObserver:Ce,CanvasScroll:Re,ViewerActions:Tn,ViewerHead:ps,HeaderProps:Ks},emits:["update:kaState"],props:{args:{type:Object,required:!0},kaState:{type:Object,default:void 0}},setup(e,t){let n;e.kaState?n=e.kaState:(n=Zt(e.args.fullPath,e.args.fileContent),t.emit("update:kaState",n)),yt("viewer",n);const o=G(null),l=G(null);_e(()=>{l.value.scrollTo(n.scrollPos.x,n.scrollPos.y)});const a=v(()=>n.rowSorting.value?n.rowSorting.value:Array.from({length:n.datFile.rowCount},($,B)=>B)),s=G(0),i=G(0);function c($){s.value=$.width,i.value=$.height}const{scrollPos:r}=n;function d($){r.x=$.x,r.y=$.y}const f=v(()=>ts(n.headers.value)),y=v(()=>n.datFile.rowCount*z),g=v(()=>Xn(n.datFile.rowCount)),k=v(()=>Math.max(0,s.value-g.value)),U=v(()=>Math.max(0,i.value-q));V([k,U],()=>{const $=window.devicePixelRatio;o.value.style.width=k.value+"px",o.value.style.height=U.value+"px",o.value.width=k.value*$,o.value.height=U.value*$,o.value.getContext("2d",{alpha:!1}).scale($,$),ve()});const Je=v(()=>Qs(n.columnStats.value,n.datFile)),le=v(()=>Zs(n.columnSelection.value,Je.value,n.headers.value,r.x,r.x+Math.min(f.value,k.value)));V([r,le,a,n.selectedRow],()=>{ve()});function ve(){const $=o.value.getContext("2d",{alpha:!1});Zn({left:r.x,paintWidth:k.value,top:ae.value.top,rows:ae.value.ids,columns:le.value,viewer:n,ctx:$})}const ae=v(()=>{const $=r.y,B=Math.ceil(U.value/z)+1,N=Math.floor($/z);return{top:N*z-$,ids:a.value.slice(N,N+B)}});function Ze(){const $=n.editHeader.value,N=We(n.headers.value,null,0,0+1/0).find(K=>K.offset===$.offset);l.value.scrollTo(N.leftPx-k.value*.33,void 0)}function Qe($){const{selectedRow:B}=n,N=Math.floor(($.offsetY+r.y)/z),K=a.value[N];B.value=B.value!==K?K:null}return{headerBlockStyle:v(()=>({height:q+"px",width:s.value+"px"})),headerOverlayContentStyle:v(()=>({left:g.value+"px",height:q+"px",width:k.value+"px"})),scrollableStyle:v(()=>({top:q+"px",left:g.value+"px"})),scrollablePaintSize:v(()=>({width:k.value,height:U.value})),scrollableFullSize:v(()=>({width:f.value,height:y.value})),rowsOverlayStyle:v(()=>({top:q+"px",width:g.value+"px",height:U.value+"px",fontFamily:Y,fontSize:F+"px",lineHeight:z+"px"})),handleScroll:d,handleResize:c,renderItems:ae,canvasRef:o,renderColumns:le,scrollLeft:v(()=>r.x),rowsWidth:v(()=>Math.min(f.value,k.value)),LINE_HEIGHT:z,canvasScroll:l,rowsNumberWidth:Ve(n.datFile.rowCount)+"px",focusEditingHeader:Ze,handleCanvasClick:Qe}}}),so={class:"flex flex-1"},oo=["textContent"];function lo(e,t,n,o,l,a){const s=I("viewer-actions"),i=I("viewer-head"),c=I("canvas-scroll"),r=I("resize-observer"),d=I("header-props");return h(),p(b,null,[P(s),u("div",so,[P(r,{onResize:e.handleResize,class:"flex-1 min-h-0 relative"},{default:X(()=>[u("div",{class:"bg-gray-100 absolute",style:w(e.headerBlockStyle)},[P(i,{style:w(e.headerOverlayContentStyle),left:e.scrollLeft,width:e.rowsWidth,columns:e.renderColumns},null,8,["style","left","width","columns"])],4),P(c,{ref:"canvasScroll",class:"absolute bg-white",onScroll:e.handleScroll,style:w(e.scrollableStyle),"paint-size":e.scrollablePaintSize,"full-size":e.scrollableFullSize},{default:X(()=>[u("canvas",{ref:"canvasRef",onClick:t[0]||(t[0]=(...f)=>e.handleCanvasClick&&e.handleCanvasClick(...f))},null,512)]),_:1},8,["onScroll","style","paint-size","full-size"]),u("div",{class:m(e.$style.rowsOverlay),style:w(e.rowsOverlayStyle)},[u("div",{class:"absolute",style:w({transform:`translate(0, ${e.renderItems.top}px)`})},[(h(!0),p(b,null,E(e.renderItems.ids,(f,y)=>(h(),p("div",{key:f,style:w({transform:`translate(0, ${y*e.LINE_HEIGHT}px)`,width:e.rowsNumberWidth,position:"absolute"}),textContent:x(f)},null,12,oo))),128))],4)],6)]),_:1},8,["onResize"]),P(d,{onFocusEditingHeader:e.focusEditingHeader},null,8,["onFocusEditingHeader"])])],64)}const De={};De.$style=to;var Ye=C(no,[["render",lo],["__cssModules",De]]);const ao="_input_16vaf_2",io="_label_16vaf_20",ro="_importVariant_16vaf_26";var uo={input:ao,label:io,importVariant:ro};const co=M({setup(){const e=S(localStorage.getItem("POE_PATCH_VER")||""),t=S(""),n=S(!1),o=S(!1);e.value&&!L.value&&a(),pe.value.length||s(),i();async function l(c){const r=c.target.files[0],d=new Uint8Array(await r.arrayBuffer()),f=r.name;oe({id:`file@${f}`,title:f,type:Ye,args:{fileContent:d,fullPath:f}})}async function a(){let c;try{n.value=!0,c=await ke(e.value,"_.index.bin")}finally{n.value=!1}try{await Tt(c),localStorage.setItem("POE_PATCH_VER",e.value)}catch(r){throw window.alert(r.message),r}}async function s(){o.value=!0;const r=await(await fetch("https://poe-bundles.snos.workers.dev/schema.min.json")).json();r.version===vt.SCHEMA_VERSION?pe.value=r.tables:console.warn("Latest schema version is not supported."),o.value=!1}async function i(){const r=await(await fetch("https://raw.githubusercontent.com/poe-tool-dev/latest-patch-version/main/latest.txt")).text();t.value=r}return{poePatch:e,latestPoEPatch:t,isCdnImportRunning:n,isFetchingSchema:o,handleFile:l,cdnImport:a}}}),fo={class:"p-4 overflow-auto border-l flex-1 text-base"},ho={class:"flex space-x-4 items-baseline mt-4"},po=u("div",{class:"max-w-xl mb-4 font-semibold"},"Useful when a new league is released. While the update is still downloading, you can review files and fix schema directly from the update servers.",-1),yo={class:"inline-flex items-baseline pb-2"},vo={style:{width:"200px"},class:"my-1"},go={style:{width:"100px"},class:"m-1"},mo={style:{width:"220px"},class:"my-1"},bo=["disabled","loading"],wo={key:0},_o=T(" Latest PoE patch is "),$o={class:"px-1 border border-gray-300 rounded"},So={class:"flex space-x-4 items-baseline mt-4 border-b pb-3"},xo={class:"flex items-baseline"},ko=u("span",{class:"pr-2"},"or just",-1),Mo=u("label",{class:"bg-gray-100 py-1 px-2 cursor-pointer hover:bg-gray-300",style:{width:"200px"},for:"import-local-file"},"Pick a local dat file",-1),Co={class:"mt-3"},zo=u("i",{class:"codicon codicon-loading animate-spin"},null,-1),To=u("span",null," Downloading schema from ",-1),Eo=u("i",{class:"codicon codicon-check"},null,-1),Io=u("span",null," Downloaded schema from ",-1),Lo=u("a",{href:"https://github.com/poe-tool-dev/dat-schema",class:"underline",target:"_blank"},"github.com/poe-tool-dev/dat-schema",-1);function Ro(e,t,n,o,l,a){return h(),p("div",fo,[u("div",ho,[u("div",{class:m(e.$style.importVariant)},"1",2),u("div",null,[po,u("div",yo,[u("div",vo,[u("input",{value:"patchcdn.pathofexile.com/",readonly:"",class:m(e.$style.input)},null,2),u("label",{class:m(e.$style.label)},"Patch CDN",2)]),u("div",go,[W(u("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>e.poePatch=s),placeholder:"3.12.x.x.x",class:m(e.$style.input)},null,2),[[ee,e.poePatch,void 0,{trim:!0}]]),u("label",{class:m(e.$style.label)},"Patch #",2)]),u("div",mo,[u("input",{value:"/Bundles2/_.index.bin",readonly:"",class:m(e.$style.input)},null,2),u("label",{class:m(e.$style.label)},"Index",2)]),u("button",{class:"ml-1 py-1 px-3 bg-blue-600 text-white hover:bg-blue-800",onClick:t[1]||(t[1]=(...s)=>e.cdnImport&&e.cdnImport(...s)),disabled:e.isCdnImportRunning,loading:e.isCdnImportRunning},x(e.isCdnImportRunning?"Wait...":"Import"),9,bo)]),e.latestPoEPatch&&e.poePatch!==e.latestPoEPatch?(h(),p("div",wo,[_o,u("code",$o,x(e.latestPoEPatch),1)])):_("",!0)])]),u("div",So,[u("div",{class:m(e.$style.importVariant)},"2",2),u("div",xo,[ko,Mo,u("input",{class:"hidden",id:"import-local-file",type:"file",accept:".dat,.dat64",onInput:t[2]||(t[2]=(...s)=>e.handleFile&&e.handleFile(...s))},null,32)])]),u("div",Co,[e.isFetchingSchema?(h(),p(b,{key:0},[zo,To],64)):(h(),p(b,{key:1},[Eo,Io],64)),Lo])])}const je={};je.$style=uo;var Ue=C(co,[["render",Ro],["__cssModules",je]]);const Z=S("poe-dat-viewer@import");function Q(e){Z.value=e}const R=S([{id:"poe-dat-viewer@import",title:"Import",type:Ue,args:void 0,kaState:void 0}]);function oe(e){R.value.find(n=>n.id===e.id)||R.value.push({id:e.id,title:e.title,type:e.type,args:e.args,kaState:void 0}),Q(e.id),A(R)}function Po(e){const t=R.value.findIndex(n=>n.id===e);e===Z.value&&(t+1<R.value.length?Q(R.value[t+1].id):Q(t!==0?R.value[t-1].id:null)),R.value=R.value.filter(n=>n.id!==e)}const Ho="_titlebar_xd720_2",Oo="_tab_xd720_12",Bo="_active_xd720_20",Ao="_rightBtn_xd720_30";var Fo={titlebar:Ho,tab:Oo,active:Bo,rightBtn:Ao};const No=M({setup(){const e=v(()=>R.value.map(n=>({id:n.id,title:n.title,isActive:n.id===Z.value})));function t(){oe({id:"poe-dat-viewer@import",title:"Import",type:Ue,args:void 0})}return{tabs:e,setActiveTab:Q,closeTab:Po,openImport:t}}}),Vo={class:"flex overflow-hidden divide-x divide-gray-600"},Wo=["onClick","onMouseup"],Do=["onClick"],Yo=u("i",{class:"codicon codicon-close"},null,-1),jo=[Yo],Uo={class:"flex p-1.5 flex-shrink-0 space-x-1"},Go=u("i",{class:"codicon codicon-question"},null,-1),Xo=[Go],qo=u("i",{class:"codicon codicon-settings"},null,-1),Ko=[qo];function Jo(e,t,n,o,l,a){return h(),p("div",{class:m(e.$style.titlebar)},[u("div",Vo,[(h(!0),p(b,null,E(e.tabs,s=>(h(),p("div",{key:s.id,class:m([e.$style.tab,{[e.$style.active]:s.isActive}])},[u("button",{class:"pl-3 h-full",onClick:i=>e.setActiveTab(s.id),onMouseup:gt(i=>e.closeTab(s.id),["middle"])},x(s.title),41,Wo),u("button",{class:"mx-2 w-7 h-7 hover:bg-gray-500 text-center",title:"Close",onClick:i=>e.closeTab(s.id)},jo,8,Do)],2))),128))]),u("div",Uo,[u("button",{class:m(e.$style.rightBtn),onClick:t[0]||(t[0]=(...s)=>e.openImport&&e.openImport(...s))},"Import",2),u("button",{class:m(e.$style.rightBtn),title:"Help"},Xo,2),u("button",{class:m(e.$style.rightBtn),title:"Settings"},Ko,2)])],2)}const Ge={};Ge.$style=Fo;var Zo=C(No,[["render",Jo],["__cssModules",Ge]]);const Qo=M({components:{ResizeObserver:Ce,CanvasScroll:Re},props:{items:{type:Array,required:!0},itemHeight:{type:Number,required:!0},scrollableProps:{type:Object,default:()=>({})}},setup(e){const t=ce({width:0,height:0}),n=v(()=>({width:t.width,height:e.items.length*e.itemHeight}));function o(s){t.width=s.width,t.height=s.height}const l=G(null),a=v(()=>{var d,f;const s=(f=(d=l.value)==null?void 0:d.scrollPos.y)!=null?f:0,i=Math.ceil(t.height/e.itemHeight)+1,c=Math.floor(s/e.itemHeight),r=c*e.itemHeight-s;return e.items.slice(c,c+i).map((y,g)=>({top:r+g*e.itemHeight,item:y}))});return{handleResize:o,paintSize:t,fullSize:n,scrollable:l,renderItems:a}}});function el(e,t,n,o,l,a){const s=I("canvas-scroll"),i=I("resize-observer");return h(),de(i,{onResize:e.handleResize,class:"relative"},{default:X(()=>[P(s,mt({ref:"scrollable"},e.scrollableProps,{class:"absolute","paint-size":e.paintSize,"full-size":e.fullSize}),{default:X(()=>[ue(e.$slots,"default",{entries:e.renderItems})]),_:3},16,["paint-size","full-size"])]),_:3},8,["onResize"])}var tl=C(Qo,[["render",el]]);function nl(){return Date.now()}function sl(e,t){const n=Date.now()-t;console.log(`${e}. Done in -> ${n} ms`)}function Xe(e,t){const n=nl(),o=t();return sl(e,n),o}const ol="_treeToggle_2apx9_2",ll="_searchInput_2apx9_12",al="_itemBtn_2apx9_25",il="_active_2apx9_37";var rl={treeToggle:ol,searchInput:ll,itemBtn:al,active:il};function dl(){const e=S("");V(L,()=>{e.value=""});const t=v(()=>{if(!L.value)return[];if(e.value==="")return Xe("Getting root dirs",()=>bt(L.value.pathReps,L.value.dirsInfo)).map(a=>({label:a,fullPath:a,isFile:!1})).sort((a,s)=>a.label.localeCompare(s.label));const o=Xe(`Getting "${e.value}" dir`,()=>wt(e.value,L.value.pathReps,L.value.dirsInfo));return[{label:"../",fullPath:e.value.indexOf("/")===-1?"":e.value.split("/").slice(0,-1).join("/"),isFile:!1},...o.dirs.map(l=>({label:l.substr(e.value.length+1),fullPath:l,isFile:!1})).sort((l,a)=>l.label.localeCompare(a.label)),...o.files.map(l=>({label:l.substr(e.value.length+1),fullPath:l,isFile:!0,isActive:`bundles@${l}`===Z.value})).sort((l,a)=>l.label.localeCompare(a.label))]});async function n(o){if(!o.isFile)e.value=o.fullPath;else{const l=await zt(o.fullPath);o.fullPath.endsWith(".dat")||o.fullPath.endsWith(".dat64")?oe({id:`bundles@${o.fullPath}`,title:o.label,type:Ye,args:{fileContent:l,fullPath:o.fullPath}}):Se.saveAs(new File([l],o.fullPath.substring(o.fullPath.lastIndexOf("/")+1),{type:"application/octet-stream"}))}}return{currentDir:e,tree:t,handleTreeNav:n}}const ul=M({components:{VirtualScroll:tl},setup(){const e=S(!0);function t(){e.value=!e.value}const n=v(()=>Boolean(L.value)),{tree:o,handleTreeNav:l,currentDir:a}=dl(),s=S(".dat64"),i=v(()=>a.value.startsWith("Data")?[".dat",".dat64",".datl",".datl64"].map(d=>({value:d,active:s.value===d,handleClick:()=>{s.value=d}})):null),c=S(""),r=v(()=>{const d=c.value.toLowerCase(),f=i.value?s.value:"";return o.value.filter(y=>y.label.toLowerCase().includes(d)&&(y.isFile?y.label.endsWith(f):!0))});return{showTree:e,toggleTree:t,tree:r,handleTreeNav:l,searchText:c,isIndexLoaded:n,extensionOpts:i}}}),cl={class:"flex p-1 items-center mb-px"},fl=u("i",{class:"codicon codicon-list-flat"},null,-1),hl=[fl],pl={key:0,class:"flex gap-x-1 border-b pb-1.5 px-2 justify-end"},yl=["onClick","textContent"],vl={key:1,class:"italic text-center text-gray-500 p-2"},gl={key:2,class:"italic text-center text-gray-500 p-2"},ml=["onClick"],bl={key:0,class:"codicon codicon-folder pr-3"};function wl(e,t,n,o,l,a){const s=I("virtual-scroll");return h(),p("div",{class:"layout-column flex-shrink-0",style:w({width:e.showTree?"300px":void 0})},[u("div",cl,[u("button",{title:"Toggle tree visibility",class:m(e.$style.treeToggle),onClick:t[0]||(t[0]=(...i)=>e.toggleTree&&e.toggleTree(...i))},hl,2),e.showTree?W((h(),p("input",{key:0,"onUpdate:modelValue":t[1]||(t[1]=i=>e.searchText=i),placeholder:"Search in current folder",class:m(e.$style.searchInput),type:"search",spellcheck:"false"},null,2)),[[ee,e.searchText,void 0,{trim:!0}]]):_("",!0)]),e.showTree?(h(),p(b,{key:0},[e.extensionOpts?(h(),p("div",pl,[(h(!0),p(b,null,E(e.extensionOpts,i=>(h(),p("button",{key:i.value,onClick:i.handleClick,class:m(["px-2",i.active?"bg-gray-200":"hover:bg-gray-100"]),textContent:x(i.value)},null,10,yl))),128))])):_("",!0),e.isIndexLoaded?_("",!0):(h(),p("div",vl,"Waiting for Index bundle...")),e.isIndexLoaded&&!e.tree.length?(h(),p("div",gl,"No results found")):_("",!0),P(s,{class:"flex-1","scrollable-props":{style:"background: #fff;",widthY:10},items:e.tree,"item-height":22},{default:X(i=>[(h(!0),p(b,null,E(i.entries,c=>(h(),p("button",{key:c.item.fullPath,class:m({[e.$style.itemBtn]:!0,[e.$style.active]:c.item.isActive}),style:w({transform:`translate(0, ${c.top}px`}),onClick:r=>e.handleTreeNav(c.item)},[c.item.isFile?_("",!0):(h(),p("i",bl)),T(x(c.item.label),1)],14,ml))),128))]),_:1},8,["items"])],64)):_("",!0)],4)}const qe={};qe.$style=rl;var _l=C(ul,[["render",wl],["__cssModules",qe]]);const $l="_notification_eng9d_2";var Sl={notification:$l};const xl=M({setup(){return H}}),kl=u("div",{class:"bg-gray-200 h-1"},null,-1),Ml={class:"p-3"},Cl={class:"font-semibold truncate"},zl={class:"text-grey text-sm"},Tl=T("Downloading...");function El(e,t,n,o,l,a){return e.active?(h(),p("div",{key:0,class:m(e.$style.notification)},[e.totalSize?(h(),p(b,{key:0},[kl,u("div",{class:"bg-blue-500 h-1 absolute top-0",style:w({width:`${e.received/e.totalSize*100}%`})},null,4)],64)):_("",!0),u("div",Ml,[u("div",Cl,x(e.bundleName),1),u("div",zl,[e.totalSize?(h(),p(b,{key:0},[T(x((e.totalSize/1e6).toFixed(1))+" MB",1)],64)):(h(),p(b,{key:1},[Tl],64))])])],2)):_("",!0)}const Ke={};Ke.$style=Sl;var Il=C(xl,[["render",El],["__cssModules",Ke]]),Ll="/poe-dat-viewer/assets/discord-badge.9068e0df.svg";const Rl=M({components:{IndexTree:_l,ViewerTabs:Zo,DownloadProgress:Il},setup(){return{activeTab:v(()=>R.value.find(t=>t.id===Z.value)),appVersion:"3.3.0"}}}),Pl={class:"layout-column flex-1 min-w-0"},Hl={class:"layout-column flex-1 min-h-0"},Ol={key:1,class:"bg-gray-50 flex-1 text-lg text-gray-500 flex items-center justify-center"},Bl={class:"app-footer"},Al=u("a",{class:"q-link text-white border-b",href:"https://github.com/SnosMe/poe-dat-viewer"},"GitHub",-1),Fl=u("a",{href:"https://discord.gg/SJjBdT3",class:"flex ml-8"},[u("img",{src:Ll})],-1);function Nl(e,t,n,o,l,a){const s=I("index-tree"),i=I("viewer-tabs"),c=I("download-progress");return h(),p(b,null,[P(s),u("div",Pl,[P(i),u("div",Hl,[e.activeTab?(h(),de($e(e.activeTab.type),{args:e.activeTab.args,key:e.activeTab.id,"ka-state":e.activeTab.kaState,"onUpdate:ka-state":t[0]||(t[0]=r=>e.activeTab.kaState=r)},null,8,["args","ka-state"])):(h(),p("div",Ol,"The viewer is ready to fulfill your wishes \u{1F47E}"))]),u("div",Bl,[u("div",null,[T("Made by Alexander Drozdov, v"+x(e.appVersion)+" ",1),Al]),Fl])]),P(c)],64)}var Vl=C(Rl,[["render",Nl]]);_t(Vl).mount("#app");
