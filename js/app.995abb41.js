(function(){"use strict";var e={743:function(e,t,l){var n=l(963),a=l(252),o=l(577),r=l.p+"img/discord-badge.59203335.svg";const i={class:"layout-column flex-1 min-w-0"},s={class:"layout-column flex-1 min-h-0"},u={key:1,class:"bg-gray-50 flex-1 text-lg text-gray-500 flex items-center justify-center"},c={class:"app-footer"},d=(0,a.Wm)("a",{class:"q-link text-white border-b",href:"https://github.com/SnosMe/poe-dat-viewer"},"GitHub",-1),f=(0,a.Wm)("a",{href:"https://discord.gg/SJjBdT3",class:"flex ml-8"},[(0,a.Wm)("img",{src:r})],-1);function h(e,t,l,n,r,h){const p=(0,a.up)("index-tree"),v=(0,a.up)("viewer-tabs"),y=(0,a.up)("download-progress");return(0,a.wg)(),(0,a.j4)(a.HY,null,[(0,a.Wm)(p),(0,a.Wm)("div",i,[(0,a.Wm)(v),(0,a.Wm)("div",s,[e.activeTab?((0,a.wg)(),(0,a.j4)((0,a.LL)(e.activeTab.type),{args:e.activeTab.args,key:e.activeTab.id,"ka-state":e.activeTab.kaState,"onUpdate:ka-state":t[1]||(t[1]=t=>e.activeTab.kaState=t)},null,8,["args","ka-state"])):((0,a.wg)(),(0,a.j4)("div",u,"The viewer is ready to fulfill your wishes ðŸ‘¾"))]),(0,a.Wm)("div",c,[(0,a.Wm)("div",null,[(0,a.Uk)("Made by Alexander Drozdov, v"+(0,o.zw)(e.appVersion)+" ",1),d]),f])]),(0,a.Wm)(y)],64)}const p={class:"flex overflow-hidden divide-x divide-gray-600"},v=(0,a.Wm)("i",{class:"codicon codicon-close"},null,-1),y={class:"flex p-1.5 flex-shrink-0 space-x-1"},m=(0,a.Wm)("button",{class:"hover:bg-gray-300 hover:text-black px-2",title:"Help"},[(0,a.Wm)("i",{class:"codicon codicon-question"})],-1),g=(0,a.Wm)("button",{class:"hover:bg-gray-300 hover:text-black px-2",title:"Settings"},[(0,a.Wm)("i",{class:"codicon codicon-settings"})],-1);function b(e,t,l,r,i,s){return(0,a.wg)(),(0,a.j4)("div",{class:e.$style.titlebar},[(0,a.Wm)("div",p,[((0,a.wg)(!0),(0,a.j4)(a.HY,null,(0,a.Ko)(e.tabs,(t=>((0,a.wg)(),(0,a.j4)("div",{key:t.id,class:[e.$style.tab,{[e.$style.active]:t.isActive}]},[(0,a.Wm)("button",{class:"pl-3 pr-1.5",onClick:l=>e.setActiveTab(t.id),onContextmenu:(0,n.iM)((l=>e.closeTab(t.id)),["prevent"])},(0,o.zw)(t.title),41,["onClick","onContextmenu"]),(0,a.Wm)("button",{class:"pl-1.5 pr-3",title:"Close",onClick:l=>e.closeTab(t.id)},[v],8,["onClick"])],2)))),128))]),(0,a.Wm)("div",y,[(0,a.Wm)("button",{class:"hover:bg-gray-300 hover:text-black p-2",onClick:t[1]||(t[1]=(...t)=>e.openImport&&e.openImport(...t))},"Import"),m,g])],2)}var w=l(262);const x={class:"p-4 overflow-auto border-l flex-1 text-base"},k={class:"inline-flex items-baseline pb-2"},S={style:{width:"200px"},class:"my-1"},W={style:{width:"100px"},class:"m-1"},z={style:{width:"220px"},class:"my-1"},_={class:"flex items-baseline mt-3 border-b pb-3"},M=(0,a.Wm)("span",{class:"pr-2"},"or",-1),C=(0,a.Wm)("label",{class:"bg-gray-100 py-1 px-2 cursor-pointer hover:bg-gray-300",style:{width:"200px"},for:"import-local-file"},"Pick local dat file",-1),j={class:"mt-3"},F=(0,a.Wm)("i",{class:"codicon codicon-loading animate-spin"},null,-1),I=(0,a.Wm)("span",null," Downloading schema from ",-1),T=(0,a.Wm)("i",{class:"codicon codicon-check"},null,-1),$=(0,a.Wm)("span",null," Downloaded schema from ",-1),H=(0,a.Wm)("a",{href:"https://github.com/poe-tool-dev/dat-schema",class:"underline",target:"_blank"},"github.com/poe-tool-dev/dat-schema",-1);function P(e,t,l,r,i,s){return(0,a.wg)(),(0,a.j4)("div",x,[(0,a.Wm)("div",k,[(0,a.Wm)("div",S,[(0,a.Wm)("input",{value:"patchcdn.pathofexile.com/",readonly:"",class:e.$style.input},null,2),(0,a.Wm)("label",{class:e.$style.label},"Patch CDN",2)]),(0,a.Wm)("div",W,[(0,a.wy)((0,a.Wm)("input",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.poePatch=t),placeholder:"3.12.x.x.x",class:e.$style.input},null,2),[[n.nr,e.poePatch,void 0,{trim:!0}]]),(0,a.Wm)("label",{class:e.$style.label},"Patch #",2)]),(0,a.Wm)("div",z,[(0,a.Wm)("input",{value:"/Bundles2/_.index.bin",readonly:"",class:e.$style.input},null,2),(0,a.Wm)("label",{class:e.$style.label},"Index",2)]),(0,a.Wm)("button",{class:"ml-1 py-1 px-3 bg-blue-600 text-white hover:bg-blue-800",onClick:t[2]||(t[2]=(...t)=>e.cdnImport&&e.cdnImport(...t)),disabled:e.isCdnImportRunning,loading:e.isCdnImportRunning},(0,o.zw)(e.isCdnImportRunning?"Wait...":"Import"),9,["disabled","loading"])]),(0,a.Wm)("div",_,[M,C,(0,a.Wm)("input",{class:"hidden",id:"import-local-file",type:"file",accept:".dat,.dat64",onInput:t[3]||(t[3]=(...t)=>e.handleFile&&e.handleFile(...t))},null,32)]),(0,a.Wm)("div",j,[e.isFetchingSchema?((0,a.wg)(),(0,a.j4)(a.HY,{key:0},[F,I],64)):((0,a.wg)(),(0,a.j4)(a.HY,{key:1},[T,$],64)),H])])}var R=l(735);const E="Bundles2",L=(0,w.qj)({totalSize:0,received:0,active:!1,bundleName:""});async function O(e,t){if(null==e&&(e=localStorage.getItem("POE_PATCH_VER"),!e))throw new Error("never");try{return await Y(e,t)}catch(l){throw window.alert("You may need to adjust the patch version."),l}}async function Y(e,t){const l=`${e}/${E}/${t}`;let n=await caches.open("bundles"),a=await n.match(l);if(!a){if(L.totalSize=0,L.received=0,L.active=!0,L.bundleName=t,a=await fetch(`https://poe-bundles.snos.workers.dev/${l}`),200!==a.status)throw L.active=!1,new Error(`patchcdn: ${a.status} ${a.statusText}`);let o;L.totalSize=Number(a.headers.get("content-length"));try{const e=a.body.getReader(),t=[];while(1){const{done:l,value:n}=await e.read();if(l)break;t.push(n),L.received+=n.length}o=new Uint8Array(L.received);let l=0;for(const n of t)o.set(n,l),l+=n.length}finally{L.active=!1}return localStorage.getItem("POE_PATCH_VER")!==e&&(await caches.delete("bundles"),n=await caches.open("bundles")),await n.put(l,new Response(o,{headers:{"content-length":String(o.byteLength),"content-type":"application/octet-stream"}})),o.buffer}return a.arrayBuffer()}function A(){return new Worker(l.p+"js/script.d2571f35.worker.js")}var V=l(870);const N=V.Ud(new A);function D(e){if(0===e.byteOffset&&e.byteLength===e.buffer.byteLength)return N.decompressSliceInBundle(e);{const t=new Uint8Array(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength));return N.decompressSliceInBundle(V.re(e,[t.buffer]))}}function q(e,t,l){return N.decompressSliceInBundle(V.re(new Uint8Array(e),[e]),t,l)}function X(e){return N.analyzeDatFile(e)}var B=l(568);const U=(0,w.XI)(null);async function K(e){const t=(0,B.hr)(e,U.value.bundlesInfo,U.value.filesInfo),l=await O(null,t.bundle);return q(l,t.offset,t.size)}async function G(e){const t=await D(new Uint8Array(e)),l=(0,B.W6)(t);U.value={bundlesInfo:l.bundlesInfo,filesInfo:l.filesInfo,dirsInfo:l.dirsInfo,pathReps:await D(l.pathRepsBundle)}}var Z=l(29);const J=(0,w.XI)([]),Q=(0,Z.X3)("poe-dat-viewer",3,{upgrade(e){e.createObjectStore("dat-schemas",{keyPath:"name"})}});async function ee(e){const t=await(await Q).get("dat-schemas",e);return(null===t||void 0===t?void 0:t.headers)||ne(e)||[]}async function te(e,t){await(await Q).put("dat-schemas",{name:e,headers:le(t)})}function le(e){return e.map((e=>({...e,length:e.type.string||e.type.array||e.type.key||e.type.boolean||e.type.decimal||e.type.integer?void 0:e.length})))}function ne(e){const t=J.value.find((t=>t.name===e));return t?t.columns.map((e=>({name:e.name||"",type:{array:e.array,integer:"u8"===e.type?{unsigned:!0,size:1}:"u16"===e.type?{unsigned:!0,size:2}:"u32"===e.type?{unsigned:!0,size:4}:"u64"===e.type?{unsigned:!0,size:8}:"i8"===e.type?{unsigned:!1,size:1}:"i16"===e.type?{unsigned:!1,size:2}:"i32"===e.type?{unsigned:!1,size:4}:"i64"===e.type?{unsigned:!1,size:8}:void 0,decimal:"f32"===e.type?{size:4}:"f64"===e.type?{size:8}:void 0,string:"string"===e.type?{}:void 0,boolean:"bool"===e.type?{}:void 0,key:"row"===e.type||"foreignrow"===e.type?{foreign:"foreignrow"===e.type}:void 0},textLength:11}))):null}const ae={class:"flex flex-1"};function oe(e,t,l,n,r,i){const s=(0,a.up)("viewer-actions"),u=(0,a.up)("viewer-head"),c=(0,a.up)("canvas-scroll"),d=(0,a.up)("resize-observer"),f=(0,a.up)("header-props");return(0,a.wg)(),(0,a.j4)(a.HY,null,[(0,a.Wm)(s),(0,a.Wm)("div",ae,[(0,a.Wm)(d,{onResize:e.handleResize,class:"flex-1 min-h-0 relative"},{default:(0,a.w5)((()=>[(0,a.Wm)("div",{class:"bg-gray-100 absolute",style:e.headerBlockStyle},[(0,a.Wm)(u,{style:e.headerOverlayContentStyle,left:e.scrollLeft,width:e.rowsWidth,columns:e.renderColumns},null,8,["style","left","width","columns"])],4),(0,a.Wm)(c,{ref:"canvasScroll",class:"absolute bg-white",onScroll:e.handleScroll,style:e.scrollableStyle,"paint-size":e.scrollablePaintSize,"full-size":e.scrollableFullSize},{default:(0,a.w5)((()=>[(0,a.Wm)("canvas",{ref:"canvasRef",onClick:t[1]||(t[1]=(...t)=>e.handleCanvasClick&&e.handleCanvasClick(...t))},null,512)])),_:1},8,["onScroll","style","paint-size","full-size"]),(0,a.Wm)("div",{class:e.$style.rowsOverlay,style:e.rowsOverlayStyle},[(0,a.Wm)("div",{class:"absolute",style:{transform:`translate(0, ${e.renderItems.top}px)`}},[((0,a.wg)(!0),(0,a.j4)(a.HY,null,(0,a.Ko)(e.renderItems.ids,((t,l)=>((0,a.wg)(),(0,a.j4)("div",{key:t,style:{transform:`translate(0, ${l*e.LINE_HEIGHT}px)`,width:e.rowsNumberWidth,position:"absolute"},textContent:(0,o.zw)(t)},null,12,["textContent"])))),128))],4)],6)])),_:1},8,["onResize"]),(0,a.Wm)(f,{onFocusEditingHeader:e.focusEditingHeader},null,8,["onFocusEditingHeader"])])],64)}function re(e,t,l,n,o,r){return(0,a.wg)(),(0,a.j4)((0,a.LL)(e.tag),{ref:"rootEl","data-role":"resize-observer"},{default:(0,a.w5)((()=>[(0,a.WI)(e.$slots,"default")])),_:3},512)}var ie=(0,a.aZ)({props:{tag:{type:String,default:"div"}},emits:["resize"],setup(e,t){const l=(0,w.iH)(null);return(0,a.bv)((()=>{const e=new ResizeObserver((e=>{t.emit("resize",{width:e[0].contentRect.width,height:e[0].contentRect.height})}));e.observe(l.value),(0,a.Jd)((()=>{e.unobserve(l.value)}))})),{rootEl:l}}});ie.render=re;var se=ie;function ue(e,t,l,n,o,r){return(0,a.wg)(),(0,a.j4)("div",{class:e.$style.scrollable,style:{width:e.paintSize.width+"px",height:e.paintSize.height+"px"},onMousedown:t[3]||(t[3]=(...t)=>e.handleMousedown&&e.handleMousedown(...t)),onWheel:t[4]||(t[4]=(...t)=>e.handleMousewheel&&e.handleMousewheel(...t))},[(0,a.WI)(e.$slots,"default"),e.scrollbarY?((0,a.wg)(),(0,a.j4)("div",{key:0,class:`${e.$style.track} ${e.$style.y}`,onMousedown:t[1]||(t[1]=(...t)=>e.handleTrackMousedownY&&e.handleTrackMousedownY(...t)),style:{width:e.scrollbarY.fixedSize+"px",height:e.scrollbarY.trackSize+"px"}},[(0,a.Wm)("div",{class:e.$style.thumb,style:{transform:`translate(0, ${e.scrollbarY.thumbPos}px)`,width:e.scrollbarY.fixedSize+"px",height:e.scrollbarY.thumbSize+"px"}},null,6)],38)):(0,a.kq)("",!0),e.scrollbarX?((0,a.wg)(),(0,a.j4)("div",{key:1,class:`${e.$style.track} ${e.$style.x}`,onMousedown:t[2]||(t[2]=(...t)=>e.handleTrackMousedownX&&e.handleTrackMousedownX(...t)),style:{width:e.scrollbarX.trackSize+"px",height:e.scrollbarX.fixedSize+"px"}},[(0,a.Wm)("div",{class:e.$style.thumb,style:{transform:`translate(${e.scrollbarX.thumbPos}px, 0)`,width:e.scrollbarX.thumbSize+"px",height:e.scrollbarX.fixedSize+"px"}},null,6)],38)):(0,a.kq)("",!0)],38)}const ce=40,de=15,fe=100,he=(e,t)=>Math.max(1,Math.pow(.003*e*t,2))*Math.sign(e);function pe(e,t,l,n,a){var o;if(l<=t)return null;const r=Math.max(0,t-(null!==(o=null===n||void 0===n?void 0:n.fixedSize)&&void 0!==o?o:0)),i=Math.max(ce,Math.floor(t*r/l)),s=(r-i)/(l-t),u=Math.round(a*s);return{trackSize:r,thumbSize:i,fixedSize:e,thumbRatio:s,thumbPos:u}}function ve(e){let t=0,l=0,n=0,a=0,o=null,r=0,i=0;function s(e){1===e.button&&(e.preventDefault(),e.stopPropagation(),document.body.style.cursor="all-scroll",o=null,t=e.clientY,l=e.clientX,n=0,a=0,r=0,i=requestAnimationFrame(d),document.addEventListener("mousemove",c),document.addEventListener("mouseup",u),document.addEventListener("mouseleave",u))}function u(){cancelAnimationFrame(i),document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",u),document.removeEventListener("mouseleave",u),document.body.style.removeProperty("cursor")}function c(e){const r=e.clientY-t,i=e.clientX-l;if(null===o)if(Math.abs(r)>de)o="vertical",document.body.style.cursor="ns-resize";else{if(!(Math.abs(i)>de))return;o="horizontal",document.body.style.cursor="ew-resize"}"vertical"===o?n=r:a=i}function d(t){const l=t-(r||t);r=t,i=requestAnimationFrame(d),e(he(a,l),he(n,l))}return{handleMousedown:s}}function ye(e){function t(t){e(0,Math.sign(t.deltaY)*fe)}return{handleMousewheel:t}}function me(e,t,l){let n=0,a=0;const o="y"===t?"y":"x",r="y"===t?"clientY":"clientX";function i(t){t.preventDefault(),t.stopPropagation();const l=t.currentTarget;if(n=l.getBoundingClientRect()[o],t.target!==l){const e=t.target;a=t[r]-e.getBoundingClientRect()[o]}else a=e.value.thumbSize/2,s(t),a=t[r]-n-e.value.thumbPos;document.addEventListener("mousemove",s),document.addEventListener("mouseup",u),document.addEventListener("mouseleave",u)}function s(o){const i=(o[r]-n-a)/e.value.thumbRatio;"x"===t?l(i,void 0):l(void 0,i)}function u(){document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",u),document.removeEventListener("mouseleave",u)}return{handleTrackMousedown:i}}var ge=(0,a.aZ)({props:{paintSize:{type:Object,required:!0},fullSize:{type:Object,required:!0},widthY:{type:Number,default:14},widthX:{type:Number,default:12}},emits:["scroll"],setup(e,t){const l=(0,w.Um)({y:0,x:0});(0,a.YP)((()=>[e.paintSize,e.fullSize]),(()=>{const{paintSize:t,fullSize:n}=e;l.x=Math.max(0,Math.min(l.x,n.width-t.width)),l.y=Math.max(0,Math.min(l.y,n.height-t.height))}),{deep:!0}),(0,a.YP)(l,(()=>{t.emit("scroll",{y:l.y,x:l.x})}));const n=(0,a.Fl)((()=>pe(e.widthY,e.paintSize.height,e.fullSize.height,null,l.y))),o=(0,a.Fl)((()=>pe(e.widthX,e.paintSize.width,e.fullSize.width,n.value,l.x)));function r(t,n){const{paintSize:a,fullSize:o}=e;l.y=Math.max(0,Math.min(l.y+Math.floor(n),o.height-a.height)),l.x=Math.max(0,Math.min(l.x+Math.floor(t),o.width-a.width))}function i(t,n){const{paintSize:a,fullSize:o}=e;void 0!==t&&(l.x=Math.max(0,Math.min(Math.floor(t),o.width-a.width))),void 0!==n&&(l.y=Math.max(0,Math.min(Math.floor(n),o.height-a.height)))}return{scrollbarY:n,scrollbarX:o,scrollPos:(0,w.OT)(l),scrollTo:i,scrollByDelta:r,handleMousedown:ve(r).handleMousedown,handleMousewheel:ye(r).handleMousewheel,handleTrackMousedownY:me(n,"y",i).handleTrackMousedown,handleTrackMousedownX:me(o,"x",i).handleTrackMousedown}}}),be={scrollable:"CanvasScroll_scrollable_2JJue",track:"CanvasScroll_track_2TQj3",y:"CanvasScroll_y_31A4K",x:"CanvasScroll_x_1tP3O",thumb:"CanvasScroll_thumb_3KZWl"};const we=ge.__cssModules={};we["$style"]=be,ge.render=ue;var xe=ge,ke=l(928),Se=l(923),We=l(53);function ze(e,t){for(let l=e.offset;l<e.offset+e.length;++l)t[l]=!0}function _e(e,t,l,n){const a=Math.min(t,l),o=Math.max(t,l);n=n.filter((e=>e.type.byteView&&!e.type.byteView.array));for(let r=a;r<=o;++r)n.some((e=>r>=e.offset&&r<e.offset+e.length))&&(e[r]=!e[r])}function Me(e){e.fill(!1)}function Ce(e){const t=[];let l,n=e.indexOf(!0);if(n<0)return t;for(l=n,t.push([l]),n+=1;n<e.length;++n)if(e[n]){const e=n;e-l===1?t[t.length-1].push(e):t.push([e]),l=e}return t}const je=()=>({byteView:{array:!1}});function Fe(e,t){for(let l=0;l<t.length;){const n=t[l];null!=n.name&&e.some((e=>e>=n.offset&&e<n.offset+n.length))?Te(n,t):l+=1}}function Ie(e,t){const l=Ce(e);if(0===l.length)throw new Error("No bytes selected");if(l.length>1)throw new Error("Cannot create header from non-contiguous selection");const n=l[0];Fe(n,t);const a=t.find((e=>n[0]>=e.offset&&n[0]+n.length<=e.offset+e.length));let o=[{name:null,offset:a.offset,length:n[0]-a.offset,type:je()},{name:"",offset:n[0],length:n.length,type:je(),textLength:11},{name:null,offset:n[0]+n.length,length:a.length-(n[0]-a.offset+n.length),type:je()}];const r=o[1];return o=o.filter((e=>e.length)),t.splice(t.indexOf(a),1,...o),r}function Te(e,t){if(null==e.name)throw new Error("Cannot remove empty header");e.name=null,e.type=je();for(let l=0;l<t.length-1;){const e=$e(t[l],t[l+1]);e?t.splice(l,2,e):l+=1}}function $e(e,t){return null===e.name&&null===t.name?{name:null,offset:e.offset,length:e.length+t.length,type:je()}:null}function He(e,t){const l=(0,ke.qc)(e,t),n={headers:(0,w.XI)(l.rowLength?[{name:null,offset:0,length:l.rowLength,type:je()}]:[]),datFile:l,name:Ee(e),columnStats:(0,w.XI)([]),columnSelection:(0,w.XI)(new Array(l.rowLength).fill(!1)),editHeader:(0,w.XI)(null),selectedRow:(0,w.XI)(null),rowSorting:(0,w.XI)(null),scrollPos:(0,w.Um)({x:0,y:0})};return X(n.datFile).then((async e=>{n.columnStats.value=e;const t=await ee(n.name);try{Pe(t,n)}catch(l){window.alert(`WARN: ${l.message}`)}finally{(0,w.oR)(n.headers)}})),n}function Pe(e,t){let l=0;for(const n of e){const e=n.length||(0,We.getHeaderLength)(n,t.datFile);if(null==n.name){l+=e;continue}const a={...n,length:e,offset:l},o=n.length?t.datFile.rowLength-a.offset>=a.length:(0,Se.A)(a,t.columnStats.value,t.datFile);if(!o)throw new Error("The schema is invalid.");ze(a,t.columnSelection.value);const r=Ie(t.columnSelection.value,t.headers.value);Object.assign(r,a),Me(t.columnSelection.value),l+=e}}function Re(e,t){const l=e.filter((({type:e})=>e.boolean||e.decimal||e.integer||e.key||e.string)).map(((e,l)=>({name:e.name||`Unknown${l+1}`,data:(()=>{var l;const n=(0,ke.Fs)(e,t);if(null===(l=e.type.key)||void 0===l?void 0:l.foreign){if(e.type.array){const e=n;if(!e.every((e=>e.every((e=>0===e.unknown)))))throw new Error("never");return e.map((e=>e.map((e=>e.rid))))}{const e=n;if(!e.every((e=>null==e||0===e.unknown)))throw new Error("never");return e.map((e=>e&&e.rid))}}return n})()})));return l.unshift({name:"_rid",data:Array(t.rowCount).fill(void 0).map(((e,t)=>t))}),Array(t.rowCount).fill(void 0).map(((e,t)=>Object.fromEntries(l.map((e=>[e.name,e.data[t]])))))}function Ee(e){return e.match(/[^/]+(?=\..+$)/)[0]}function Le(e){te(e.name,e.headers.value)}const Oe={class:"flex"},Ye={key:0,class:"text-gray-400 italic px-1.5 self-center"},Ae=(0,a.Wm)("i",{class:"codicon codicon-add"},null,-1),Ve=(0,a.Uk)(" Define column"),Ne=(0,a.Wm)("div",{class:"text-gray-300 px-1.5 mr-1 self-center"},"Selections",-1),De={class:"flex space-x-1"};function qe(e,t,l,n,r,i){return(0,a.wg)(),(0,a.j4)("div",{class:e.$style.bar},[(0,a.Wm)("div",Oe,[0===e.selections.length?((0,a.wg)(),(0,a.j4)("div",Ye,"No bytes selected")):1===e.selections.length?((0,a.wg)(),(0,a.j4)("button",{key:1,class:"hover:bg-gray-300 hover:text-black px-1.5",onClick:t[1]||(t[1]=(...t)=>e.defineColumn&&e.defineColumn(...t))},[Ae,Ve])):e.selections.length>1?((0,a.wg)(),(0,a.j4)(a.HY,{key:2},[Ne,((0,a.wg)(!0),(0,a.j4)(a.HY,null,(0,a.Ko)(e.selections,(e=>((0,a.wg)(),(0,a.j4)("div",{class:"px-1.5 mr-1 font-mono bg-gray-200 text-black flex items-center",textContent:(0,o.zw)(e)},null,8,["textContent"])))),256))],64)):(0,a.kq)("",!0)]),(0,a.Wm)("div",De,[e.rowSorting?((0,a.wg)(),(0,a.j4)("button",{key:0,class:"bg-gray-600 hover:bg-gray-300 hover:text-black px-1.5 border border-gray-500",onClick:t[2]||(t[2]=t=>e.rowSorting=null)},"Reset sorting")):(0,a.kq)("",!0),(0,a.Wm)("button",{class:"hover:bg-gray-300 hover:text-black px-1.5",onClick:t[3]||(t[3]=(...t)=>e.exportDataJson&&e.exportDataJson(...t))},"Export data")])],2)}var Xe=l(162),Be=l.n(Xe),Ue=(0,a.aZ)({setup(){const e=(0,a.f3)("viewer"),t=(0,a.Fl)((()=>Ce(e.columnSelection.value).map((e=>e.map((e=>String(e))).join(" ")))));function l(){const{editHeader:t,columnSelection:l,headers:n}=e;t.value=Ie(l.value,n.value),Me(l.value),(0,w.oR)(n),(0,w.oR)(l),Le(e)}function n(){const t=Re(e.headers.value,e.datFile);Be().saveAs(new File([JSON.stringify(t,null,2)],`${e.name}.json`,{type:"application/json;charset=utf-8"}))}return{viewer:e,rowSorting:e.rowSorting,selections:t,defineColumn:l,exportDataJson:n}}}),Ke={bar:"Actions_bar_3KpDj"};const Ge=Ue.__cssModules={};Ge["$style"]=Ke,Ue.render=qe;var Ze=Ue;const Je={class:"datv-header-layer"},Qe=(0,a.Uk)("Â "),et={key:1,class:"bg-gray-500 text-gray-200 px-1"},tt={key:0,class:"datv-stat__line bg-yellow-500",style:{top:"0"}},lt={key:1,class:"datv-stat__line bg-green-500",style:{top:"7px"}},nt={key:2,class:"datv-stat__line bg-gray-800",style:{top:"14px"}},at={key:3,class:"datv-stat__line bg-pink-400",style:{top:"14px"}};function ot(e,t,l,n,r,i){return(0,a.wg)(),(0,a.j4)("div",Je,[(0,a.Wm)("div",{style:e.headersRowStyle,class:"absolute"},[((0,a.wg)(!0),(0,a.j4)(a.HY,null,(0,a.Ko)(e.headers,(t=>((0,a.wg)(),(0,a.j4)("button",{key:t.offset,class:["datv-header",{"datv-col--border":t.border,"datv-header--active":t.active}],style:{width:t.widthPx+"px",transform:`translate(${t.leftPx}px, 0)`},title:t.name,onClick:l=>e.editHeader(t.offset),onWheel:l=>e.handleHeaderWheel(t.offset,l)},[null===t.name?((0,a.wg)(),(0,a.j4)(a.HY,{key:0},[Qe],64)):""===t.name?((0,a.wg)(),(0,a.j4)("span",et,"?")):((0,a.wg)(),(0,a.j4)(a.HY,{key:2},[(0,a.Uk)((0,o.zw)(t.name),1)],64))],46,["title","onClick","onWheel"])))),128))],4),(0,a.Wm)("div",{style:e.colsRowStyle,class:"absolute"},[((0,a.wg)(!0),(0,a.j4)(a.HY,null,(0,a.Ko)(e.columns,(t=>((0,a.wg)(),(0,a.j4)("button",{key:t.offset,class:["datv-byte",{"datv-col--border":t.border,"datv-byte--selected":t.selected}],style:{width:t.widthPx+"px",transform:`translate(${t.leftPx}px, 0)`},onMousedown:l=>e.selectStart(t.offset),onMouseenter:l=>e.selectContinue(t.offset,l),title:t.offset,textContent:(0,o.zw)(t.text)},null,46,["onMousedown","onMouseenter","title","textContent"])))),128))],4),(0,a.Wm)("div",{style:e.statsRowStyle,class:"absolute datv-stats_row"},[((0,a.wg)(!0),(0,a.j4)(a.HY,null,(0,a.Ko)(e.columns,(e=>((0,a.wg)(),(0,a.j4)("div",{key:e.offset,class:["datv-stat",{"datv-col--border":e.border,"datv-byte--selected":e.selected}],style:{width:e.widthPx+"px",transform:`translate(${e.leftPx}px, 0)`}},[e.stat?((0,a.wg)(),(0,a.j4)(a.HY,{key:0},[e.stat.string?((0,a.wg)(),(0,a.j4)("div",tt)):(0,a.kq)("",!0),e.stat.array?((0,a.wg)(),(0,a.j4)("div",lt)):(0,a.kq)("",!0),e.stat.zero?((0,a.wg)(),(0,a.j4)("div",nt)):e.stat.nullable?((0,a.wg)(),(0,a.j4)("div",at)):(0,a.kq)("",!0),(0,a.Wm)("div",{class:"datv-stat__max",textContent:(0,o.zw)(e.stat.max)},null,8,["textContent"])],64)):(0,a.kq)("",!0)],6)))),128))],4)])}function rt(e,t,l){const n=(0,ke.Fs)(e,l),a=Array.from({length:l.rowCount},((e,t)=>t));return e.type.array?a.sort(((e,l)=>{const a=n[e],o=n[l];return(o.length-a.length)*t})):e.type.boolean?a.sort(((e,l)=>{const a=Number(n[e]),o=Number(n[l]);return(a-o)*t})):e.type.string?a.sort(((e,l)=>{const a=n[e],o=n[l];return a.localeCompare(o)*t})):e.type.integer||e.type.decimal?a.sort(((e,l)=>{const a=n[e],o=n[l];return(o-a)*t})):e.type.key&&(e.type.key.foreign?a.sort(((e,l)=>{const a=n[e],o=n[l];return(((null===o||void 0===o?void 0:o.rid)||0)-((null===a||void 0===a?void 0:a.rid)||0))*t})):a.sort(((e,l)=>{const a=Number(n[e]),o=Number(n[l]);return(o-a)*t}))),a}var it=l(236);function st(e,t){t.text=String(e),t.color="#098658"}function ut(e,t){t.text=`[${e.join(", ")}]`,t.color="#098658"}function ct(e,t){t.text=String(e),t.color="#0000ff"}function dt(e,t){t.text=`[${e.join(", ")}]`,t.color="#0000ff"}function ft(e,t){""===e?(t.text="null",t.color="#0000ff"):(t.text=String(e),t.color="#001080")}function ht(e,t){t.text=`[${e.map((e=>'"'+e+'"')).join(", ")}]`,t.color="#001080"}function pt(e,t){null===e?(t.text="null",t.color="#0000ff"):(t.text=`<${e}, self>`,t.color="#098658")}function vt(e,t){t.text=`[${e.map((e=>`<${e}, self>`)).join(", ")}]`,t.color="#098658"}function yt(e,t){null===e?(t.text="null",t.color="#0000ff"):(t.text=`<${e.rid}, ${e.unknown}>`,t.color="#098658")}function mt(e,t){t.text=`[${e.map((e=>`<${e.rid}, ${e.unknown}>`)).join(", ")}]`,t.color="#098658"}function gt(e,t,l,n){const a=(0,it.getFieldReader)(t,l),o={text:"",color:""},r=(()=>{if(t.type.array){if(t.type.boolean)return dt;if(t.type.string)return ht;if(t.type.integer||t.type.decimal)return ut;if(t.type.key&&t.type.key.foreign)return mt;if(t.type.key&&!t.type.key.foreign)return vt}else{if(t.type.boolean)return ct;if(t.type.string)return ft;if(t.type.integer||t.type.decimal)return st;if(t.type.key&&t.type.key.foreign)return yt;if(t.type.key&&!t.type.key.foreign)return pt}throw new Error("never")})();let i=0,s="";for(const u of n)r(a(u),o),s!==o.color&&(e.fillStyle=o.color,s=o.color),e.fillText(o.text,0,i),i+=zt}function bt(e,t,l,n,a,o){e.fillStyle="#000";let r=0;for(const i of n){const n=l.dataFixed.subarray(i*l.rowLength+t.offset+a,i*l.rowLength+t.offset+o),s=Array.from(n,(e=>e.toString(16).padStart(2,"0"))).join(" ");e.fillText(s,a*(3*St),r),r+=zt}}function wt(e,t,l,n,a){e.fillStyle="#000";const o=a.refArray,r=Math.max(o.keyForeign?l.fieldSize.KEY_FOREIGN:0,o.keySelf?l.fieldSize.KEY:0,o.string?l.fieldSize.STRING:0,o.longLong?l.fieldSize.LONGLONG:0,o.long?l.fieldSize.LONG:0,o.short?l.fieldSize.SHORT:0,l.fieldSize.BYTE),i=Math.ceil(t.textLength/3);let s=0;for(const u of n){const n=l.readerFixed.getSizeT(u*l.rowLength+t.offset);if(0===n)e.fillText("[]",0,s);else{const a=l.readerFixed.getSizeT(u*l.rowLength+t.offset+l.memsize),o=l.dataVariable.subarray(a,a+Math.min(r*n,i)),c=Array.from(o,(e=>e.toString(16).padStart(2,"0"))).join(" ");e.fillText(`${n} { ${c} }`,0,s)}s+=zt}}const xt='Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',kt=14,St=Ht(kt,xt),Wt=Pt(kt,xt),zt=19,_t=3,Mt=1,Ct=7,jt=Math.round(3*St),Ft=2*jt+3*Ct;function It(e){const t=String(e-1).length;return Math.max(t,_t)}function Tt(e){return Math.ceil(It(e)*St)}function $t(e){return Tt(e)+16}function Ht(e,t){const l=document.createElement("canvas"),n=l.getContext("2d");n.font=`${e}px ${t}`;const a=n.measureText("0");return a.width}function Pt(e,t){const l=document.createElement("canvas"),n=l.getContext("2d");n.font=`${e}px ${t}`,n.textBaseline="middle";const a=n.measureText("0"),o=e/2+(void 0!==a.alphabeticBaseline?-a.alphabeticBaseline:a.actualBoundingBoxDescent);return o}function Rt(e){return 1+(e-kt)/2+Wt}function Et(e){const{ctx:t}=e;if(t.fillStyle="#fff",t.fillRect(0,0,t.canvas.width,t.canvas.height),null!==e.viewer.selectedRow.value){const l=e.rows.indexOf(e.viewer.selectedRow.value);-1!==l&&(t.fillStyle="#bee3f8",t.fillRect(0,e.top+l*zt,t.canvas.width,zt))}t.save(),t.translate(-e.left,0),Lt(t,e.columns),t.restore(),t.font=`${kt}px ${xt}`,t.fillStyle="#000";const l=Ot(e.viewer,e.left,e.left+e.paintWidth);for(const n of l)t.save(),t.beginPath(),t.translate(n.left-e.left,0),t.rect(0,0,n.width,t.canvas.height),t.clip(),t.translate(St/2,e.top+Rt(zt)),n.exec(t,e.rows),t.restore();{const e=t.createLinearGradient(0,-16,0,4);e.addColorStop(0,"rgba(254,254,254,0.6)"),e.addColorStop(1,"transparent"),t.fillStyle=e,t.fillRect(0,0,t.canvas.width,6);const l=t.createLinearGradient(-16,0,4,0);l.addColorStop(0,"rgba(254,254,254,0.5)"),l.addColorStop(1,"transparent"),t.fillStyle=l,t.fillRect(0,0,6,t.canvas.height)}}function Lt(e,t){for(const l of t)l.selected&&(e.fillStyle="#bee3f8",e.fillRect(l.leftPx+(l.border?Mt:0),0,l.widthPx,e.canvas.height)),l.border&&(e.fillStyle="#bdbdbd",e.fillRect(l.leftPx,0,Mt,e.canvas.height))}function Ot(e,t,l){const n=e.headers.value,a=e.columnStats.value,o=e.datFile,r=[];let i=0;for(const s of n){const e=Yt(s);if(i+e.borderWidth>=t)if(s.type.byteView)if(s.type.byteView.array)r.push({left:i+(e.borderWidth?Mt:0),width:e.paddingWidth,exec:(e,t)=>wt(e,s,o,t,a[s.offset])});else{const n=Math.max(0,Math.floor((t-i)/(3*St))),a=Math.min(s.length,Math.ceil((l-i)/(3*St)));r.push({left:i+(e.borderWidth?Mt:0),width:e.paddingWidth,exec:(e,t)=>bt(e,s,o,t,n,a)})}else r.push({left:i+(e.borderWidth?Mt:0),width:e.paddingWidth,exec:(e,t)=>gt(e,s,o,t)});if(i+=e.borderWidth,i>=l)return r}return r}function Yt(e){const t=e.type.byteView&&!e.type.byteView.array?3*e.length-1:e.textLength;return{paddingWidth:Math.ceil((t+1)*St),borderWidth:Math.ceil((t+1)*St)+(e.offset>0?Mt:0),hasBorder:e.offset>0}}function At(e){let t=0;for(const l of e){const e=Yt(l);t+=e.borderWidth}return t}function Vt(e,t,l,n){const a=[];let o=0;for(const r of e){const e=Yt(r);if(o+e.borderWidth>=l&&a.push({offset:r.offset,border:e.hasBorder,active:r===t,widthPx:e.borderWidth,leftPx:o,name:r.name}),o+=e.borderWidth,o>=n)return a}return a}var Nt=(0,a.aZ)({props:{left:{type:Number,required:!0},width:{type:Number,required:!0},columns:{type:Array,required:!0}},setup(e){const t=(0,w.XI)(0);let l=-1,n=[];const o=(0,a.f3)("viewer");function r(e){function t(){l=-1,document.removeEventListener("mouseup",t),document.removeEventListener("mouseleave",t)}l=e,n=[...o.columnSelection.value],_e(o.columnSelection.value,l,l,o.headers.value),(0,w.oR)(o.columnSelection),document.addEventListener("mouseup",t),document.addEventListener("mouseleave",t)}function i(e,t){if(-1===l||1!==t.buttons)return;const{memsize:a}=o.datFile,r=e-l;r>=a?e=l+2*a-1:r>=4?e=l+8-1:r>=2&&(e=l+4-1),r<=-a?e=l-2*a+1:r<=-4?e=l-8+1:r<=-2&&(e=l-4+1),o.columnSelection.value=[...n],_e(o.columnSelection.value,l,e,o.headers.value)}function s(e){const l=o.headers.value.find((t=>t.offset===e));o.editHeader.value!==l||l.type.byteView&&!l.type.byteView.array?(o.editHeader.value=l,t.value=0):(0===t.value?t.value=1:1===t.value?t.value=-1:-1===t.value&&(t.value=1),o.rowSorting.value=rt(l,t.value,o.datFile))}function u(e,t){t.preventDefault();const l=o.headers.value.find((t=>t.offset===e));null!=l.textLength&&(l.textLength=Math.max(1,l.textLength-Math.sign(t.deltaY)*(t.ctrlKey?10:1)),(0,w.oR)(o.headers),Le(o))}const c=(0,a.Fl)((()=>Vt(o.headers.value,o.editHeader.value,e.left,e.left+e.width)));return{headers:c,selectStart:r,selectContinue:i,editHeader:s,handleHeaderWheel:u,headersRowStyle:(0,a.Fl)((()=>({transform:`translate(${-e.left}px, 0)`,lineHeight:jt+"px",fontFamily:xt,fontSize:kt+"px"}))),colsRowStyle:(0,a.Fl)((()=>({transform:`translate(${-e.left}px, ${jt}px)`,lineHeight:jt+"px",fontFamily:xt,fontSize:kt+"px"}))),statsRowStyle:(0,a.Fl)((()=>({transform:`translate(${-e.left}px, ${2*jt}px)`,fontFamily:xt,fontSize:kt+"px"})))}}});Nt.render=ot;var Dt=Nt;const qt={key:0,style:{width:"300px"},class:"relative overflow-hidden"},Xt={class:"m-2 shadow border border-gray-300 bg-white absolute inset-0 flex flex-col"},Bt={class:"p-2 bg-gray-100 text-gray-600 shadow flex items-baseline"},Ut=(0,a.Wm)("span",{class:"px-2"},"Column properties",-1),Kt=(0,a.Wm)("i",{class:"codicon codicon-close"},null,-1),Gt={key:0,class:"p-4"},Zt={key:1,class:"p-4 overflow-auto"},Jt={class:"mb-4"},Qt=(0,a.Wm)("label",{for:"datv-header-name"},"Name",-1),el={class:"mb-4 flex items-baseline"},tl=(0,a.Wm)("div",{class:"mr-2"},"View mode",-1),ll={class:"space-x-px flex"},nl={class:"mb-4"},al={class:"mb-2 flex justify-between items-baseline"},ol=(0,a.Wm)("span",null,"Data type",-1),rl={class:"inline-flex items-center"},il={class:"ml-2 cursor-pointer"},sl={key:0,class:"mt-3"},ul=(0,a.Wm)("div",{class:"mb-1"},"of ...",-1),cl={class:"inline-flex items-center"},dl={class:"ml-2 cursor-pointer"},fl={key:0,class:"mb-4"},hl={class:"inline-flex items-center"},pl=(0,a.Wm)("span",{class:"ml-2 cursor-pointer"},"Unsigned",-1),vl={key:1,class:"mb-4 border-t pt-4"},yl=(0,a.Wm)("label",{class:"mr-4"},"Width",-1),ml=(0,a.Uk)(" chars ");function gl(e,t,l,r,i,s){return e.isVisible?((0,a.wg)(),(0,a.j4)("div",qt,[(0,a.Wm)("div",{style:{height:e.HEADERS_HEIGHT+"px"},class:"bg-gray-100"},null,4),(0,a.Wm)("div",Xt,[(0,a.Wm)("div",Bt,[Ut,(0,a.Wm)("button",{class:"border border-gray-400 rounded-full px-3",onClick:t[1]||(t[1]=t=>e.$emit("focus-editing-header"))},"Focus"),(0,a.Wm)("button",{onClick:t[2]||(t[2]=(...t)=>e.close&&e.close(...t)),class:"px-2 py-1 ml-auto",title:"Close"},[Kt])]),null===e.header.name?((0,a.wg)(),(0,a.j4)("div",Gt,[(0,a.Wm)("div",null,(0,o.zw)(e.header.length)+" bytes of unidentified data",1)])):((0,a.wg)(),(0,a.j4)("div",Zt,[(0,a.Wm)("div",Jt,[Qt,(0,a.wy)((0,a.Wm)("input",{id:"datv-header-name",placeholder:"Unnamed","onUpdate:modelValue":t[3]||(t[3]=t=>e.header.name=t),class:"border p-1 mt-1 w-full focus:border-blue-500",spellcheck:"false"},null,512),[[n.nr,e.header.name,void 0,{trim:!0}]])]),(0,a.Wm)("div",el,[tl,(0,a.Wm)("div",ll,[((0,a.wg)(!0),(0,a.j4)(a.HY,null,(0,a.Ko)(e.viewModeOpts,(t=>((0,a.wg)(),(0,a.j4)("button",{key:t.value,class:["px-2",e.byteViewMode===t.value?"bg-blue-600 text-white":"bg-gray-100 hover:bg-gray-300"],onClick:l=>e.byteViewMode=t.value,disabled:t.disabled,textContent:(0,o.zw)(t.label)},null,10,["onClick","disabled","textContent"])))),128))])]),(0,a.Wm)("div",nl,[(0,a.Wm)("div",al,[ol,(0,a.Wm)("button",{class:"text-red-700 bg-red-100 px-2",onClick:t[4]||(t[4]=(...t)=>e.remove&&e.remove(...t))},"Delete")]),(0,a.Wm)("div",null,[((0,a.wg)(!0),(0,a.j4)(a.HY,null,(0,a.Ko)(e.dataTypeOpts,(l=>((0,a.wg)(),(0,a.j4)("div",{key:l.value,class:"mb-0.5"},[(0,a.Wm)("label",rl,[(0,a.wy)((0,a.Wm)("input",{type:"radio","onUpdate:modelValue":t[5]||(t[5]=t=>e.dataType=t),value:l.value},null,8,["value"]),[[n.G2,e.dataType]]),(0,a.Wm)("span",il,(0,o.zw)(l.label),1)])])))),128)),e.arrayTypeOpts.length?((0,a.wg)(),(0,a.j4)("div",sl,[ul,((0,a.wg)(!0),(0,a.j4)(a.HY,null,(0,a.Ko)(e.arrayTypeOpts,(l=>((0,a.wg)(),(0,a.j4)("div",{key:l.value,class:"mb-0.5"},[(0,a.Wm)("label",cl,[(0,a.wy)((0,a.Wm)("input",{type:"radio","onUpdate:modelValue":t[6]||(t[6]=t=>e.arrayType=t),value:l.value},null,8,["value"]),[[n.G2,e.arrayType]]),(0,a.Wm)("span",dl,(0,o.zw)(l.label),1)])])))),128))])):(0,a.kq)("",!0)])]),e.header.type.integer?((0,a.wg)(),(0,a.j4)("div",fl,[(0,a.Wm)("label",hl,[(0,a.wy)((0,a.Wm)("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=t=>e.header.type.integer.unsigned=t)},null,512),[[n.e8,e.header.type.integer.unsigned]]),pl])])):(0,a.kq)("",!0),e.dataType?((0,a.wg)(),(0,a.j4)("div",vl,[yl,(0,a.wy)((0,a.Wm)("input",{"onUpdate:modelValue":t[8]||(t[8]=t=>e.header.textLength=t),class:"border w-16 text-center"},null,512),[[n.nr,e.header.textLength,void 0,{number:!0}]]),ml])):(0,a.kq)("",!0)]))])])):(0,a.kq)("",!0)}function bl(e,t,l){const n=[],{fieldSize:a}=l,o=e.length;return o===a.ARRAY&&t.refArray&&n.push({label:"Array",value:"array"}),o===a.STRING&&t.refString&&n.push({label:"String",value:"string"}),o===a.KEY&&t.keySelf&&n.push({label:"Key (self)",value:"key_self"}),o===a.KEY_FOREIGN&&n.push({label:"Key (foreign)",value:"key_foreign"}),8!==o&&4!==o&&2!==o&&1!==o||n.push({label:"Integer",value:"integer"}),8!==o&&4!==o||n.push({label:"Decimal",value:"decimal"}),1===o&&t.bMax<=1&&n.push({label:"Boolean",value:"boolean"}),n}function wl(e,t){const l=[];if(!e.type.array||!t.refArray)return l;const n=t.refArray;return n.string&&l.push({label:"String",value:"string"}),n.keySelf&&l.push({label:"Key (self)",value:"key_self"}),n.keyForeign&&l.push({label:"Key (foreign)",value:"key_foreign"}),n.longLong&&l.push({label:"Integer - 8 bytes",value:"integer_8"}),n.long&&l.push({label:"Integer - 4 bytes",value:"integer_4"}),n.short&&l.push({label:"Integer - 2 bytes",value:"integer_2"}),n.longLong&&l.push({label:"Decimal - 8 bytes",value:"decimal_8"}),n.long&&l.push({label:"Decimal - 4 bytes",value:"decimal_4"}),n.boolean&&l.push({label:"Boolean",value:"boolean"}),l.push({label:"Integer - byte",value:"integer_1"}),l}var xl=(0,a.aZ)({setup(){const e=(0,a.f3)("viewer"),t=(0,a.Fl)((()=>e.editHeader.value&&(0,w.qj)(e.editHeader.value)));{let l=null;(0,a.YP)(t,(t=>{l&&(l(),l=null),t&&(l=(0,a.YP)(t,(()=>{(0,w.oR)(e.headers),Le(e)}),{deep:!0}))}))}const l=(0,a.Fl)((()=>e.columnStats.value[t.value.offset])),n=(0,a.Fl)({get(){const e=t.value.type;return e.array?"array":e.string?"string":e.key?e.key.foreign?"key_foreign":"key_self":e.integer?"integer":e.decimal?"decimal":e.boolean?"boolean":void 0},set(e){const l=t.value;l.type={},"array"===e?(l.type.array=!0,l.type.byteView={array:!0}):"string"===e?l.type.string={}:"key_foreign"===e?l.type.key={foreign:!0}:"key_self"===e?l.type.key={foreign:!1}:"integer"===e?l.type.integer={unsigned:!1,size:l.length}:"decimal"===e?l.type.decimal={size:l.length}:"boolean"===e&&(l.type.boolean={})}}),o=(0,a.Fl)({get(){const e=t.value.type;return e.string?"string":e.key?e.key.foreign?"key_foreign":"key_self":e.integer?`integer_${e.integer.size}`:e.decimal?`decimal_${e.decimal.size}`:e.boolean?"boolean":void 0},set(e){const l=t.value;l.type={array:!0},"string"===e?l.type.string={}:"key_foreign"===e?l.type.key={foreign:!0}:"key_self"===e?l.type.key={foreign:!1}:"integer_1"===e?l.type.integer={unsigned:!1,size:1}:"integer_2"===e?l.type.integer={unsigned:!1,size:2}:"integer_4"===e?l.type.integer={unsigned:!1,size:4}:"integer_8"===e?l.type.integer={unsigned:!1,size:8}:"decimal_4"===e?l.type.decimal={size:4}:"decimal_8"===e?l.type.decimal={size:8}:"boolean"===e&&(l.type.boolean={})}}),r=(0,a.Fl)((()=>{const e=[],l=t.value.type;return e.push({label:"Bytes",value:"bytes"}),l.array&&e.push({label:"Var. bytes",value:"array-bytes"}),e.push({label:"Data",value:"data",disabled:!n.value||"array"===n.value&&!o.value}),e})),i=(0,a.Fl)({get(){const e=t.value.type;return e.byteView?e.byteView.array?"array-bytes":"bytes":"data"},set(e){const l=t.value.type;l.byteView="data"===e?void 0:{array:"array-bytes"===e}}});function s(){e.editHeader.value=null}function u(){Te(t.value,e.headers.value),e.editHeader.value=null,(0,w.oR)(e.headers),Le(e)}return{isVisible:(0,a.Fl)((()=>null!=e.editHeader.value)),HEADERS_HEIGHT:Ft,header:t,byteViewMode:i,dataType:n,arrayType:o,close:s,remove:u,viewModeOpts:r,dataTypeOpts:(0,a.Fl)((()=>bl(t.value,l.value,e.datFile))),arrayTypeOpts:(0,a.Fl)((()=>wl(t.value,l.value)))}}});xl.render=gl;var kl=xl;const Sl=Math.ceil(3*St);function Wl(e,t,l,n,a){const o=[];let r=0;for(const i of l){const l=Yt(i);if(i.type.byteView&&!i.type.byteView.array){let s=r;for(let r=0;r<i.length;++r){const u=l.hasBorder&&0===r,c=3*St+(u?Mt:0);if(Math.ceil(s)+c<n){s+=c;continue}const d=i.offset+r;if(o.push({offset:d,selected:e[d],border:u,widthPx:Sl,leftPx:Math.ceil(s),text:String(d%100).padStart(2,"0"),stat:t[d]}),s+=c,Math.ceil(s)>=a)return o}}else r+l.borderWidth>=n&&o.push({offset:i.offset,selected:!1,border:l.hasBorder,widthPx:l.paddingWidth,leftPx:r,text:String(i.offset%100).padStart(2,"0")});if(r+=l.borderWidth,r>=a)return o}return o}function zl(e,t){const l=e.map((e=>({max:e.bMax.toString(16).padStart(2,"0"),array:!1,string:!1,nullable:!1,zero:0===e.bMax}))),{fieldSize:n}=t;for(let a=0;a<e.length;++a){const o=e[a];if(o.refString)for(let e=0;e<n.STRING;++e)l[a+e].string=!0;if(o.refArray)for(let e=0;e<n.ARRAY;++e)l[a+e].array=!0;if(o.nullableMemsize)for(let e=0;e<t.memsize;++e)l[a+e].nullable=!0}return l}var _l=(0,a.aZ)({components:{ResizeObserver:se,CanvasScroll:xe,ViewerActions:Ze,ViewerHead:Dt,HeaderProps:kl},emits:["update:kaState"],props:{args:{type:Object,required:!0},kaState:{type:Object,default:void 0}},setup(e,t){let l;e.kaState?l=e.kaState:(l=He(e.args.fullPath,e.args.fileContent),t.emit("update:kaState",l)),(0,a.JJ)("viewer",l);const n=(0,w.iH)(null),o=(0,w.iH)(null);(0,a.bv)((()=>{o.value.scrollTo(l.scrollPos.x,l.scrollPos.y)}));const r=(0,a.Fl)((()=>l.rowSorting.value?l.rowSorting.value:Array.from({length:l.datFile.rowCount},((e,t)=>t)))),i=(0,w.iH)(0),s=(0,w.iH)(0);function u(e){i.value=e.width,s.value=e.height}const{scrollPos:c}=l;function d(e){c.x=e.x,c.y=e.y}const f=(0,a.Fl)((()=>At(l.headers.value))),h=(0,a.Fl)((()=>l.datFile.rowCount*zt)),p=(0,a.Fl)((()=>$t(l.datFile.rowCount))),v=(0,a.Fl)((()=>Math.max(0,i.value-p.value))),y=(0,a.Fl)((()=>Math.max(0,s.value-Ft)));(0,a.YP)([v,y],(()=>{const e=window.devicePixelRatio;n.value.style.width=v.value+"px",n.value.style.height=y.value+"px",n.value.width=v.value*e,n.value.height=y.value*e;const t=n.value.getContext("2d",{alpha:!1});t.scale(e,e),b()}));const m=(0,a.Fl)((()=>zl(l.columnStats.value,l.datFile))),g=(0,a.Fl)((()=>Wl(l.columnSelection.value,m.value,l.headers.value,c.x,c.x+Math.min(f.value,v.value))));function b(){const e=n.value.getContext("2d",{alpha:!1});Et({left:c.x,paintWidth:v.value,top:x.value.top,rows:x.value.ids,columns:g.value,viewer:l,ctx:e})}(0,a.YP)([c,g,r,l.selectedRow],(()=>{b()}));const x=(0,a.Fl)((()=>{const e=c.y,t=Math.ceil(y.value/zt)+1,l=Math.floor(e/zt),n=l*zt-e;return{top:n,ids:r.value.slice(l,l+t)}}));function k(){const e=l.editHeader.value,t=Vt(l.headers.value,null,0,1/0),n=t.find((t=>t.offset===e.offset));o.value.scrollTo(n.leftPx-.33*v.value,void 0)}function S(e){const{selectedRow:t}=l,n=Math.floor((e.offsetY+c.y)/zt),a=r.value[n];t.value=t.value!==a?a:null}return{headerBlockStyle:(0,a.Fl)((()=>({height:Ft+"px",width:i.value+"px"}))),headerOverlayContentStyle:(0,a.Fl)((()=>({left:p.value+"px",height:Ft+"px",width:v.value+"px"}))),scrollableStyle:(0,a.Fl)((()=>({top:Ft+"px",left:p.value+"px"}))),scrollablePaintSize:(0,a.Fl)((()=>({width:v.value,height:y.value}))),scrollableFullSize:(0,a.Fl)((()=>({width:f.value,height:h.value}))),rowsOverlayStyle:(0,a.Fl)((()=>({top:Ft+"px",width:p.value+"px",height:y.value+"px",fontFamily:xt,fontSize:kt+"px",lineHeight:zt+"px"}))),handleScroll:d,handleResize:u,renderItems:x,canvasRef:n,renderColumns:g,scrollLeft:(0,a.Fl)((()=>c.x)),rowsWidth:(0,a.Fl)((()=>Math.min(f.value,v.value))),LINE_HEIGHT:zt,canvasScroll:o,rowsNumberWidth:Tt(l.datFile.rowCount)+"px",focusEditingHeader:k,handleCanvasClick:S}}}),Ml={rowsOverlay:"DatViewer_rowsOverlay_10_gM"};const Cl=_l.__cssModules={};Cl["$style"]=Ml,_l.render=oe;var jl=_l,Fl=(0,a.aZ)({setup(){const e=(0,w.XI)(localStorage.getItem("POE_PATCH_VER")||""),t=(0,w.XI)(!1),l=(0,w.XI)(!1);async function n(e){const t=e.target.files[0],l=new Uint8Array(await t.arrayBuffer()),n=t.name;El({id:`file@${n}`,title:n,type:jl,args:{fileContent:l,fullPath:n}})}async function a(){let l;try{t.value=!0,l=await O(e.value,"_.index.bin")}finally{t.value=!1}try{await G(l),localStorage.setItem("POE_PATCH_VER",e.value)}catch(n){throw window.alert(n.message),n}}async function o(){l.value=!0;const e=await fetch("https://poe-bundles.snos.workers.dev/schema.min.json"),t=await e.json();t.version===R.SCHEMA_VERSION?J.value=t.tables:console.warn("Latest schema version is not supported."),l.value=!1}return e.value&&!U.value&&a(),J.value.length||o(),{poePatch:e,isCdnImportRunning:t,isFetchingSchema:l,handleFile:n,cdnImport:a}}}),Il={input:"ImportDialog_input_1F68e",label:"ImportDialog_label_3GNMX"};const Tl=Fl.__cssModules={};Tl["$style"]=Il,Fl.render=P;var $l=Fl;const Hl=(0,w.XI)("poe-dat-viewer@import");function Pl(e){Hl.value=e}const Rl=(0,w.XI)([{id:"poe-dat-viewer@import",title:"Import",type:$l,args:void 0,kaState:void 0}]);function El(e){const t=Rl.value.find((t=>t.id===e.id));t||Rl.value.push({id:e.id,title:e.title,type:e.type,args:e.args,kaState:void 0}),Pl(e.id),(0,w.oR)(Rl)}function Ll(e){const t=Rl.value.findIndex((t=>t.id===e));e===Hl.value&&(t+1<Rl.value.length?Pl(Rl.value[t+1].id):Pl(0!==t?Rl.value[t-1].id:null)),Rl.value=Rl.value.filter((t=>t.id!==e))}var Ol=(0,a.aZ)({setup(){const e=(0,a.Fl)((()=>Rl.value.map((e=>({id:e.id,title:e.title,isActive:e.id===Hl.value})))));function t(){El({id:"poe-dat-viewer@import",title:"Import",type:$l,args:void 0})}return{tabs:e,setActiveTab:Pl,closeTab:Ll,openImport:t}}}),Yl={titlebar:"Tabs_titlebar_3NzUh",tab:"Tabs_tab_1nc-U",active:"Tabs_active_1pZ1q"};const Al=Ol.__cssModules={};Al["$style"]=Yl,Ol.render=b;var Vl=Ol;const Nl={class:"flex p-1 items-center mb-px"},Dl=(0,a.Wm)("i",{class:"codicon codicon-list-flat"},null,-1),ql={key:0,class:"flex gap-x-1 border-b pb-1.5 px-2 justify-end"},Xl={key:1,class:"italic text-center text-gray-500 p-2"},Bl={key:2,class:"italic text-center text-gray-500 p-2"},Ul={key:0,class:"codicon codicon-folder pr-3"};function Kl(e,t,l,r,i,s){const u=(0,a.up)("virtual-scroll");return(0,a.wg)(),(0,a.j4)("div",{class:"layout-column flex-shrink-0",style:{width:e.showTree?"300px":void 0}},[(0,a.Wm)("div",Nl,[(0,a.Wm)("button",{title:"Toggle tree visibility",class:e.$style.treeToggle,onClick:t[1]||(t[1]=(...t)=>e.toggleTree&&e.toggleTree(...t))},[Dl],2),e.showTree?(0,a.wy)(((0,a.wg)(),(0,a.j4)("input",{key:0,"onUpdate:modelValue":t[2]||(t[2]=t=>e.searchText=t),placeholder:"Search in current folder",class:e.$style.searchInput,type:"search",spellcheck:"false"},null,2)),[[n.nr,e.searchText,void 0,{trim:!0}]]):(0,a.kq)("",!0)]),e.showTree?((0,a.wg)(),(0,a.j4)(a.HY,{key:0},[e.extensionOpts?((0,a.wg)(),(0,a.j4)("div",ql,[((0,a.wg)(!0),(0,a.j4)(a.HY,null,(0,a.Ko)(e.extensionOpts,(e=>((0,a.wg)(),(0,a.j4)("button",{key:e.value,onClick:e.handleClick,class:["px-2",e.active?"bg-gray-200":"hover:bg-gray-100"],textContent:(0,o.zw)(e.value)},null,10,["onClick","textContent"])))),128))])):(0,a.kq)("",!0),e.isIndexLoaded?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)("div",Xl,"Waiting for Index bundle...")),e.isIndexLoaded&&!e.tree.length?((0,a.wg)(),(0,a.j4)("div",Bl,"No results found")):(0,a.kq)("",!0),(0,a.Wm)(u,{class:"flex-1","scrollable-props":{style:"background: #fff;",widthY:10},items:e.tree,"item-height":22},{default:(0,a.w5)((t=>[((0,a.wg)(!0),(0,a.j4)(a.HY,null,(0,a.Ko)(t.entries,(t=>((0,a.wg)(),(0,a.j4)("button",{key:t.item.fullPath,class:{[e.$style.itemBtn]:!0,[e.$style.active]:t.item.isActive},style:{transform:`translate(0, ${t.top}px`},onClick:l=>e.handleTreeNav(t.item)},[t.item.isFile?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)("i",Ul)),(0,a.Uk)((0,o.zw)(t.item.label),1)],14,["onClick"])))),128))])),_:1},8,["items"])],64)):(0,a.kq)("",!0)],4)}function Gl(e,t,l,n,o,r){const i=(0,a.up)("canvas-scroll"),s=(0,a.up)("resize-observer");return(0,a.wg)(),(0,a.j4)(s,{onResize:e.handleResize,class:"relative"},{default:(0,a.w5)((()=>[(0,a.Wm)(i,(0,a.dG)({ref:"scrollable"},e.scrollableProps,{class:"absolute","paint-size":e.paintSize,"full-size":e.fullSize}),{default:(0,a.w5)((()=>[(0,a.WI)(e.$slots,"default",{entries:e.renderItems})])),_:3},16,["paint-size","full-size"])])),_:1},8,["onResize"])}var Zl=(0,a.aZ)({components:{ResizeObserver:se,CanvasScroll:xe},props:{items:{type:Array,required:!0},itemHeight:{type:Number,required:!0},scrollableProps:{type:Object,default:()=>({})}},setup(e){const t=(0,w.Um)({width:0,height:0}),l=(0,a.Fl)((()=>({width:t.width,height:e.items.length*e.itemHeight})));function n(e){t.width=e.width,t.height=e.height}const o=(0,w.iH)(null),r=(0,a.Fl)((()=>{var l,n;const a=null!==(n=null===(l=o.value)||void 0===l?void 0:l.scrollPos.y)&&void 0!==n?n:0,r=Math.ceil(t.height/e.itemHeight)+1,i=Math.floor(a/e.itemHeight),s=i*e.itemHeight-a;return e.items.slice(i,i+r).map(((t,l)=>({top:s+l*e.itemHeight,item:t})))}));return{handleResize:n,paintSize:t,fullSize:l,scrollable:o,renderItems:r}}});Zl.render=Gl;var Jl=Zl,Ql=l(573);function en(){return Date.now()}function tn(e,t){const l=Date.now()-t;console.log(`${e}. Done in -> ${l} ms`)}function ln(e,t){const l=en(),n=t();return tn(e,l),n}function nn(){const e=(0,w.XI)("");(0,a.YP)(U,(()=>{e.value=""}));const t=(0,a.Fl)((()=>{if(!U.value)return[];if(""===e.value){const e=ln("Getting root dirs",(()=>(0,Ql.CI)(U.value.pathReps,U.value.dirsInfo)));return e.map((e=>({label:e,fullPath:e,isFile:!1}))).sort(((e,t)=>e.label.localeCompare(t.label)))}const t=ln(`Getting "${e.value}" dir`,(()=>(0,Ql.wl)(e.value,U.value.pathReps,U.value.dirsInfo)));return[{label:"../",fullPath:-1===e.value.indexOf("/")?"":e.value.split("/").slice(0,-1).join("/"),isFile:!1},...t.dirs.map((t=>({label:t.substr(e.value.length+1),fullPath:t,isFile:!1}))).sort(((e,t)=>e.label.localeCompare(t.label))),...t.files.map((t=>({label:t.substr(e.value.length+1),fullPath:t,isFile:!0,isActive:`bundles@${t}`===Hl.value}))).sort(((e,t)=>e.label.localeCompare(t.label)))]}));async function l(t){if(t.isFile){const e=await K(t.fullPath);t.fullPath.endsWith(".dat")||t.fullPath.endsWith(".dat64")?El({id:`bundles@${t.fullPath}`,title:t.label,type:jl,args:{fileContent:e,fullPath:t.fullPath}}):Be().saveAs(new File([e],t.fullPath.substring(t.fullPath.lastIndexOf("/")+1),{type:"application/octet-stream"}))}else e.value=t.fullPath}return{currentDir:e,tree:t,handleTreeNav:l}}var an=(0,a.aZ)({components:{VirtualScroll:Jl},setup(){const e=(0,w.XI)(!0);function t(){e.value=!e.value}const l=(0,a.Fl)((()=>Boolean(U.value))),{tree:n,handleTreeNav:o,currentDir:r}=nn(),i=(0,w.XI)(".dat64"),s=(0,a.Fl)((()=>r.value.startsWith("Data")?[".dat",".dat64",".datl",".datl64"].map((e=>({value:e,active:i.value===e,handleClick:()=>{i.value=e}}))):null)),u=(0,w.XI)(""),c=(0,a.Fl)((()=>{const e=u.value.toLowerCase(),t=s.value?i.value:"";return n.value.filter((l=>l.label.toLowerCase().includes(e)&&(!l.isFile||l.label.endsWith(t))))}));return{showTree:e,toggleTree:t,tree:c,handleTreeNav:o,searchText:u,isIndexLoaded:l,extensionOpts:s}}}),on={treeToggle:"IndexTree_treeToggle_1Disw",searchInput:"IndexTree_searchInput_1f5gZ",itemBtn:"IndexTree_itemBtn_3xH8n",active:"IndexTree_active_1ajD8"};const rn=an.__cssModules={};rn["$style"]=on,an.render=Kl;var sn=an;const un=(0,a.Wm)("div",{class:"bg-gray-200 h-1"},null,-1),cn={class:"p-3"},dn={class:"font-semibold truncate"},fn={class:"text-grey text-sm"},hn=(0,a.Uk)("Downloading...");function pn(e,t,l,n,r,i){return e.active?((0,a.wg)(),(0,a.j4)("div",{key:0,class:e.$style.notification},[e.totalSize?((0,a.wg)(),(0,a.j4)(a.HY,{key:0},[un,(0,a.Wm)("div",{class:"bg-blue-500 h-1 absolute top-0",style:{width:e.received/e.totalSize*100+"%"}},null,4)],64)):(0,a.kq)("",!0),(0,a.Wm)("div",cn,[(0,a.Wm)("div",dn,(0,o.zw)(e.bundleName),1),(0,a.Wm)("div",fn,[e.totalSize?((0,a.wg)(),(0,a.j4)(a.HY,{key:0},[(0,a.Uk)((0,o.zw)((e.totalSize/1e6).toFixed(1))+" MB",1)],64)):((0,a.wg)(),(0,a.j4)(a.HY,{key:1},[hn],64))])])],2)):(0,a.kq)("",!0)}var vn=(0,a.aZ)({setup(){return L}}),yn={notification:"DownloadProgress_notification_1LAA4"};const mn=vn.__cssModules={};mn["$style"]=yn,vn.render=pn;var gn=vn,bn=(0,a.aZ)({components:{IndexTree:sn,ViewerTabs:Vl,DownloadProgress:gn},setup(){const e=(0,a.Fl)((()=>Rl.value.find((e=>e.id===Hl.value))));return{activeTab:e,appVersion:"3.2.0"}}});bn.render=h;var wn=bn;(0,n.ri)(wn).mount("#app")}},t={};function l(n){var a=t[n];if(void 0!==a)return a.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,l),o.exports}l.m=e,function(){var e=[];l.O=function(t,n,a,o){if(!n){var r=1/0;for(u=0;u<e.length;u++){n=e[u][0],a=e[u][1],o=e[u][2];for(var i=!0,s=0;s<n.length;s++)(!1&o||r>=o)&&Object.keys(l.O).every((function(e){return l.O[e](n[s])}))?n.splice(s--,1):(i=!1,o<r&&(r=o));i&&(e.splice(u--,1),t=a())}return t}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[n,a,o]}}(),function(){l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,{a:t}),t}}(),function(){l.d=function(e,t){for(var n in t)l.o(t,n)&&!l.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){l.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){l.p="/poe-dat-viewer/"}(),function(){var e={143:0};l.O.j=function(t){return 0===e[t]};var t=function(t,n){var a,o,r=n[0],i=n[1],s=n[2],u=0;for(a in i)l.o(i,a)&&(l.m[a]=i[a]);if(s)var c=s(l);for(t&&t(n);u<r.length;u++)o=r[u],l.o(e,o)&&e[o]&&e[o][0](),e[r[u]]=0;return l.O(c)},n=self["webpackChunkpoe_dat_viewer"]=self["webpackChunkpoe_dat_viewer"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=l.O(void 0,[998],(function(){return l(743)}));n=l.O(n)})();
//# sourceMappingURL=app.995abb41.js.map