(function(e){function t(t){for(var l,r,i=t[0],c=t[1],s=t[2],d=0,b=[];d<i.length;d++)r=i[d],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&b.push(a[r][0]),a[r]=0;for(l in c)Object.prototype.hasOwnProperty.call(c,l)&&(e[l]=c[l]);u&&u(t);while(b.length)b.shift()();return o.push.apply(o,s||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],l=!0,i=1;i<n.length;i++){var c=n[i];0!==a[c]&&(l=!1)}l&&(o.splice(t--,1),e=r(r.s=n[0]))}return e}var l={},a={app:0},o=[];function r(t){if(l[t])return l[t].exports;var n=l[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=l,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)r.d(n,l,function(t){return e[t]}.bind(null,l));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/poe-dat-viewer/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var s=0;s<i.length;s++)t(i[s]);var u=c;o.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"11af":function(e,t,n){e.exports={titlebar:"Tabs_titlebar_6nlgm",tab:"Tabs_tab_36pp7",active:"Tabs_active_1qu2U"}},1735:function(e,t,n){e.exports={scrollable:"CanvasScroll_scrollable_KuF3M",track:"CanvasScroll_track_35adi",y:"CanvasScroll_y_3fkOa",x:"CanvasScroll_x_1YqgW",thumb:"CanvasScroll_thumb_3n3go"}},"27fd":function(e,t,n){e.exports={treeToggle:"IndexTree_treeToggle_3Gb6L",searchInput:"IndexTree_searchInput_nlhBz",itemBtn:"IndexTree_itemBtn_1tEbV",active:"IndexTree_active_-QAh_"}},"49c3":function(e,t,n){e.exports={notification:"DownloadProgress_notification_1cAoN"}},"54fc":function(e,t,n){"use strict";n("e21f")},"62d2":function(e,t,n){"use strict";n("9f22")},"782d":function(e,t,n){e.exports=n.p+"img/discord-badge.b9bc316a.svg"},"81ee":function(e,t,n){"use strict";var l=n("49c3"),a=n.n(l);n.d(t,"default",(function(){return a.a}))},8352:function(e,t,n){"use strict";var l=n("c8e6"),a=n.n(l);n.d(t,"default",(function(){return a.a}))},"9f22":function(e,t,n){},b2e0:function(e,t,n){e.exports={rowsOverlay:"DatViewer_rowsOverlay_kP3aC"}},b9d8:function(e,t,n){"use strict";var l=n("11af"),a=n.n(l);n.d(t,"default",(function(){return a.a}))},bbf7:function(e,t,n){"use strict";var l=n("27fd"),a=n.n(l);n.d(t,"default",(function(){return a.a}))},c8e6:function(e,t,n){e.exports={bar:"Actions_bar_3gEfG"}},cd49:function(e,t,n){"use strict";n.r(t);var l=n("7a23"),a=n("782d"),o=n.n(a);const r={class:"layout-column flex-1 min-w-0"},i={class:"layout-column flex-1 min-h-0"},c={key:1,class:"bg-gray-100 flex-1 text-lg text-gray-600 flex items-center justify-center"},s={class:"app-footer"},u=Object(l["g"])("a",{class:"q-link text-white border-b",href:"https://github.com/SnosMe/poe-dat-viewer"},"GitHub",-1),d=Object(l["g"])("a",{href:"https://discord.gg/SJjBdT3",class:"flex ml-8"},[Object(l["g"])("img",{src:o.a})],-1);function b(e,t,n,a,o,b){const f=Object(l["t"])("index-tree"),h=Object(l["t"])("viewer-tabs"),p=Object(l["t"])("download-progress");return Object(l["m"])(),Object(l["d"])(l["a"],null,[Object(l["g"])(f),Object(l["g"])("div",r,[Object(l["g"])(h),Object(l["g"])("div",i,[e.activeTab?(Object(l["m"])(),Object(l["d"])(Object(l["u"])(e.activeTab.type),{args:e.activeTab.args,key:e.activeTab.id,"ka-state":e.activeTab.kaState,"onUpdate:ka-state":t[1]||(t[1]=t=>e.activeTab.kaState=t)},null,8,["args","ka-state"])):(Object(l["m"])(),Object(l["d"])("div",c,"The viewer is ready to fulfill your wishes ðŸ‘¾"))]),Object(l["g"])("div",s,[Object(l["g"])("div",null,[Object(l["f"])("Made by Alexander Drozdov, v"+Object(l["x"])(e.appVersion)+" ",1),u]),d])]),Object(l["g"])(p)],64)}const f={class:"flex overflow-hidden divide-x divide-gray-700"},h=Object(l["g"])("i",{class:"codicon codicon-close"},null,-1),p={class:"flex p-1.5 flex-shrink-0 space-x-1"},v=Object(l["g"])("button",{class:"hover:bg-gray-400 hover:text-black px-2",title:"Help"},[Object(l["g"])("i",{class:"codicon codicon-question"})],-1),y=Object(l["g"])("button",{class:"hover:bg-gray-400 hover:text-black px-2",title:"Settings"},[Object(l["g"])("i",{class:"codicon codicon-settings"})],-1);function g(e,t,n,a,o,r){return Object(l["m"])(),Object(l["d"])("div",{class:e.$style.titlebar},[Object(l["g"])("div",f,[(Object(l["m"])(!0),Object(l["d"])(l["a"],null,Object(l["r"])(e.tabs,t=>(Object(l["m"])(),Object(l["d"])("div",{key:t.id,class:[e.$style.tab,{[e.$style.active]:t.isActive}]},[Object(l["g"])("button",{class:"pl-3 pr-1.5",onClick:n=>e.setActiveTab(t.id),onContextmenu:Object(l["F"])(n=>e.closeTab(t.id),["prevent"])},Object(l["x"])(t.title),41,["onClick","onContextmenu"]),Object(l["g"])("button",{class:"pl-1.5 pr-3",title:"Close",onClick:n=>e.closeTab(t.id)},[h],8,["onClick"])],2))),128))]),Object(l["g"])("div",p,[Object(l["g"])("button",{class:"hover:bg-gray-400 hover:text-black p-2",onClick:t[1]||(t[1]=(...t)=>e.openImport&&e.openImport(...t))},"Import"),v,y])],2)}const m={class:"p-4 overflow-auto border-l flex-1 text-base"},O={class:"inline-flex items-baseline border-b pb-2"},j={style:{width:"200px"},class:"my-1"},x={style:{width:"100px"},class:"m-1"},w={style:{width:"220px"},class:"my-1"},S={class:"flex items-baseline mt-3"},k=Object(l["g"])("label",{class:"bg-gray-200 py-1 px-2 cursor-pointer hover:bg-gray-400",style:{width:"250px"},for:"import-local-file"},"Pick local file",-1);function z(e,t,n,a,o,r){return Object(l["m"])(),Object(l["d"])("div",m,[Object(l["g"])("div",O,[Object(l["g"])("div",j,[Object(l["g"])("input",{value:"patchcdn.pathofexile.com/",readonly:"",class:e.$style.input},null,2),Object(l["g"])("label",{class:e.$style.label},"Patch CDN",2)]),Object(l["g"])("div",x,[Object(l["E"])(Object(l["g"])("input",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.poePatch=t),placeholder:"3.12.x.x.x",class:e.$style.input},null,2),[[l["B"],e.poePatch,void 0,{trim:!0}]]),Object(l["g"])("label",{class:e.$style.label},"Patch #",2)]),Object(l["g"])("div",w,[Object(l["g"])("input",{value:"/Bundles2/_.index.bin",readonly:"",class:e.$style.input},null,2),Object(l["g"])("label",{class:e.$style.label},"Index",2)]),Object(l["g"])("button",{class:"ml-1 py-1 px-3 bg-blue-600 text-white hover:bg-blue-800",onClick:t[2]||(t[2]=(...t)=>e.cdnImport&&e.cdnImport(...t)),disabled:e.isCdnImportRunning,loading:e.isCdnImportRunning},Object(l["x"])(e.isCdnImportRunning?"Wait...":"Import"),9,["disabled","loading"])]),Object(l["g"])("div",S,[k,Object(l["g"])("input",{class:"hidden",id:"import-local-file",type:"file",accept:".dat,.dat64",onInput:t[3]||(t[3]=(...t)=>e.handleFile&&e.handleFile(...t))},null,32)])])}const _="Bundles2",C=Object(l["o"])({totalSize:0,received:0,active:!1,bundleName:""});async function M(e,t){if(null==e&&(e=localStorage.getItem("POE_PATCH_VER"),!e))throw new Error("never");try{return await T(e,t)}catch(n){throw window.alert("You may need to adjust the patch version."),n}}async function T(e,t){const n=`${e}/${_}/${t}`;let l=await caches.open("bundles"),a=await l.match(n);if(!a){if(C.totalSize=0,C.received=0,C.active=!0,C.bundleName=t,a=await fetch("https://poe-bundles.snos.workers.dev/"+n),200!==a.status)throw C.active=!1,new Error(`patchcdn: ${a.status} ${a.statusText}`);let o;C.totalSize=Number(a.headers.get("content-length"));try{const e=a.body.getReader(),t=[];while(1){const{done:n,value:l}=await e.read();if(n)break;t.push(l),C.received+=l.length}o=new Uint8Array(C.received);let n=0;for(const l of t)o.set(l,n),n+=l.length}finally{C.active=!1}return localStorage.getItem("POE_PATCH_VER")!==e&&(await caches.delete("bundles"),l=await caches.open("bundles")),await l.put(n,new Response(o,{headers:{"content-length":String(o.byteLength),"content-type":"application/octet-stream"}})),o.buffer}return a.arrayBuffer()}function $(){return new Worker(n.p+"js/script.39b60a66.worker.js")}var P=n("3d15");const I=P["b"](new $);function E(e){if(0===e.byteOffset&&e.byteLength===e.buffer.byteLength)return I.decompressSliceInBundle(e);{const t=new Uint8Array(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength));return I.decompressSliceInBundle(P["a"](e,[t.buffer]))}}function R(e,t,n){return I.decompressSliceInBundle(P["a"](new Uint8Array(e),[e]),t,n)}function L(e){return I.analyzeDatFile(e)}var F=n("edca");const A=Object(l["w"])(null);async function H(e){const t=Object(F["getFileInfo"])(e,A.value.bundlesInfo,A.value.filesInfo),n=await M(null,t.bundle);return R(n,t.offset,t.size)}async function V(e){const t=await E(new Uint8Array(e)),n=Object(F["readIndexBundle"])(t);A.value={bundlesInfo:n.bundlesInfo,filesInfo:n.filesInfo,dirsInfo:n.dirsInfo,pathReps:await E(n.pathRepsBundle)}}const D={class:"flex flex-1"};function B(e,t,n,a,o,r){const i=Object(l["t"])("viewer-actions"),c=Object(l["t"])("viewer-head"),s=Object(l["t"])("canvas-scroll"),u=Object(l["t"])("resize-observer"),d=Object(l["t"])("header-props");return Object(l["m"])(),Object(l["d"])(l["a"],null,[Object(l["g"])(i),Object(l["g"])("div",D,[Object(l["g"])(u,{onResize:e.handleResize,class:"flex-1 min-h-0 relative"},{default:Object(l["D"])(()=>[Object(l["g"])("div",{class:"bg-gray-200 absolute",style:e.headerBlockStyle},[Object(l["g"])(c,{style:e.headerOverlayContentStyle,left:e.scrollLeft,width:e.rowsWidth,columns:e.renderColumns},null,8,["style","left","width","columns"])],4),Object(l["g"])(s,{ref:"canvasScroll",class:"absolute bg-white",onScroll:e.handleScroll,style:e.scrollableStyle,"paint-size":e.scrollablePaintSize,"full-size":e.scrollableFullSize},{default:Object(l["D"])(()=>[Object(l["g"])("canvas",{ref:"canvasRef",onClick:t[1]||(t[1]=(...t)=>e.handleCanvasClick&&e.handleCanvasClick(...t))},null,512)]),_:1},8,["onScroll","style","paint-size","full-size"]),Object(l["g"])("div",{class:e.$style.rowsOverlay,style:e.rowsOverlayStyle},[Object(l["g"])("div",{class:"absolute",style:{transform:`translate(0, ${e.renderItems.top}px)`}},[(Object(l["m"])(!0),Object(l["d"])(l["a"],null,Object(l["r"])(e.renderItems.ids,(t,n)=>(Object(l["m"])(),Object(l["d"])("div",{key:t,style:{transform:`translate(0, ${n*e.LINE_HEIGHT}px)`,width:e.rowsNumberWidth,position:"absolute"},textContent:Object(l["x"])(t)},null,12,["textContent"]))),128))],4)],6)]),_:1},8,["onResize"]),Object(l["g"])(d,{onFocusEditingHeader:e.focusEditingHeader},null,8,["onFocusEditingHeader"])])],64)}function N(e,t,n,a,o,r){return Object(l["m"])(),Object(l["d"])(Object(l["u"])(e.tag),{ref:"rootEl","data-role":"resize-observer"},{default:Object(l["D"])(()=>[Object(l["s"])(e.$slots,"default")]),_:3},512)}var W=Object(l["h"])({props:{tag:{type:String,default:"div"}},emits:["resize"],setup(e,t){const n=Object(l["q"])(null);return Object(l["l"])(()=>{const e=new ResizeObserver(e=>{t.emit("resize",{width:e[0].contentRect.width,height:e[0].contentRect.height})});e.observe(n.value),Object(l["k"])(()=>{e.unobserve(n.value)})}),{rootEl:n}}});W.render=N;var Y=W;function q(e,t,n,a,o,r){return Object(l["m"])(),Object(l["d"])("div",{class:e.$style.scrollable,style:{width:e.paintSize.width+"px",height:e.paintSize.height+"px"},onMousedown:t[3]||(t[3]=(...t)=>e.handleMousedown&&e.handleMousedown(...t)),onWheel:t[4]||(t[4]=(...t)=>e.handleMousewheel&&e.handleMousewheel(...t))},[Object(l["s"])(e.$slots,"default"),e.scrollbarY?(Object(l["m"])(),Object(l["d"])("div",{key:0,class:`${e.$style.track} ${e.$style.y}`,onMousedown:t[1]||(t[1]=(...t)=>e.handleTrackMousedownY&&e.handleTrackMousedownY(...t)),style:{width:e.scrollbarY.fixedSize+"px",height:e.scrollbarY.trackSize+"px"}},[Object(l["g"])("div",{class:e.$style.thumb,style:{transform:`translate(0, ${e.scrollbarY.thumbPos}px)`,width:e.scrollbarY.fixedSize+"px",height:e.scrollbarY.thumbSize+"px"}},null,6)],38)):Object(l["e"])("",!0),e.scrollbarX?(Object(l["m"])(),Object(l["d"])("div",{key:1,class:`${e.$style.track} ${e.$style.x}`,onMousedown:t[2]||(t[2]=(...t)=>e.handleTrackMousedownX&&e.handleTrackMousedownX(...t)),style:{width:e.scrollbarX.trackSize+"px",height:e.scrollbarX.fixedSize+"px"}},[Object(l["g"])("div",{class:e.$style.thumb,style:{transform:`translate(${e.scrollbarX.thumbPos}px, 0)`,width:e.scrollbarX.thumbSize+"px",height:e.scrollbarX.fixedSize+"px"}},null,6)],38)):Object(l["e"])("",!0)],38)}const G=40,U=15,X=100,K=(e,t)=>Math.max(1,Math.pow(.003*e*t,2))*Math.sign(e);function J(e,t,n,l,a){var o;if(n<=t)return null;const r=Math.max(0,t-(null!==(o=null===l||void 0===l?void 0:l.fixedSize)&&void 0!==o?o:0)),i=Math.max(G,Math.floor(t*r/n)),c=(r-i)/(n-t),s=Math.round(a*c);return{trackSize:r,thumbSize:i,fixedSize:e,thumbRatio:c,thumbPos:s}}function Q(e){let t=0,n=0,l=0,a=0,o=null,r=0,i=0;function c(e){1===e.button&&(e.preventDefault(),e.stopPropagation(),document.body.style.cursor="all-scroll",o=null,t=e.clientY,n=e.clientX,l=0,a=0,r=0,i=requestAnimationFrame(d),document.addEventListener("mousemove",u),document.addEventListener("mouseup",s),document.addEventListener("mouseleave",s))}function s(){cancelAnimationFrame(i),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",s),document.removeEventListener("mouseleave",s),document.body.style.removeProperty("cursor")}function u(e){const r=e.clientY-t,i=e.clientX-n;if(null===o)if(Math.abs(r)>U)o="vertical",document.body.style.cursor="ns-resize";else{if(!(Math.abs(i)>U))return;o="horizontal",document.body.style.cursor="ew-resize"}"vertical"===o?l=r:a=i}function d(t){const n=t-(r||t);r=t,i=requestAnimationFrame(d),e(K(a,n),K(l,n))}return{handleMousedown:c}}function Z(e){function t(t){e(0,Math.sign(t.deltaY)*X)}return{handleMousewheel:t}}function ee(e,t,n){let l=0,a=0;const o="y"===t?"y":"x",r="y"===t?"clientY":"clientX";function i(t){t.preventDefault(),t.stopPropagation();const n=t.currentTarget;if(l=n.getBoundingClientRect()[o],t.target!==n){const e=t.target;a=t[r]-e.getBoundingClientRect()[o]}else a=e.value.thumbSize/2,c(t),a=t[r]-l-e.value.thumbPos;document.addEventListener("mousemove",c),document.addEventListener("mouseup",s),document.addEventListener("mouseleave",s)}function c(o){const i=(o[r]-l-a)/e.value.thumbRatio;"x"===t?n(i,void 0):n(void 0,i)}function s(){document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",s),document.removeEventListener("mouseleave",s)}return{handleTrackMousedown:i}}var te=Object(l["h"])({props:{paintSize:{type:Object,required:!0},fullSize:{type:Object,required:!0},widthY:{type:Number,default:14},widthX:{type:Number,default:12}},emits:["scroll"],setup(e,t){const n=Object(l["v"])({y:0,x:0});Object(l["C"])(()=>[e.paintSize,e.fullSize],()=>{const{paintSize:t,fullSize:l}=e;n.x=Math.max(0,Math.min(n.x,l.width-t.width)),n.y=Math.max(0,Math.min(n.y,l.height-t.height))},{deep:!0}),Object(l["C"])(n,()=>{t.emit("scroll",{y:n.y,x:n.x})});const a=Object(l["b"])(()=>J(e.widthY,e.paintSize.height,e.fullSize.height,null,n.y)),o=Object(l["b"])(()=>J(e.widthX,e.paintSize.width,e.fullSize.width,a.value,n.x));function r(t,l){const{paintSize:a,fullSize:o}=e;n.y=Math.max(0,Math.min(n.y+Math.floor(l),o.height-a.height)),n.x=Math.max(0,Math.min(n.x+Math.floor(t),o.width-a.width))}function i(t,l){const{paintSize:a,fullSize:o}=e;void 0!==t&&(n.x=Math.max(0,Math.min(Math.floor(t),o.width-a.width))),void 0!==l&&(n.y=Math.max(0,Math.min(Math.floor(l),o.height-a.height)))}return{scrollbarY:a,scrollbarX:o,scrollPos:Object(l["p"])(n),scrollTo:i,scrollByDelta:r,handleMousedown:Q(r).handleMousedown,handleMousewheel:Z(r).handleMousewheel,handleTrackMousedownY:ee(a,"y",i).handleTrackMousedown,handleTrackMousedownX:ee(o,"x",i).handleTrackMousedown}}}),ne=n("d438");const le=te.__cssModules={};le["$style"]=ne["default"],te.render=q;var ae=te,oe=n("95b2"),re=n("44ab"),ie=n("7dfb");function ce(e,t){for(let n=e.offset;n<e.offset+e.length;++n)t[n]=!0}function se(e,t,n,l){const a=Math.min(t,n),o=Math.max(t,n);l=l.filter(e=>e.type.byteView&&!e.type.byteView.array);for(let r=a;r<=o;++r)l.some(e=>r>=e.offset&&r<e.offset+e.length)&&(e[r]=!e[r])}function ue(e){e.fill(!1)}function de(e){const t=[];let n,l=e.indexOf(!0);if(l<0)return t;for(n=l,t.push([n]),l+=1;l<e.length;++l)if(e[l]){const e=l;e-n===1?t[t.length-1].push(e):t.push([e]),n=e}return t}const be=()=>({byteView:{array:!1}});function fe(e,t){for(let n=0;n<t.length;){const l=t[n];null!=l.name&&e.some(e=>e>=l.offset&&e<l.offset+l.length)?pe(l,t):n+=1}}function he(e,t){const n=de(e);if(0===n.length)throw new Error("No bytes selected");if(n.length>1)throw new Error("Cannot create header from non-contiguous selection");const l=n[0];fe(l,t);const a=t.find(e=>l[0]>=e.offset&&l[0]+l.length<=e.offset+e.length);let o=[{name:null,offset:a.offset,length:l[0]-a.offset,type:be()},{name:"",offset:l[0],length:l.length,type:be(),textLength:11},{name:null,offset:l[0]+l.length,length:a.length-(l[0]-a.offset+l.length),type:be()}];const r=o[1];return o=o.filter(e=>e.length),t.splice(t.indexOf(a),1,...o),r}function pe(e,t){if(null==e.name)throw new Error("Cannot remove empty header");e.name=null,e.type=be();for(let n=0;n<t.length-1;){const e=ve(t[n],t[n+1]);e?t.splice(n,2,e):n+=1}}function ve(e,t){return null===e.name&&null===t.name?{name:null,offset:e.offset,length:e.length+t.length,type:be()}:null}var ye=n("3f4f"),ge=n("38c7");const me=Object(ye["a"])("poe-dat-viewer",3,{upgrade(e){e.createObjectStore("dat-schemas",{keyPath:"name"})}});async function Oe(e){const t=await(await me).get("dat-schemas",e);return(null===t||void 0===t?void 0:t.headers)||we(e)||[]}async function je(e,t){await(await me).put("dat-schemas",{name:e,headers:xe(t)})}function xe(e){return e.map(e=>({...e,length:e.type.string||e.type.array||e.type.key||e.type.boolean||e.type.decimal||e.type.integer?void 0:e.length}))}function we(e){const t=ge["schema"].find(t=>t.name===e);return!t||t.enum?null:t.columns.map(t=>({name:t.name,type:{array:t.array,integer:"uint8"===t.type?{unsigned:!0,size:1}:"uint16"===t.type?{unsigned:!0,size:2}:"uint32"===t.type?{unsigned:!0,size:4}:"uint64"===t.type?{unsigned:!0,size:8}:"int8"===t.type?{unsigned:!1,size:1}:"int16"===t.type?{unsigned:!1,size:2}:"int32"===t.type?{unsigned:!1,size:4}:"int64"===t.type?{unsigned:!1,size:8}:"enum0"===t.type||"enum1"===t.type?{unsigned:!0,size:4}:void 0,decimal:"float32"===t.type?{size:4}:"float64"===t.type?{size:8}:void 0,string:"string"===t.type?{}:void 0,boolean:"bool"===t.type?{}:void 0,key:"rowidx"===t.type?{foreign:!!t.references&&t.references.table!==e}:void 0},textLength:11}))}function Se(e,t){const n=Object(oe["readDatFile"])(e,t),a={headers:Object(l["w"])(n.rowLength?[{name:null,offset:0,length:n.rowLength,type:be()}]:[]),datFile:n,name:_e(e),columnStats:Object(l["w"])([]),columnSelection:Object(l["w"])(new Array(n.rowLength).fill(!1)),editHeader:Object(l["w"])(null),selectedRow:Object(l["w"])(null),rowSorting:Object(l["w"])(null),scrollPos:Object(l["v"])({x:0,y:0})};return L(a.datFile).then(async e=>{a.columnStats.value=e;const t=await Oe(a.name);try{ke(t,a)}catch(n){window.alert("WARN: "+n.message)}finally{Object(l["y"])(a.headers)}}),a}function ke(e,t){let n=0;for(const l of e){const e=l.length||Object(ie["getHeaderLength"])(l,t.datFile);if(null==l.name){n+=e;continue}const a={...l,length:e,offset:n},o=l.length?t.datFile.rowLength-a.offset>=a.length:Object(re["validateHeader"])(a,t.columnStats.value,t.datFile);if(!o)throw new Error("The schema is invalid.");ce(a,t.columnSelection.value);const r=he(t.columnSelection.value,t.headers.value);Object.assign(r,a),ue(t.columnSelection.value),n+=e}}function ze(e,t){const n=e.filter(({type:e})=>e.boolean||e.decimal||e.integer||e.key||e.string).map((e,n)=>({name:e.name||"Unknown"+(n+1),data:(()=>{var n;const l=Object(oe["readColumn"])(e,t);if(null===(n=e.type.key)||void 0===n?void 0:n.foreign){if(e.type.array){const e=l;if(!e.every(e=>e.every(e=>0===e.unknown)))throw new Error("never");return e.map(e=>e.map(e=>e.rid))}{const e=l;if(!e.every(e=>null==e||0===e.unknown))throw new Error("never");return e.map(e=>e&&e.rid)}}return l})()}));return n.unshift({name:"_rid",data:Array(t.rowCount).fill(void 0).map((e,t)=>t)}),Array(t.rowCount).fill(void 0).map((e,t)=>Object.fromEntries(n.map(e=>[e.name,e.data[t]])))}function _e(e){return e.match(/[^/]+(?=\..+$)/)[0]}function Ce(e){je(e.name,e.headers.value)}const Me={class:"flex"},Te={key:0,class:"text-gray-500 italic px-1.5 self-center"},$e=Object(l["g"])("i",{class:"codicon codicon-add"},null,-1),Pe=Object(l["f"])(" Define column"),Ie=Object(l["g"])("div",{class:"text-gray-400 px-1.5 mr-1 self-center"},"Selections",-1),Ee={class:"flex space-x-1"};function Re(e,t,n,a,o,r){return Object(l["m"])(),Object(l["d"])("div",{class:e.$style.bar},[Object(l["g"])("div",Me,[0===e.selections.length?(Object(l["m"])(),Object(l["d"])("div",Te,"No bytes selected")):1===e.selections.length?(Object(l["m"])(),Object(l["d"])("button",{key:1,class:"hover:bg-gray-400 hover:text-black px-1.5",onClick:t[1]||(t[1]=(...t)=>e.defineColumn&&e.defineColumn(...t))},[$e,Pe])):e.selections.length>1?(Object(l["m"])(),Object(l["d"])(l["a"],{key:2},[Ie,(Object(l["m"])(!0),Object(l["d"])(l["a"],null,Object(l["r"])(e.selections,e=>(Object(l["m"])(),Object(l["d"])("div",{class:"px-1.5 mr-1 font-mono bg-gray-300 text-black flex items-center",textContent:Object(l["x"])(e)},null,8,["textContent"]))),256))],64)):Object(l["e"])("",!0)]),Object(l["g"])("div",Ee,[e.rowSorting?(Object(l["m"])(),Object(l["d"])("button",{key:0,class:"bg-gray-700 hover:bg-gray-400 hover:text-black px-1.5 border border-gray-600",onClick:t[2]||(t[2]=t=>e.rowSorting=null)},"Reset sorting")):Object(l["e"])("",!0),Object(l["g"])("button",{class:"hover:bg-gray-400 hover:text-black px-1.5",onClick:t[3]||(t[3]=(...t)=>e.exportDataJson&&e.exportDataJson(...t))},"Export data")])],2)}var Le=n("21a6"),Fe=n.n(Le),Ae=Object(l["h"])({setup(){const e=Object(l["i"])("viewer"),t=Object(l["b"])(()=>de(e.columnSelection.value).map(e=>e.map(e=>String(e)).join(" ")));function n(){const{editHeader:t,columnSelection:n,headers:a}=e;t.value=he(n.value,a.value),ue(n.value),Object(l["y"])(a),Object(l["y"])(n),Ce(e)}function a(){const t=ze(e.headers.value,e.datFile);Fe.a.saveAs(new File([JSON.stringify(t,null,2)],e.name+".json",{type:"application/json;charset=utf-8"}))}return{viewer:e,rowSorting:e.rowSorting,selections:t,defineColumn:n,exportDataJson:a}}}),He=n("8352");const Ve=Ae.__cssModules={};Ve["$style"]=He["default"],Ae.render=Re;var De=Ae;const Be={class:"datv-header-layer"},Ne=Object(l["f"])("Â "),We={key:1,class:"bg-gray-600 text-gray-300 px-1"},Ye={key:0,class:"datv-stat__line bg-yellow-600",style:{top:"0"}},qe={key:1,class:"datv-stat__line bg-teal-500",style:{top:"7px"}},Ge={key:2,class:"datv-stat__line bg-gray-900",style:{top:"14px"}},Ue={key:3,class:"datv-stat__line bg-pink-500",style:{top:"14px"}};function Xe(e,t,n,a,o,r){return Object(l["m"])(),Object(l["d"])("div",Be,[Object(l["g"])("div",{style:e.headersRowStyle,class:"absolute"},[(Object(l["m"])(!0),Object(l["d"])(l["a"],null,Object(l["r"])(e.headers,t=>(Object(l["m"])(),Object(l["d"])("button",{key:t.offset,class:["datv-header",{"datv-col--border":t.border,"datv-header--active":t.active}],style:{width:t.widthPx+"px",transform:`translate(${t.leftPx}px, 0)`},title:t.name,onClick:n=>e.editHeader(t.offset),onWheel:n=>e.handleHeaderWheel(t.offset,n)},[null===t.name?(Object(l["m"])(),Object(l["d"])(l["a"],{key:0},[Ne],64)):""===t.name?(Object(l["m"])(),Object(l["d"])("span",We,"?")):(Object(l["m"])(),Object(l["d"])(l["a"],{key:2},[Object(l["f"])(Object(l["x"])(t.name),1)],64))],46,["title","onClick","onWheel"]))),128))],4),Object(l["g"])("div",{style:e.colsRowStyle,class:"absolute"},[(Object(l["m"])(!0),Object(l["d"])(l["a"],null,Object(l["r"])(e.columns,t=>(Object(l["m"])(),Object(l["d"])("button",{key:t.offset,class:["datv-byte",{"datv-col--border":t.border,"datv-byte--selected":t.selected}],style:{width:t.widthPx+"px",transform:`translate(${t.leftPx}px, 0)`},onMousedown:n=>e.selectStart(t.offset),onMouseenter:n=>e.selectContinue(t.offset,n),title:t.offset,textContent:Object(l["x"])(t.text)},null,46,["onMousedown","onMouseenter","title","textContent"]))),128))],4),Object(l["g"])("div",{style:e.statsRowStyle,class:"absolute datv-stats_row"},[(Object(l["m"])(!0),Object(l["d"])(l["a"],null,Object(l["r"])(e.columns,e=>(Object(l["m"])(),Object(l["d"])("div",{key:e.offset,class:["datv-stat",{"datv-col--border":e.border,"datv-byte--selected":e.selected}],style:{width:e.widthPx+"px",transform:`translate(${e.leftPx}px, 0)`}},[e.stat?(Object(l["m"])(),Object(l["d"])(l["a"],{key:0},[e.stat.string?(Object(l["m"])(),Object(l["d"])("div",Ye)):Object(l["e"])("",!0),e.stat.array?(Object(l["m"])(),Object(l["d"])("div",qe)):Object(l["e"])("",!0),e.stat.zero?(Object(l["m"])(),Object(l["d"])("div",Ge)):e.stat.nullable?(Object(l["m"])(),Object(l["d"])("div",Ue)):Object(l["e"])("",!0),Object(l["g"])("div",{class:"datv-stat__max",textContent:Object(l["x"])(e.stat.max)},null,8,["textContent"])],64)):Object(l["e"])("",!0)],6))),128))],4)])}function Ke(e,t,n){const l=Object(oe["readColumn"])(e,n),a=Array.from({length:n.rowCount},(e,t)=>t);return e.type.array?a.sort((e,n)=>{const a=l[e],o=l[n];return(o.length-a.length)*t}):e.type.boolean?a.sort((e,n)=>{const a=Number(l[e]),o=Number(l[n]);return(a-o)*t}):e.type.string?a.sort((e,n)=>{const a=l[e],o=l[n];return a.localeCompare(o)*t}):e.type.integer||e.type.decimal?a.sort((e,n)=>{const a=l[e],o=l[n];return(o-a)*t}):e.type.key&&(e.type.key.foreign?a.sort((e,n)=>{const a=l[e],o=l[n];return(((null===o||void 0===o?void 0:o.rid)||0)-((null===a||void 0===a?void 0:a.rid)||0))*t}):a.sort((e,n)=>{const a=Number(l[e]),o=Number(l[n]);return(o-a)*t})),a}var Je=n("f0db");function Qe(e,t){t.text=String(e),t.color="#098658"}function Ze(e,t){t.text=`[${e.join(", ")}]`,t.color="#098658"}function et(e,t){t.text=String(e),t.color="#0000ff"}function tt(e,t){t.text=`[${e.join(", ")}]`,t.color="#0000ff"}function nt(e,t){""===e?(t.text="null",t.color="#0000ff"):(t.text=String(e),t.color="#001080")}function lt(e,t){t.text=`[${e.map(e=>'"'+e+'"').join(", ")}]`,t.color="#001080"}function at(e,t){null===e?(t.text="null",t.color="#0000ff"):(t.text=`<${e}, self>`,t.color="#098658")}function ot(e,t){t.text=`[${e.map(e=>`<${e}, self>`).join(", ")}]`,t.color="#098658"}function rt(e,t){null===e?(t.text="null",t.color="#0000ff"):(t.text=`<${e.rid}, ${e.unknown}>`,t.color="#098658")}function it(e,t){t.text=`[${e.map(e=>`<${e.rid}, ${e.unknown}>`).join(", ")}]`,t.color="#098658"}function ct(e,t,n,l){const a=Object(Je["getFieldReader"])(t,n),o={text:"",color:""},r=(()=>{if(t.type.array){if(t.type.boolean)return tt;if(t.type.string)return lt;if(t.type.integer||t.type.decimal)return Ze;if(t.type.key&&t.type.key.foreign)return it;if(t.type.key&&!t.type.key.foreign)return ot}else{if(t.type.boolean)return et;if(t.type.string)return nt;if(t.type.integer||t.type.decimal)return Qe;if(t.type.key&&t.type.key.foreign)return rt;if(t.type.key&&!t.type.key.foreign)return at}throw new Error("never")})();let i=0,c="";for(const s of l)r(a(s),o),c!==o.color&&(e.fillStyle=o.color,c=o.color),e.fillText(o.text,0,i),i+=pt}function st(e,t,n,l,a,o){e.fillStyle="#000";let r=0;for(const i of l){const l=n.dataFixed.subarray(i*n.rowLength+t.offset+a,i*n.rowLength+t.offset+o),c=Array.from(l,e=>e.toString(16).padStart(2,"0")).join(" ");e.fillText(c,a*(3*ft),r),r+=pt}}function ut(e,t,n,l,a){e.fillStyle="#000";const o=a.refArray,r=Math.max(o.keyForeign?n.fieldSize.KEY_FOREIGN:0,o.keySelf?n.fieldSize.KEY:0,o.string?n.fieldSize.STRING:0,o.longLong?n.fieldSize.LONGLONG:0,o.long?n.fieldSize.LONG:0,o.short?n.fieldSize.SHORT:0,n.fieldSize.BYTE),i=Math.ceil(t.textLength/3);let c=0;for(const s of l){const l=n.readerFixed.getSizeT(s*n.rowLength+t.offset);if(0===l)e.fillText("[]",0,c);else{const a=n.readerFixed.getSizeT(s*n.rowLength+t.offset+n.memsize),o=n.dataVariable.subarray(a,a+Math.min(r*l,i)),u=Array.from(o,e=>e.toString(16).padStart(2,"0")).join(" ");e.fillText(`${l} { ${u} }`,0,c)}c+=pt}}const dt='Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',bt=14,ft=St(bt,dt),ht=kt(bt,dt),pt=19,vt=3,yt=1,gt=7,mt=Math.round(3*ft),Ot=2*mt+3*gt;function jt(e){const t=String(e-1).length;return Math.max(t,vt)}function xt(e){return Math.ceil(jt(e)*ft)}function wt(e){return xt(e)+16}function St(e,t){const n=document.createElement("canvas"),l=n.getContext("2d");l.font=`${e}px ${t}`;const a=l.measureText("0");return a.width}function kt(e,t){const n=document.createElement("canvas"),l=n.getContext("2d");l.font=`${e}px ${t}`,l.textBaseline="middle";const a=l.measureText("0"),o=e/2+(void 0!==a.alphabeticBaseline?-a.alphabeticBaseline:a.actualBoundingBoxDescent);return o}function zt(e){return 1+(e-bt)/2+ht}function _t(e){const{ctx:t}=e;if(t.fillStyle="#fff",t.fillRect(0,0,t.canvas.width,t.canvas.height),null!==e.viewer.selectedRow.value){const n=e.rows.indexOf(e.viewer.selectedRow.value);-1!==n&&(t.fillStyle="#bee3f8",t.fillRect(0,e.top+n*pt,t.canvas.width,pt))}t.save(),t.translate(-e.left,0),Ct(t,e.columns),t.restore(),t.font=`${bt}px ${dt}`,t.fillStyle="#000";const n=Mt(e.viewer,e.left,e.left+e.paintWidth);for(const l of n)t.save(),t.beginPath(),t.translate(l.left-e.left,0),t.rect(0,0,l.width,t.canvas.height),t.clip(),t.translate(ft/2,e.top+zt(pt)),l.exec(t,e.rows),t.restore();{const e=t.createLinearGradient(0,-16,0,4);e.addColorStop(0,"rgba(254,254,254,0.6)"),e.addColorStop(1,"transparent"),t.fillStyle=e,t.fillRect(0,0,t.canvas.width,6);const n=t.createLinearGradient(-16,0,4,0);n.addColorStop(0,"rgba(254,254,254,0.5)"),n.addColorStop(1,"transparent"),t.fillStyle=n,t.fillRect(0,0,6,t.canvas.height)}}function Ct(e,t){for(const n of t)n.selected&&(e.fillStyle="#bee3f8",e.fillRect(n.leftPx+(n.border?yt:0),0,n.widthPx,e.canvas.height)),n.border&&(e.fillStyle="#bdbdbd",e.fillRect(n.leftPx,0,yt,e.canvas.height))}function Mt(e,t,n){const l=e.headers.value,a=e.columnStats.value,o=e.datFile,r=[];let i=0;for(const c of l){const e=Tt(c);if(i+e.borderWidth>=t)if(c.type.byteView)if(c.type.byteView.array)r.push({left:i+(e.borderWidth?yt:0),width:e.paddingWidth,exec:(e,t)=>ut(e,c,o,t,a[c.offset])});else{const l=Math.max(0,Math.floor((t-i)/(3*ft))),a=Math.min(c.length,Math.ceil((n-i)/(3*ft)));r.push({left:i+(e.borderWidth?yt:0),width:e.paddingWidth,exec:(e,t)=>st(e,c,o,t,l,a)})}else r.push({left:i+(e.borderWidth?yt:0),width:e.paddingWidth,exec:(e,t)=>ct(e,c,o,t)});if(i+=e.borderWidth,i>=n)return r}return r}function Tt(e){const t=e.type.byteView&&!e.type.byteView.array?3*e.length-1:e.textLength;return{paddingWidth:Math.ceil((t+1)*ft),borderWidth:Math.ceil((t+1)*ft)+(e.offset>0?yt:0),hasBorder:e.offset>0}}function $t(e){let t=0;for(const n of e){const e=Tt(n);t+=e.borderWidth}return t}function Pt(e,t,n,l){const a=[];let o=0;for(const r of e){const e=Tt(r);if(o+e.borderWidth>=n&&a.push({offset:r.offset,border:e.hasBorder,active:r===t,widthPx:e.borderWidth,leftPx:o,name:r.name}),o+=e.borderWidth,o>=l)return a}return a}var It=Object(l["h"])({props:{left:{type:Number,required:!0},width:{type:Number,required:!0},columns:{type:Array,required:!0}},setup(e){const t=Object(l["w"])(0);let n=-1,a=[];const o=Object(l["i"])("viewer");function r(e){function t(){n=-1,document.removeEventListener("mouseup",t),document.removeEventListener("mouseleave",t)}n=e,a=[...o.columnSelection.value],se(o.columnSelection.value,n,n,o.headers.value),Object(l["y"])(o.columnSelection),document.addEventListener("mouseup",t),document.addEventListener("mouseleave",t)}function i(e,t){if(-1===n||1!==t.buttons)return;const{memsize:l}=o.datFile,r=e-n;r>=l?e=n+2*l-1:r>=4?e=n+8-1:r>=2&&(e=n+4-1),r<=-l?e=n-2*l+1:r<=-4?e=n-8+1:r<=-2&&(e=n-4+1),o.columnSelection.value=[...a],se(o.columnSelection.value,n,e,o.headers.value)}function c(e){const n=o.headers.value.find(t=>t.offset===e);o.editHeader.value!==n||n.type.byteView&&!n.type.byteView.array?(o.editHeader.value=n,t.value=0):(0===t.value?t.value=1:1===t.value?t.value=-1:-1===t.value&&(t.value=1),o.rowSorting.value=Ke(n,t.value,o.datFile))}function s(e,t){t.preventDefault();const n=o.headers.value.find(t=>t.offset===e);null!=n.textLength&&(n.textLength=Math.max(1,n.textLength-Math.sign(t.deltaY)*(t.ctrlKey?10:1)),Object(l["y"])(o.headers),Ce(o))}const u=Object(l["b"])(()=>Pt(o.headers.value,o.editHeader.value,e.left,e.left+e.width));return{headers:u,selectStart:r,selectContinue:i,editHeader:c,handleHeaderWheel:s,headersRowStyle:Object(l["b"])(()=>({transform:`translate(${-e.left}px, 0)`,lineHeight:mt+"px",fontFamily:dt,fontSize:bt+"px"})),colsRowStyle:Object(l["b"])(()=>({transform:`translate(${-e.left}px, ${mt}px)`,lineHeight:mt+"px",fontFamily:dt,fontSize:bt+"px"})),statsRowStyle:Object(l["b"])(()=>({transform:`translate(${-e.left}px, ${2*mt}px)`,fontFamily:dt,fontSize:bt+"px"}))}}});n("62d2");It.render=Xe;var Et=It;const Rt={key:0,style:{width:"300px"},class:"relative overflow-hidden"},Lt={class:"m-2 shadow border border-gray-400 bg-white absolute inset-0 flex flex-col"},Ft={class:"p-2 bg-gray-200 text-gray-700 shadow flex items-baseline"},At=Object(l["g"])("span",{class:"px-2"},"Column properties",-1),Ht=Object(l["g"])("i",{class:"codicon codicon-close"},null,-1),Vt={key:0,class:"p-4"},Dt={key:1,class:"p-4 overflow-auto"},Bt={class:"mb-4"},Nt=Object(l["g"])("label",{for:"datv-header-name"},"Name",-1),Wt={class:"mb-4 flex items-baseline"},Yt=Object(l["g"])("div",{class:"mr-2"},"View mode",-1),qt={class:"space-x-px flex"},Gt={class:"mb-4"},Ut={class:"mb-2 flex justify-between items-baseline"},Xt=Object(l["g"])("span",null,"Data type",-1),Kt={class:"inline-flex items-center"},Jt={class:"ml-2 cursor-pointer"},Qt={key:0,class:"mt-3"},Zt=Object(l["g"])("div",{class:"mb-1"},"of ...",-1),en={class:"inline-flex items-center"},tn={class:"ml-2 cursor-pointer"},nn={key:0,class:"mb-4"},ln={class:"inline-flex items-center"},an=Object(l["g"])("span",{class:"ml-2 cursor-pointer"},"Unsigned",-1),on={key:1,class:"mb-4 border-t pt-4"},rn=Object(l["g"])("label",{class:"mr-4"},"Width",-1),cn=Object(l["f"])(" chars ");function sn(e,t,n,a,o,r){return e.isVisible?(Object(l["m"])(),Object(l["d"])("div",Rt,[Object(l["g"])("div",{style:{height:e.HEADERS_HEIGHT+"px"},class:"bg-gray-200"},null,4),Object(l["g"])("div",Lt,[Object(l["g"])("div",Ft,[At,Object(l["g"])("button",{class:"border border-gray-500 rounded-full px-3",onClick:t[1]||(t[1]=t=>e.$emit("focus-editing-header"))},"Focus"),Object(l["g"])("button",{onClick:t[2]||(t[2]=(...t)=>e.close&&e.close(...t)),class:"px-2 py-1 ml-auto",title:"Close"},[Ht])]),null===e.header.name?(Object(l["m"])(),Object(l["d"])("div",Vt,[Object(l["g"])("div",null,Object(l["x"])(e.header.length)+" bytes of unidentified data",1)])):(Object(l["m"])(),Object(l["d"])("div",Dt,[Object(l["g"])("div",Bt,[Nt,Object(l["E"])(Object(l["g"])("input",{id:"datv-header-name",placeholder:"Unnamed","onUpdate:modelValue":t[3]||(t[3]=t=>e.header.name=t),class:"border p-1 mt-1 w-full focus:border-blue-500",spellcheck:"false"},null,512),[[l["B"],e.header.name,void 0,{trim:!0}]])]),Object(l["g"])("div",Wt,[Yt,Object(l["g"])("div",qt,[(Object(l["m"])(!0),Object(l["d"])(l["a"],null,Object(l["r"])(e.viewModeOpts,t=>(Object(l["m"])(),Object(l["d"])("button",{key:t.value,class:["px-2",e.byteViewMode===t.value?"bg-blue-500 text-white":"bg-gray-200 hover:bg-gray-400"],onClick:n=>e.byteViewMode=t.value,disabled:t.disabled,textContent:Object(l["x"])(t.label)},null,10,["onClick","disabled","textContent"]))),128))])]),Object(l["g"])("div",Gt,[Object(l["g"])("div",Ut,[Xt,Object(l["g"])("button",{class:"text-red-700 bg-red-100 px-2",onClick:t[4]||(t[4]=(...t)=>e.remove&&e.remove(...t))},"Delete")]),Object(l["g"])("div",null,[(Object(l["m"])(!0),Object(l["d"])(l["a"],null,Object(l["r"])(e.dataTypeOpts,n=>(Object(l["m"])(),Object(l["d"])("div",{key:n.value,class:"mb-0.5"},[Object(l["g"])("label",Kt,[Object(l["E"])(Object(l["g"])("input",{type:"radio","onUpdate:modelValue":t[5]||(t[5]=t=>e.dataType=t),value:n.value},null,8,["value"]),[[l["A"],e.dataType]]),Object(l["g"])("span",Jt,Object(l["x"])(n.label),1)])]))),128)),e.arrayTypeOpts.length?(Object(l["m"])(),Object(l["d"])("div",Qt,[Zt,(Object(l["m"])(!0),Object(l["d"])(l["a"],null,Object(l["r"])(e.arrayTypeOpts,n=>(Object(l["m"])(),Object(l["d"])("div",{key:n.value,class:"mb-0.5"},[Object(l["g"])("label",en,[Object(l["E"])(Object(l["g"])("input",{type:"radio","onUpdate:modelValue":t[6]||(t[6]=t=>e.arrayType=t),value:n.value},null,8,["value"]),[[l["A"],e.arrayType]]),Object(l["g"])("span",tn,Object(l["x"])(n.label),1)])]))),128))])):Object(l["e"])("",!0)])]),e.header.type.integer?(Object(l["m"])(),Object(l["d"])("div",nn,[Object(l["g"])("label",ln,[Object(l["E"])(Object(l["g"])("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=t=>e.header.type.integer.unsigned=t)},null,512),[[l["z"],e.header.type.integer.unsigned]]),an])])):Object(l["e"])("",!0),e.dataType?(Object(l["m"])(),Object(l["d"])("div",on,[rn,Object(l["E"])(Object(l["g"])("input",{"onUpdate:modelValue":t[8]||(t[8]=t=>e.header.textLength=t),class:"border w-16 text-center"},null,512),[[l["B"],e.header.textLength,void 0,{number:!0}]]),cn])):Object(l["e"])("",!0)]))])])):Object(l["e"])("",!0)}function un(e,t,n){const l=[],{fieldSize:a}=n,o=e.length;return o===a.ARRAY&&t.refArray&&l.push({label:"Array",value:"array"}),o===a.STRING&&t.refString&&l.push({label:"String",value:"string"}),o===a.KEY&&t.keySelf&&l.push({label:"Key (self)",value:"key_self"}),o===a.KEY_FOREIGN&&l.push({label:"Key (foreign)",value:"key_foreign"}),8!==o&&4!==o&&2!==o&&1!==o||l.push({label:"Integer",value:"integer"}),8!==o&&4!==o||l.push({label:"Decimal",value:"decimal"}),1===o&&t.bMax<=1&&l.push({label:"Boolean",value:"boolean"}),l}function dn(e,t){const n=[];if(!e.type.array||!t.refArray)return n;const l=t.refArray;return l.string&&n.push({label:"String",value:"string"}),l.keySelf&&n.push({label:"Key (self)",value:"key_self"}),l.keyForeign&&n.push({label:"Key (foreign)",value:"key_foreign"}),l.longLong&&n.push({label:"Integer - 8 bytes",value:"integer_8"}),l.long&&n.push({label:"Integer - 4 bytes",value:"integer_4"}),l.short&&n.push({label:"Integer - 2 bytes",value:"integer_2"}),l.longLong&&n.push({label:"Decimal - 8 bytes",value:"decimal_8"}),l.long&&n.push({label:"Decimal - 4 bytes",value:"decimal_4"}),l.boolean&&n.push({label:"Boolean",value:"boolean"}),n.push({label:"Integer - byte",value:"integer_1"}),n}var bn=Object(l["h"])({setup(){const e=Object(l["i"])("viewer"),t=Object(l["b"])(()=>e.editHeader.value&&Object(l["o"])(e.editHeader.value));{let n=null;Object(l["C"])(t,t=>{n&&(n(),n=null),t&&(n=Object(l["C"])(t,()=>{Object(l["y"])(e.headers),Ce(e)},{deep:!0}))})}const n=Object(l["b"])(()=>e.columnStats.value[t.value.offset]),a=Object(l["b"])({get(){const e=t.value.type;return e.array?"array":e.string?"string":e.key?e.key.foreign?"key_foreign":"key_self":e.integer?"integer":e.decimal?"decimal":e.boolean?"boolean":void 0},set(e){const n=t.value;n.type={},"array"===e?(n.type.array=!0,n.type.byteView={array:!0}):"string"===e?n.type.string={}:"key_foreign"===e?n.type.key={foreign:!0}:"key_self"===e?n.type.key={foreign:!1}:"integer"===e?n.type.integer={unsigned:!0,size:n.length}:"decimal"===e?n.type.decimal={size:n.length}:"boolean"===e&&(n.type.boolean={})}}),o=Object(l["b"])({get(){const e=t.value.type;return e.string?"string":e.key?e.key.foreign?"key_foreign":"key_self":e.integer?"integer_"+e.integer.size:e.decimal?"decimal_"+e.decimal.size:e.boolean?"boolean":void 0},set(e){const n=t.value;n.type={array:!0},"string"===e?n.type.string={}:"key_foreign"===e?n.type.key={foreign:!0}:"key_self"===e?n.type.key={foreign:!1}:"integer_1"===e?n.type.integer={unsigned:!0,size:1}:"integer_2"===e?n.type.integer={unsigned:!0,size:2}:"integer_4"===e?n.type.integer={unsigned:!0,size:4}:"integer_8"===e?n.type.integer={unsigned:!0,size:8}:"decimal_4"===e?n.type.decimal={size:4}:"decimal_8"===e?n.type.decimal={size:8}:"boolean"===e&&(n.type.boolean={})}}),r=Object(l["b"])(()=>{const e=[],n=t.value.type;return e.push({label:"Bytes",value:"bytes"}),n.array&&e.push({label:"Var. bytes",value:"array-bytes"}),e.push({label:"Data",value:"data",disabled:!a.value||"array"===a.value&&!o.value}),e}),i=Object(l["b"])({get(){const e=t.value.type;return e.byteView?e.byteView.array?"array-bytes":"bytes":"data"},set(e){const n=t.value.type;n.byteView="data"===e?void 0:{array:"array-bytes"===e}}});function c(){e.editHeader.value=null}function s(){pe(t.value,e.headers.value),e.editHeader.value=null,Object(l["y"])(e.headers),Ce(e)}return{isVisible:Object(l["b"])(()=>null!=e.editHeader.value),HEADERS_HEIGHT:Ot,header:t,byteViewMode:i,dataType:a,arrayType:o,close:c,remove:s,viewModeOpts:r,dataTypeOpts:Object(l["b"])(()=>un(t.value,n.value,e.datFile)),arrayTypeOpts:Object(l["b"])(()=>dn(t.value,n.value))}}});bn.render=sn;var fn=bn;const hn=Math.ceil(3*ft);function pn(e,t,n,l,a){const o=[];let r=0;for(const i of n){const n=Tt(i);if(i.type.byteView&&!i.type.byteView.array){let c=r;for(let r=0;r<i.length;++r){const s=n.hasBorder&&0===r,u=3*ft+(s?yt:0);if(Math.ceil(c)+u<l){c+=u;continue}const d=i.offset+r;if(o.push({offset:d,selected:e[d],border:s,widthPx:hn,leftPx:Math.ceil(c),text:String(d%100).padStart(2,"0"),stat:t[d]}),c+=u,Math.ceil(c)>=a)return o}}else r+n.borderWidth>=l&&o.push({offset:i.offset,selected:!1,border:n.hasBorder,widthPx:n.paddingWidth,leftPx:r,text:String(i.offset%100).padStart(2,"0")});if(r+=n.borderWidth,r>=a)return o}return o}function vn(e,t){const n=e.map(e=>({max:e.bMax.toString(16).padStart(2,"0"),array:!1,string:!1,nullable:!1,zero:0===e.bMax})),{fieldSize:l}=t;for(let a=0;a<e.length;++a){const o=e[a];if(o.refString)for(let e=0;e<l.STRING;++e)n[a+e].string=!0;if(o.refArray)for(let e=0;e<l.ARRAY;++e)n[a+e].array=!0;if(o.nullableMemsize)for(let e=0;e<t.memsize;++e)n[a+e].nullable=!0}return n}var yn=Object(l["h"])({components:{ResizeObserver:Y,CanvasScroll:ae,ViewerActions:De,ViewerHead:Et,HeaderProps:fn},emits:["update:kaState"],props:{args:{type:Object,required:!0},kaState:{type:Object,default:void 0}},setup(e,t){let n;e.kaState?n=e.kaState:(n=Se(e.args.fullPath,e.args.fileContent),t.emit("update:kaState",n)),Object(l["n"])("viewer",n);const a=Object(l["q"])(null),o=Object(l["q"])(null);Object(l["l"])(()=>{o.value.scrollTo(n.scrollPos.x,n.scrollPos.y)});const r=Object(l["b"])(()=>n.rowSorting.value?n.rowSorting.value:Array.from({length:n.datFile.rowCount},(e,t)=>t)),i=Object(l["q"])(0),c=Object(l["q"])(0);function s(e){i.value=e.width,c.value=e.height}const{scrollPos:u}=n;function d(e){u.x=e.x,u.y=e.y}const b=Object(l["b"])(()=>$t(n.headers.value)),f=Object(l["b"])(()=>n.datFile.rowCount*pt),h=Object(l["b"])(()=>wt(n.datFile.rowCount)),p=Object(l["b"])(()=>Math.max(0,i.value-h.value)),v=Object(l["b"])(()=>Math.max(0,c.value-Ot));Object(l["C"])([p,v],()=>{const e=devicePixelRatio;a.value.style.width=p.value+"px",a.value.style.height=v.value+"px",a.value.width=p.value*e,a.value.height=v.value*e;const t=a.value.getContext("2d",{alpha:!1});t.scale(e,e),m()});const y=Object(l["b"])(()=>vn(n.columnStats.value,n.datFile)),g=Object(l["b"])(()=>pn(n.columnSelection.value,y.value,n.headers.value,u.x,u.x+Math.min(b.value,p.value)));function m(){const e=a.value.getContext("2d",{alpha:!1});_t({left:u.x,paintWidth:p.value,top:O.value.top,rows:O.value.ids,columns:g.value,viewer:n,ctx:e})}Object(l["C"])([u,g,r,n.selectedRow],()=>{m()});const O=Object(l["b"])(()=>{const e=u.y,t=Math.ceil(v.value/pt)+1,n=Math.floor(e/pt),l=n*pt-e;return{top:l,ids:r.value.slice(n,n+t)}});function j(){const e=n.editHeader.value,t=Pt(n.headers.value,null,0,1/0),l=t.find(t=>t.offset===e.offset);o.value.scrollTo(l.leftPx-.33*p.value,void 0)}function x(e){const{selectedRow:t}=n,l=Math.floor((e.offsetY+u.y)/pt);t.value=t.value!==l?l:null}return{headerBlockStyle:Object(l["b"])(()=>({height:Ot+"px",width:i.value+"px"})),headerOverlayContentStyle:Object(l["b"])(()=>({left:h.value+"px",height:Ot+"px",width:p.value+"px"})),scrollableStyle:Object(l["b"])(()=>({top:Ot+"px",left:h.value+"px"})),scrollablePaintSize:Object(l["b"])(()=>({width:p.value,height:v.value})),scrollableFullSize:Object(l["b"])(()=>({width:b.value,height:f.value})),rowsOverlayStyle:Object(l["b"])(()=>({top:Ot+"px",width:h.value+"px",height:v.value+"px",fontFamily:dt,fontSize:bt+"px",lineHeight:pt+"px"})),handleScroll:d,handleResize:s,renderItems:O,canvasRef:a,renderColumns:g,scrollLeft:Object(l["b"])(()=>u.x),rowsWidth:Object(l["b"])(()=>Math.min(b.value,p.value)),LINE_HEIGHT:pt,canvasScroll:o,rowsNumberWidth:xt(n.datFile.rowCount)+"px",focusEditingHeader:j,handleCanvasClick:x}}}),gn=n("f3a1");const mn=yn.__cssModules={};mn["$style"]=gn["default"],yn.render=B;var On=yn,jn=Object(l["h"])({setup(){const e=Object(l["q"])(localStorage.getItem("POE_PATCH_VER")||""),t=Object(l["q"])(!1);async function n(e){const t=e.target.files[0],n=new Uint8Array(await t.arrayBuffer()),l=t.name;Cn({id:"file@"+l,title:l,type:On,args:{fileContent:n,fullPath:l}})}async function a(){let n;try{t.value=!0,n=await M(e.value,"_.index.bin")}finally{t.value=!1}try{await V(n),localStorage.setItem("POE_PATCH_VER",e.value)}catch(l){throw window.alert(l.message),l}}return e.value&&!A.value&&a(),{poePatch:e,isCdnImportRunning:t,handleFile:n,cdnImport:a}}}),xn=n("d70b");const wn=jn.__cssModules={};wn["$style"]=xn["default"],jn.render=z;var Sn=jn;const kn=Object(l["w"])("poe-dat-viewer@import");function zn(e){kn.value=e}const _n=Object(l["w"])([{id:"poe-dat-viewer@import",title:"Import",type:Sn,args:void 0,kaState:void 0}]);function Cn(e){const t=_n.value.find(t=>t.id===e.id);t||_n.value.push({id:e.id,title:e.title,type:e.type,args:e.args,kaState:void 0}),zn(e.id),Object(l["y"])(_n)}function Mn(e){const t=_n.value.findIndex(t=>t.id===e);e===kn.value&&(t+1<_n.value.length?zn(_n.value[t+1].id):zn(0!==t?_n.value[t-1].id:null)),_n.value=_n.value.filter(t=>t.id!==e)}var Tn=Object(l["h"])({setup(){const e=Object(l["b"])(()=>_n.value.map(e=>({id:e.id,title:e.title,isActive:e.id===kn.value})));function t(){Cn({id:"poe-dat-viewer@import",title:"Import",type:Sn,args:void 0})}return{tabs:e,setActiveTab:zn,closeTab:Mn,openImport:t}}}),$n=n("b9d8");const Pn=Tn.__cssModules={};Pn["$style"]=$n["default"],Tn.render=g;var In=Tn;const En={class:"flex p-1 items-center mb-px"},Rn=Object(l["g"])("i",{class:"codicon codicon-list-flat"},null,-1),Ln={key:0,class:"flex gap-x-1 border-b pb-1.5 px-2 justify-end"},Fn={key:1,class:"italic text-center text-gray-600 p-2"},An={key:2,class:"italic text-center text-gray-600 p-2"},Hn={key:0,class:"codicon codicon-folder pr-3"};function Vn(e,t,n,a,o,r){const i=Object(l["t"])("virtual-scroll");return Object(l["m"])(),Object(l["d"])("div",{class:"layout-column flex-shrink-0",style:{width:e.showTree?"300px":void 0}},[Object(l["g"])("div",En,[Object(l["g"])("button",{title:"Toggle tree visibility",class:e.$style.treeToggle,onClick:t[1]||(t[1]=(...t)=>e.toggleTree&&e.toggleTree(...t))},[Rn],2),e.showTree?Object(l["E"])((Object(l["m"])(),Object(l["d"])("input",{key:0,"onUpdate:modelValue":t[2]||(t[2]=t=>e.searchText=t),placeholder:"Search in current folder",class:e.$style.searchInput,type:"search",spellcheck:"false"},null,2)),[[l["B"],e.searchText,void 0,{trim:!0}]]):Object(l["e"])("",!0)]),e.showTree?(Object(l["m"])(),Object(l["d"])(l["a"],{key:0},[e.extensionOpts?(Object(l["m"])(),Object(l["d"])("div",Ln,[(Object(l["m"])(!0),Object(l["d"])(l["a"],null,Object(l["r"])(e.extensionOpts,e=>(Object(l["m"])(),Object(l["d"])("button",{key:e.value,onClick:e.handleClick,class:["px-2",e.active?"bg-gray-300":"hover:bg-gray-200"],textContent:Object(l["x"])(e.value)},null,10,["onClick","textContent"]))),128))])):Object(l["e"])("",!0),e.isIndexLoaded?Object(l["e"])("",!0):(Object(l["m"])(),Object(l["d"])("div",Fn,"Waiting for Index bundle...")),e.isIndexLoaded&&!e.tree.length?(Object(l["m"])(),Object(l["d"])("div",An,"No results found")):Object(l["e"])("",!0),Object(l["g"])(i,{class:"flex-1","scrollable-props":{style:"background: #fff;",widthY:10},items:e.tree,"item-height":22},{default:Object(l["D"])(t=>[(Object(l["m"])(!0),Object(l["d"])(l["a"],null,Object(l["r"])(t.entries,t=>(Object(l["m"])(),Object(l["d"])("button",{key:t.item.fullPath,class:{[e.$style.itemBtn]:!0,[e.$style.active]:t.item.isActive},style:{transform:`translate(0, ${t.top}px`},onClick:n=>e.handleTreeNav(t.item)},[t.item.isFile?Object(l["e"])("",!0):(Object(l["m"])(),Object(l["d"])("i",Hn)),Object(l["f"])(Object(l["x"])(t.item.label),1)],14,["onClick"]))),128))]),_:1},8,["items"])],64)):Object(l["e"])("",!0)],4)}function Dn(e,t,n,a,o,r){const i=Object(l["t"])("canvas-scroll"),c=Object(l["t"])("resize-observer");return Object(l["m"])(),Object(l["d"])(c,{onResize:e.handleResize,class:"relative"},{default:Object(l["D"])(()=>[Object(l["g"])(i,Object(l["j"])({ref:"scrollable"},e.scrollableProps,{class:"absolute","paint-size":e.paintSize,"full-size":e.fullSize}),{default:Object(l["D"])(()=>[Object(l["s"])(e.$slots,"default",{entries:e.renderItems})]),_:3},16,["paint-size","full-size"])]),_:1},8,["onResize"])}var Bn=Object(l["h"])({components:{ResizeObserver:Y,CanvasScroll:ae},props:{items:{type:Array,required:!0},itemHeight:{type:Number,required:!0},scrollableProps:{type:Object,default:()=>({})}},setup(e){const t=Object(l["v"])({width:0,height:0}),n=Object(l["b"])(()=>({width:t.width,height:e.items.length*e.itemHeight}));function a(e){t.width=e.width,t.height=e.height}const o=Object(l["q"])(null),r=Object(l["b"])(()=>{var n,l;const a=null!==(l=null===(n=o.value)||void 0===n?void 0:n.scrollPos.y)&&void 0!==l?l:0,r=Math.ceil(t.height/e.itemHeight)+1,i=Math.floor(a/e.itemHeight),c=i*e.itemHeight-a;return e.items.slice(i,i+r).map((t,n)=>({top:c+n*e.itemHeight,item:t}))});return{handleResize:a,paintSize:t,fullSize:n,scrollable:o,renderItems:r}}});Bn.render=Dn;var Nn=Bn,Wn=n("f4ae");function Yn(){return Date.now()}function qn(e,t){const n=Date.now()-t;console.log(`${e}. Done in -> ${n} ms`)}function Gn(e,t){const n=Yn(),l=t();return qn(e,n),l}function Un(){const e=Object(l["w"])("");Object(l["C"])(A,()=>{e.value=""});const t=Object(l["b"])(()=>{if(!A.value)return[];if(""===e.value){const e=Gn("Getting root dirs",()=>Object(Wn["getRootDirs"])(A.value.pathReps,A.value.dirsInfo));return e.map(e=>({label:e,fullPath:e,isFile:!1})).sort((e,t)=>e.label.localeCompare(t.label))}const t=Gn(`Getting "${e.value}" dir`,()=>Object(Wn["getDirContent"])(e.value,A.value.pathReps,A.value.dirsInfo));return[{label:"../",fullPath:-1===e.value.indexOf("/")?"":e.value.split("/").slice(0,-1).join("/"),isFile:!1},...t.dirs.map(t=>({label:t.substr(e.value.length+1),fullPath:t,isFile:!1})).sort((e,t)=>e.label.localeCompare(t.label)),...t.files.map(t=>({label:t.substr(e.value.length+1),fullPath:t,isFile:!0,isActive:"bundles@"+t===kn.value})).sort((e,t)=>e.label.localeCompare(t.label))]});async function n(t){if(t.isFile){const e=await H(t.fullPath);t.fullPath.endsWith(".dat")||t.fullPath.endsWith(".dat64")?Cn({id:"bundles@"+t.fullPath,title:t.label,type:On,args:{fileContent:e,fullPath:t.fullPath}}):Fe.a.saveAs(new File([e],t.fullPath.substring(t.fullPath.lastIndexOf("/")+1),{type:"application/octet-stream"}))}else e.value=t.fullPath}return{currentDir:e,tree:t,handleTreeNav:n}}var Xn=Object(l["h"])({components:{VirtualScroll:Nn},setup(){const e=Object(l["w"])(!0);function t(){e.value=!e.value}const n=Object(l["b"])(()=>Boolean(A.value)),{tree:a,handleTreeNav:o,currentDir:r}=Un(),i=Object(l["w"])(".dat64"),c=Object(l["b"])(()=>r.value.startsWith("Data")?[".dat",".dat64",".datl",".datl64"].map(e=>({value:e,active:i.value===e,handleClick:()=>{i.value=e}})):null),s=Object(l["w"])(""),u=Object(l["b"])(()=>{const e=s.value.toLowerCase(),t=c.value?i.value:"";return a.value.filter(n=>n.label.toLowerCase().includes(e)&&(!n.isFile||n.label.endsWith(t)))});return{showTree:e,toggleTree:t,tree:u,handleTreeNav:o,searchText:s,isIndexLoaded:n,extensionOpts:c}}}),Kn=n("bbf7");const Jn=Xn.__cssModules={};Jn["$style"]=Kn["default"],Xn.render=Vn;var Qn=Xn;const Zn=Object(l["g"])("div",{class:"bg-gray-300 h-1"},null,-1),el={class:"p-3"},tl={class:"font-semibold truncate"},nl={class:"text-grey text-sm"},ll=Object(l["f"])("Downloading...");function al(e,t,n,a,o,r){return e.active?(Object(l["m"])(),Object(l["d"])("div",{key:0,class:e.$style.notification},[e.totalSize?(Object(l["m"])(),Object(l["d"])(l["a"],{key:0},[Zn,Object(l["g"])("div",{class:"bg-blue-500 h-1 absolute top-0",style:{width:e.received/e.totalSize*100+"%"}},null,4)],64)):Object(l["e"])("",!0),Object(l["g"])("div",el,[Object(l["g"])("div",tl,Object(l["x"])(e.bundleName),1),Object(l["g"])("div",nl,[e.totalSize?(Object(l["m"])(),Object(l["d"])(l["a"],{key:0},[Object(l["f"])(Object(l["x"])((e.totalSize/1e6).toFixed(1))+" MB",1)],64)):(Object(l["m"])(),Object(l["d"])(l["a"],{key:1},[ll],64))])])],2)):Object(l["e"])("",!0)}var ol=Object(l["h"])({setup(){return C}}),rl=n("81ee");const il=ol.__cssModules={};il["$style"]=rl["default"],ol.render=al;var cl=ol,sl=Object(l["h"])({components:{IndexTree:Qn,ViewerTabs:In,DownloadProgress:cl},setup(){const e=Object(l["b"])(()=>_n.value.find(e=>e.id===kn.value));return{activeTab:e,appVersion:"3.1.0"}}});n("54fc");sl.render=b;var ul=sl;Object(l["c"])(ul).mount("#app")},d438:function(e,t,n){"use strict";var l=n("1735"),a=n.n(l);n.d(t,"default",(function(){return a.a}))},d70b:function(e,t,n){"use strict";var l=n("f17d"),a=n.n(l);n.d(t,"default",(function(){return a.a}))},e21f:function(e,t,n){},f17d:function(e,t,n){e.exports={input:"ImportDialog_input_BOtpT",label:"ImportDialog_label_2ZOy1"}},f3a1:function(e,t,n){"use strict";var l=n("b2e0"),a=n.n(l);n.d(t,"default",(function(){return a.a}))}});
//# sourceMappingURL=app.84dffbc4.js.map