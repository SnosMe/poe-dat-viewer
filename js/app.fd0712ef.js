(function(e){function t(t){for(var l,o,i=t[0],c=t[1],s=t[2],d=0,b=[];d<i.length;d++)o=i[d],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&b.push(a[o][0]),a[o]=0;for(l in c)Object.prototype.hasOwnProperty.call(c,l)&&(e[l]=c[l]);u&&u(t);while(b.length)b.shift()();return r.push.apply(r,s||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],l=!0,i=1;i<n.length;i++){var c=n[i];0!==a[c]&&(l=!1)}l&&(r.splice(t--,1),e=o(o.s=n[0]))}return e}var l={},a={app:0},r=[];function o(t){if(l[t])return l[t].exports;var n=l[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=l,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)o.d(n,l,function(t){return e[t]}.bind(null,l));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/poe-dat-viewer/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var s=0;s<i.length;s++)t(i[s]);var u=c;r.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},1189:function(e,t,n){"use strict";var l=n("38f4"),a=n.n(l);n.d(t,"default",(function(){return a.a}))},1735:function(e,t,n){e.exports={scrollable:"CanvasScroll_scrollable_KuF3M",track:"CanvasScroll_track_35adi",y:"CanvasScroll_y_3fkOa",x:"CanvasScroll_x_1YqgW",thumb:"CanvasScroll_thumb_3n3go"}},1956:function(e,t,n){e.exports={rowsOverlay:"DatViewer_rowsOverlay_kP3aC",canvasShadow:"DatViewer_canvasShadow_1Eo-r"}},"347e":function(e,t,n){e.exports={titlebar:"Tabs_titlebar_6nlgm",tab:"Tabs_tab_36pp7",active:"Tabs_active_1qu2U"}},"38f4":function(e,t,n){e.exports={treeToggle:"IndexTree_treeToggle_3Gb6L",searchInput:"IndexTree_searchInput_nlhBz",itemBtn:"IndexTree_itemBtn_1tEbV"}},"49c3":function(e,t,n){e.exports={notification:"DownloadProgress_notification_1cAoN"}},"54fc":function(e,t,n){"use strict";n("e21f")},"772a":function(e,t,n){"use strict";var l=n("347e"),a=n.n(l);n.d(t,"default",(function(){return a.a}))},"782d":function(e,t,n){e.exports=n.p+"img/discord-badge.b9bc316a.svg"},"81b1":function(e,t,n){"use strict";n("afe1")},"81ee":function(e,t,n){"use strict";var l=n("49c3"),a=n.n(l);n.d(t,"default",(function(){return a.a}))},8352:function(e,t,n){"use strict";var l=n("c8e6"),a=n.n(l);n.d(t,"default",(function(){return a.a}))},afe1:function(e,t,n){},c8e6:function(e,t,n){e.exports={bar:"Actions_bar_3gEfG"}},cd49:function(e,t,n){"use strict";n.r(t);var l=n("7a23"),a=n("782d"),r=n.n(a);const o={class:"layout-column flex-1 min-w-0"},i={class:"layout-column flex-1 min-h-0"},c={key:1,class:"bg-gray-100 flex-1 text-lg text-gray-600 flex items-center justify-center"},s={class:"app-footer"},u=Object(l["g"])("a",{class:"q-link text-white border-b",href:"https://github.com/SnosMe/poe-dat-viewer"},"GitHub",-1),d=Object(l["g"])("a",{href:"https://discord.gg/SJjBdT3",class:"flex ml-8"},[Object(l["g"])("img",{src:r.a})],-1);function b(e,t,n,a,r,b){const f=Object(l["t"])("index-tree"),h=Object(l["t"])("viewer-tabs"),p=Object(l["t"])("download-progress");return Object(l["m"])(),Object(l["d"])(l["a"],null,[Object(l["g"])(f),Object(l["g"])("div",o,[Object(l["g"])(h),Object(l["g"])("div",i,[e.activeTab?(Object(l["m"])(),Object(l["d"])(Object(l["u"])(e.activeTab.type),{args:e.activeTab.args,key:e.activeTab.id,"ka-state":e.activeTab.kaState,"onUpdate:ka-state":t[1]||(t[1]=t=>e.activeTab.kaState=t)},null,8,["args","ka-state"])):(Object(l["m"])(),Object(l["d"])("div",c,"The viewer is ready to fulfill your wishes ðŸ‘¾"))]),Object(l["g"])("div",s,[Object(l["g"])("div",null,[Object(l["f"])("Made by Alexander Drozdov, v"+Object(l["x"])(e.appVersion)+" ",1),u]),d])]),Object(l["g"])(p)],64)}const f={class:"flex overflow-hidden divide-x divide-gray-700"},h=Object(l["g"])("i",{class:"codicon codicon-close"},null,-1),p={class:"flex p-1.5 flex-shrink-0 space-x-1"},y=Object(l["g"])("button",{class:"hover:bg-gray-400 hover:text-black px-2",title:"Help"},[Object(l["g"])("i",{class:"codicon codicon-question"})],-1),v=Object(l["g"])("button",{class:"hover:bg-gray-400 hover:text-black px-2",title:"Settings"},[Object(l["g"])("i",{class:"codicon codicon-settings"})],-1);function g(e,t,n,a,r,o){return Object(l["m"])(),Object(l["d"])("div",{class:e.$style.titlebar},[Object(l["g"])("div",f,[(Object(l["m"])(!0),Object(l["d"])(l["a"],null,Object(l["r"])(e.tabs,t=>(Object(l["m"])(),Object(l["d"])("div",{key:t.id,class:[e.$style.tab,{[e.$style.active]:t.isActive}]},[Object(l["g"])("button",{class:"pl-3 pr-1.5",onClick:n=>e.setActiveTab(t.id)},Object(l["x"])(t.title),9,["onClick"]),Object(l["g"])("button",{class:"pl-1.5 pr-3",title:"Close",onClick:n=>e.closeTab(t.id)},[h],8,["onClick"])],2))),128))]),Object(l["g"])("div",p,[Object(l["g"])("button",{class:"hover:bg-gray-400 hover:text-black p-2",onClick:t[1]||(t[1]=(...t)=>e.openImport(...t))},"Import"),y,v])],2)}const m={class:"p-4 overflow-auto border-l flex-1 text-base"},O={class:"inline-flex items-baseline border-b pb-2"},j={style:{width:"200px"},class:"my-1"},x={style:{width:"100px"},class:"m-1"},w={style:{width:"220px"},class:"my-1"},S={class:"flex items-baseline mt-3"},k=Object(l["g"])("label",{class:"bg-gray-200 py-1 px-2 cursor-pointer hover:bg-gray-400",style:{width:"250px"},for:"import-local-file"},"Pick local file",-1);function z(e,t,n,a,r,o){return Object(l["m"])(),Object(l["d"])("div",m,[Object(l["g"])("div",O,[Object(l["g"])("div",j,[Object(l["g"])("input",{value:"patchcdn.pathofexile.com/",readonly:"",class:e.$style.input},null,2),Object(l["g"])("label",{class:e.$style.label},"Patch CDN",2)]),Object(l["g"])("div",x,[Object(l["E"])(Object(l["g"])("input",{"onUpdate:modelValue":t[1]||(t[1]=t=>e.poePatch=t),placeholder:"3.12.x.x.x",class:e.$style.input},null,2),[[l["B"],e.poePatch,void 0,{trim:!0}]]),Object(l["g"])("label",{class:e.$style.label},"Patch #",2)]),Object(l["g"])("div",w,[Object(l["g"])("input",{value:"/Bundles2/_.index.bin",readonly:"",class:e.$style.input},null,2),Object(l["g"])("label",{class:e.$style.label},"Index",2)]),Object(l["g"])("button",{class:"ml-1 py-1 px-3 bg-blue-600 text-white hover:bg-blue-800",onClick:t[2]||(t[2]=(...t)=>e.cdnImport(...t)),disabled:e.isCdnImportRunning,loading:e.isCdnImportRunning},Object(l["x"])(e.isCdnImportRunning?"Wait...":"Import"),9,["disabled","loading"])]),Object(l["g"])("div",S,[k,Object(l["g"])("input",{class:"hidden",id:"import-local-file",type:"file",accept:".dat,.dat64",onInput:t[3]||(t[3]=(...t)=>e.handleFile(...t))},null,32)])])}const _="Bundles2",M=Object(l["o"])({totalSize:0,received:0,active:!1,bundleName:""});async function C(e,t){if(null==e&&(e=localStorage.getItem("POE_PATCH_VER"),!e))throw new Error("never");try{return await T(e,t)}catch(n){throw window.alert("You may need to adjust the patch version."),n}}async function T(e,t){const n=`${e}/${_}/${t}`;let l=await caches.open("bundles"),a=await l.match(n);if(!a){if(M.totalSize=0,M.received=0,M.active=!0,M.bundleName=t,a=await fetch("https://poe-bundles.snos.workers.dev/"+n),200!==a.status)throw M.active=!1,new Error(`patchcdn: ${a.status} ${a.statusText}`);let r;M.totalSize=Number(a.headers.get("content-length"));try{const e=a.body.getReader(),t=[];while(1){const{done:n,value:l}=await e.read();if(n)break;t.push(l),M.received+=l.length}r=new Uint8Array(M.received);let n=0;for(const l of t)r.set(l,n),n+=l.length}finally{M.active=!1}return localStorage.getItem("POE_PATCH_VER")!==e&&(await caches.delete("bundles"),l=await caches.open("bundles")),await l.put(n,new Response(r,{headers:{"content-length":String(r.byteLength),"content-type":"application/octet-stream"}})),r.buffer}return a.arrayBuffer()}function $(){return new Worker(n.p+"js/script.39b60a66.worker.js")}var P=n("3d15");const I=P["b"](new $);function E(e){if(0===e.byteOffset&&e.byteLength===e.buffer.byteLength)return I.decompressSliceInBundle(e);{const t=new Uint8Array(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength));return I.decompressSliceInBundle(P["a"](e,[t.buffer]))}}function R(e,t,n){return I.decompressSliceInBundle(P["a"](new Uint8Array(e),[e]),t,n)}function L(e){return I.analyzeDatFile(e)}var F=n("edca");const A=Object(l["w"])(null);async function H(e){const t=Object(F["getFileInfo"])(e,A.value.bundlesInfo,A.value.filesInfo),n=await C(null,t.bundle);return R(n,t.offset,t.size)}async function V(e){const t=await E(new Uint8Array(e)),n=Object(F["readIndexBundle"])(t);A.value={bundlesInfo:n.bundlesInfo,filesInfo:n.filesInfo,dirsInfo:n.dirsInfo,pathReps:await E(n.pathRepsBundle)}}const D={class:"flex flex-1"},B={ref:"canvasRef"};function N(e,t,n,a,r,o){const i=Object(l["t"])("viewer-actions"),c=Object(l["t"])("viewer-head"),s=Object(l["t"])("canvas-scroll"),u=Object(l["t"])("resize-observer"),d=Object(l["t"])("header-props");return Object(l["m"])(),Object(l["d"])(l["a"],null,[Object(l["g"])(i),Object(l["g"])("div",D,[Object(l["g"])(u,{onResize:e.handleResize,class:"flex-1 min-h-0 relative"},{default:Object(l["D"])(()=>[Object(l["g"])("div",{class:"bg-gray-200 absolute",style:e.headerBlockStyle},[Object(l["g"])(c,{style:e.headerOverlayContentStyle,left:e.scrollLeft,width:e.rowsWidth,columns:e.renderColumns},null,8,["style","left","width","columns"])],4),Object(l["g"])(s,{ref:"canvasScroll",class:"absolute bg-white",onScroll:e.handleScroll,style:e.scrollableStyle,"paint-size":e.scrollablePaintSize,"full-size":e.scrollableFullSize},{default:Object(l["D"])(()=>[Object(l["g"])("canvas",B,null,512),Object(l["g"])("div",{class:e.$style.canvasShadow},null,2)]),_:1},8,["onScroll","style","paint-size","full-size"]),Object(l["g"])("div",{class:e.$style.rowsOverlay,style:e.rowsOverlayStyle},[Object(l["g"])("div",{class:"absolute",style:{transform:`translate(0, ${e.renderItems.top}px)`}},[(Object(l["m"])(!0),Object(l["d"])(l["a"],null,Object(l["r"])(e.renderItems.ids,(t,n)=>(Object(l["m"])(),Object(l["d"])("div",{key:t,style:{transform:`translate(0, ${n*e.LINE_HEIGHT}px)`,width:e.rowsNumberWidth,position:"absolute"},textContent:Object(l["x"])(t)},null,12,["textContent"]))),128))],4)],6)]),_:1},8,["onResize"]),Object(l["g"])(d)])],64)}function W(e,t,n,a,r,o){return Object(l["m"])(),Object(l["d"])(Object(l["u"])(e.tag),{ref:"rootEl","data-role":"resize-observer"},{default:Object(l["D"])(()=>[Object(l["s"])(e.$slots,"default")]),_:3},512)}var Y=Object(l["h"])({props:{tag:{type:String,default:"div"}},emits:["resize"],setup(e,t){const n=Object(l["q"])(null);return Object(l["l"])(()=>{const e=new ResizeObserver(e=>{t.emit("resize",{width:e[0].contentRect.width,height:e[0].contentRect.height})});e.observe(n.value),Object(l["k"])(()=>{e.unobserve(n.value)})}),{rootEl:n}}});Y.render=W;var q=Y;function G(e,t,n,a,r,o){return Object(l["m"])(),Object(l["d"])("div",{class:e.$style.scrollable,style:{width:e.paintSize.width+"px",height:e.paintSize.height+"px"},onMousedown:t[3]||(t[3]=(...t)=>e.handleMousedown(...t)),onWheel:t[4]||(t[4]=(...t)=>e.handleMousewheel(...t))},[Object(l["s"])(e.$slots,"default"),e.scrollbarY?(Object(l["m"])(),Object(l["d"])("div",{key:0,class:`${e.$style.track} ${e.$style.y}`,onMousedown:t[1]||(t[1]=(...t)=>e.handleTrackMousedownY(...t)),style:{width:e.scrollbarY.fixedSize+"px",height:e.scrollbarY.trackSize+"px"}},[Object(l["g"])("div",{class:e.$style.thumb,style:{transform:`translate(0, ${e.scrollbarY.thumbPos}px)`,width:e.scrollbarY.fixedSize+"px",height:e.scrollbarY.thumbSize+"px"}},null,6)],38)):Object(l["e"])("",!0),e.scrollbarX?(Object(l["m"])(),Object(l["d"])("div",{key:1,class:`${e.$style.track} ${e.$style.x}`,onMousedown:t[2]||(t[2]=(...t)=>e.handleTrackMousedownX(...t)),style:{width:e.scrollbarX.trackSize+"px",height:e.scrollbarX.fixedSize+"px"}},[Object(l["g"])("div",{class:e.$style.thumb,style:{transform:`translate(${e.scrollbarX.thumbPos}px, 0)`,width:e.scrollbarX.thumbSize+"px",height:e.scrollbarX.fixedSize+"px"}},null,6)],38)):Object(l["e"])("",!0)],38)}const U=40,X=15,K=100,J=(e,t)=>Math.max(1,Math.pow(.003*e*t,2))*Math.sign(e);function Z(e,t,n,l,a){var r;if(n<=t)return null;const o=Math.max(0,t-(null!==(r=null===l||void 0===l?void 0:l.fixedSize)&&void 0!==r?r:0)),i=Math.max(U,Math.floor(t*o/n)),c=(o-i)/(n-t),s=Math.round(a*c);return{trackSize:o,thumbSize:i,fixedSize:e,thumbRatio:c,thumbPos:s}}function Q(e){let t=0,n=0,l=0,a=0,r=null,o=0,i=0;function c(e){1===e.button&&(e.preventDefault(),e.stopPropagation(),document.body.style.cursor="all-scroll",r=null,t=e.clientY,n=e.clientX,l=0,a=0,o=0,i=requestAnimationFrame(d),document.addEventListener("mousemove",u),document.addEventListener("mouseup",s),document.addEventListener("mouseleave",s))}function s(){cancelAnimationFrame(i),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",s),document.removeEventListener("mouseleave",s),document.body.style.removeProperty("cursor")}function u(e){const o=e.clientY-t,i=e.clientX-n;if(null===r)if(Math.abs(o)>X)r="vertical",document.body.style.cursor="ns-resize";else{if(!(Math.abs(i)>X))return;r="horizontal",document.body.style.cursor="ew-resize"}"vertical"===r?l=o:a=i}function d(t){const n=t-(o||t);o=t,i=requestAnimationFrame(d),e(J(a,n),J(l,n))}return{handleMousedown:c}}function ee(e){function t(t){e(0,Math.sign(t.deltaY)*K)}return{handleMousewheel:t}}function te(e,t,n){let l=0,a=0;const r="y"===t?"y":"x",o="y"===t?"clientY":"clientX";function i(t){t.preventDefault(),t.stopPropagation();const n=t.currentTarget;if(l=n.getBoundingClientRect()[r],t.target!==n){const e=t.target;a=t[o]-e.getBoundingClientRect()[r]}else a=e.value.thumbSize/2,c(t),a=t[o]-l-e.value.thumbPos;document.addEventListener("mousemove",c),document.addEventListener("mouseup",s),document.addEventListener("mouseleave",s)}function c(r){const i=(r[o]-l-a)/e.value.thumbRatio;"x"===t?n(i,void 0):n(void 0,i)}function s(){document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",s),document.removeEventListener("mouseleave",s)}return{handleTrackMousedown:i}}var ne=Object(l["h"])({props:{paintSize:{type:Object,required:!0},fullSize:{type:Object,required:!0},widthY:{type:Number,default:14},widthX:{type:Number,default:12}},emits:["scroll"],setup(e,t){const n=Object(l["v"])({y:0,x:0});Object(l["C"])(()=>[e.paintSize,e.fullSize],()=>{const{paintSize:t,fullSize:l}=e;n.x=Math.max(0,Math.min(n.x,l.width-t.width)),n.y=Math.max(0,Math.min(n.y,l.height-t.height))},{deep:!0}),Object(l["C"])(n,()=>{t.emit("scroll",{y:n.y,x:n.x})});const a=Object(l["b"])(()=>Z(e.widthY,e.paintSize.height,e.fullSize.height,null,n.y)),r=Object(l["b"])(()=>Z(e.widthX,e.paintSize.width,e.fullSize.width,a.value,n.x));function o(t,l){const{paintSize:a,fullSize:r}=e;n.y=Math.max(0,Math.min(n.y+Math.floor(l),r.height-a.height)),n.x=Math.max(0,Math.min(n.x+Math.floor(t),r.width-a.width))}function i(t,l){const{paintSize:a,fullSize:r}=e;void 0!==t&&(n.x=Math.max(0,Math.min(Math.floor(t),r.width-a.width))),void 0!==l&&(n.y=Math.max(0,Math.min(Math.floor(l),r.height-a.height)))}return{scrollbarY:a,scrollbarX:r,scrollPos:Object(l["p"])(n),scrollTo:i,scrollByDelta:o,handleMousedown:Q(o).handleMousedown,handleMousewheel:ee(o).handleMousewheel,handleTrackMousedownY:te(a,"y",i).handleTrackMousedown,handleTrackMousedownX:te(r,"x",i).handleTrackMousedown}}}),le=n("d438");const ae=ne.__cssModules={};ae["$style"]=le["default"],ne.render=G;var re=ne,oe=n("95b2"),ie=n("44ab"),ce=n("7dfb");function se(e,t){for(let n=e.offset;n<e.offset+e.length;++n)t[n]=!0}function ue(e,t,n,l){const a=Math.min(t,n),r=Math.max(t,n);l=l.filter(e=>e.type.byteView&&!e.type.byteView.array);for(let o=a;o<=r;++o)l.some(e=>o>=e.offset&&o<e.offset+e.length)&&(e[o]=!e[o])}function de(e){e.fill(!1)}function be(e){const t=[];let n,l=e.indexOf(!0);if(l<0)return t;for(n=l,t.push([n]),l+=1;l<e.length;++l)if(e[l]){const e=l;e-n===1?t[t.length-1].push(e):t.push([e]),n=e}return t}const fe=()=>({byteView:{array:!1}});function he(e,t){for(let n=0;n<t.length;){const l=t[n];null!=l.name&&e.some(e=>e>=l.offset&&e<l.offset+l.length)?ye(l,t):n+=1}}function pe(e,t){const n=be(e);if(0===n.length)throw new Error("No bytes selected");if(n.length>1)throw new Error("Cannot create header from non-contiguous selection");const l=n[0];he(l,t);const a=t.find(e=>l[0]>=e.offset&&l[0]+l.length<=e.offset+e.length);let r=[{name:null,offset:a.offset,length:l[0]-a.offset,type:fe()},{name:"",offset:l[0],length:l.length,type:fe(),textLength:11},{name:null,offset:l[0]+l.length,length:a.length-(l[0]-a.offset+l.length),type:fe()}];const o=r[1];return r=r.filter(e=>e.length),t.splice(t.indexOf(a),1,...r),o}function ye(e,t){if(null==e.name)throw new Error("Cannot remove empty header");e.name=null,e.type=fe();for(let n=0;n<t.length-1;){const e=ve(t[n],t[n+1]);e?t.splice(n,2,e):n+=1}}function ve(e,t){return null===e.name&&null===t.name?{name:null,offset:e.offset,length:e.length+t.length,type:fe()}:null}var ge=n("3f4f"),me=n("38c7");const Oe=Object(ge["a"])("poe-dat-viewer",3,{upgrade(e){e.createObjectStore("dat-schemas",{keyPath:"name"})}});async function je(e){const t=await(await Oe).get("dat-schemas",e);return(null===t||void 0===t?void 0:t.headers)||Se(e)||[]}async function xe(e,t){await(await Oe).put("dat-schemas",{name:e,headers:we(t)})}function we(e){return e.map(e=>({...e,length:e.type.string||e.type.array||e.type.key||e.type.boolean||e.type.decimal||e.type.integer?void 0:e.length}))}function Se(e){const t=me["schema"].find(t=>t.name===e);return!t||t.enum?null:t.columns.map(t=>({name:t.name,type:{array:t.array,integer:"uint8"===t.type?{unsigned:!0,size:1}:"uint16"===t.type?{unsigned:!0,size:2}:"uint32"===t.type?{unsigned:!0,size:4}:"uint64"===t.type?{unsigned:!0,size:8}:"int8"===t.type?{unsigned:!1,size:1}:"int16"===t.type?{unsigned:!1,size:2}:"int32"===t.type?{unsigned:!1,size:4}:"int64"===t.type?{unsigned:!1,size:8}:"enum0"===t.type||"enum1"===t.type?{unsigned:!0,size:4}:void 0,decimal:"float32"===t.type?{size:4}:"float64"===t.type?{size:8}:void 0,string:"string"===t.type?{}:void 0,boolean:"bool"===t.type?{}:void 0,key:"rowidx"===t.type?{foreign:!!t.references&&t.references.table!==e}:void 0},textLength:11}))}function ke(e,t){const n=Object(oe["readDatFile"])(e,t),a={headers:Object(l["w"])(n.rowLength?[{name:null,offset:0,length:n.rowLength,type:fe()}]:[]),datFile:n,name:Me(e),columnStats:Object(l["w"])([]),columnSelection:Object(l["w"])(new Array(n.rowLength).fill(!1)),editHeader:Object(l["w"])(null),rowSorting:Object(l["w"])(null),scrollPos:Object(l["v"])({x:0,y:0})};return L(a.datFile).then(async e=>{a.columnStats.value=e;const t=await je(a.name);try{ze(t,a)}catch(n){window.alert("WARN: "+n.message)}finally{Object(l["y"])(a.headers)}}),a}function ze(e,t){let n=0;for(const l of e){const e=l.length||Object(ce["getHeaderLength"])(l,t.datFile);if(null==l.name){n+=e;continue}const a={...l,length:e,offset:n},r=l.length?t.datFile.rowLength-a.offset>=a.length:Object(ie["validateHeader"])(a,t.columnStats.value,t.datFile);if(!r)throw new Error("The schema is invalid.");se(a,t.columnSelection.value);const o=pe(t.columnSelection.value,t.headers.value);Object.assign(o,a),de(t.columnSelection.value),n+=e}}function _e(e,t){const n=e.filter(({type:e})=>e.boolean||e.decimal||e.integer||e.key||e.string).map((e,n)=>({name:e.name||"Unknown"+(n+1),data:(()=>{var n;const l=Object(oe["readColumn"])(e,t);if(null===(n=e.type.key)||void 0===n?void 0:n.foreign){if(e.type.array){const e=l;if(!e.every(e=>e.every(e=>0===e.unknown)))throw new Error("never");return e.map(e=>e.map(e=>e.rid))}{const e=l;if(!e.every(e=>null==e||0===e.unknown))throw new Error("never");return e.map(e=>e&&e.rid)}}return l})()}));return n.unshift({name:"_rid",data:Array(t.rowCount).fill(void 0).map((e,t)=>t)}),Array(t.rowCount).fill(void 0).map((e,t)=>Object.fromEntries(n.map(e=>[e.name,e.data[t]])))}function Me(e){return e.match(/[^/]+(?=\..+$)/)[0]}function Ce(e){xe(e.name,e.headers.value)}const Te={class:"flex"},$e={key:0,class:"text-gray-500 italic px-1.5 self-center"},Pe=Object(l["g"])("i",{class:"codicon codicon-add"},null,-1),Ie=Object(l["f"])(" Define column"),Ee=Object(l["g"])("div",{class:"text-gray-400 px-1.5 mr-1 self-center"},"Selections",-1),Re={class:"flex space-x-1"};function Le(e,t,n,a,r,o){return Object(l["m"])(),Object(l["d"])("div",{class:e.$style.bar},[Object(l["g"])("div",Te,[0===e.selections.length?(Object(l["m"])(),Object(l["d"])("div",$e,"No bytes selected")):1===e.selections.length?(Object(l["m"])(),Object(l["d"])("button",{key:1,class:"hover:bg-gray-400 hover:text-black px-1.5",onClick:t[1]||(t[1]=(...t)=>e.defineColumn(...t))},[Pe,Ie])):e.selections.length>1?(Object(l["m"])(),Object(l["d"])(l["a"],{key:2},[Ee,(Object(l["m"])(!0),Object(l["d"])(l["a"],null,Object(l["r"])(e.selections,e=>(Object(l["m"])(),Object(l["d"])("div",{class:"px-1.5 mr-1 font-mono bg-gray-300 text-black flex items-center",textContent:Object(l["x"])(e)},null,8,["textContent"]))),256))],64)):Object(l["e"])("",!0)]),Object(l["g"])("div",Re,[e.rowSorting?(Object(l["m"])(),Object(l["d"])("button",{key:0,class:"bg-gray-700 hover:bg-gray-400 hover:text-black px-1.5 border border-gray-600",onClick:t[2]||(t[2]=t=>e.rowSorting=null)},"Reset sorting")):Object(l["e"])("",!0),Object(l["g"])("button",{class:"hover:bg-gray-400 hover:text-black px-1.5",onClick:t[3]||(t[3]=(...t)=>e.exportDataJson(...t))},"Export data")])],2)}var Fe=n("21a6"),Ae=n.n(Fe),He=Object(l["h"])({setup(){const e=Object(l["i"])("viewer"),t=Object(l["b"])(()=>be(e.columnSelection.value).map(e=>e.map(e=>String(e)).join(" ")));function n(){const{editHeader:t,columnSelection:n,headers:a}=e;t.value=pe(n.value,a.value),de(n.value),Object(l["y"])(a),Object(l["y"])(n),Ce(e)}function a(){const t=_e(e.headers.value,e.datFile);Ae.a.saveAs(new File([JSON.stringify(t,null,2)],e.name+".json",{type:"application/json;charset=utf-8"}))}return{viewer:e,rowSorting:e.rowSorting,selections:t,defineColumn:n,exportDataJson:a}}}),Ve=n("8352");const De=He.__cssModules={};De["$style"]=Ve["default"],He.render=Le;var Be=He;const Ne={class:"datv-header-layer"},We=Object(l["f"])("Â "),Ye={key:1,class:"bg-gray-600 text-gray-300 px-1"},qe={key:0,class:"datv-stat__line bg-yellow-600",style:{top:"0"}},Ge={key:1,class:"datv-stat__line bg-teal-500",style:{top:"7px"}},Ue={key:2,class:"datv-stat__line bg-gray-900",style:{top:"14px"}},Xe={key:3,class:"datv-stat__line bg-pink-500",style:{top:"14px"}};function Ke(e,t,n,a,r,o){return Object(l["m"])(),Object(l["d"])("div",Ne,[Object(l["g"])("div",{style:e.headersRowStyle,class:"absolute"},[(Object(l["m"])(!0),Object(l["d"])(l["a"],null,Object(l["r"])(e.headers,t=>(Object(l["m"])(),Object(l["d"])("button",{key:t.offset,class:["datv-header",{"datv-col--border":t.border}],style:{width:t.widthPx+"px",transform:`translate(${t.leftPx}px, 0)`},title:t.name,onClick:n=>e.editHeader(t.offset),onWheel:n=>e.handleHeaderWheel(t.offset,n)},[null===t.name?(Object(l["m"])(),Object(l["d"])(l["a"],{key:0},[We],64)):""===t.name?(Object(l["m"])(),Object(l["d"])("span",Ye,"?")):(Object(l["m"])(),Object(l["d"])(l["a"],{key:2},[Object(l["f"])(Object(l["x"])(t.name),1)],64))],46,["title","onClick","onWheel"]))),128))],4),Object(l["g"])("div",{style:e.colsRowStyle,class:"absolute"},[(Object(l["m"])(!0),Object(l["d"])(l["a"],null,Object(l["r"])(e.columns,t=>(Object(l["m"])(),Object(l["d"])("button",{key:t.offset,class:["datv-byte",{"datv-col--border":t.border,"datv-byte--selected":t.selected}],style:{width:t.widthPx+"px",transform:`translate(${t.leftPx}px, 0)`},onMousedown:n=>e.selectStart(t.offset),onMouseenter:n=>e.selectContinue(t.offset,n),title:t.offset,textContent:Object(l["x"])(t.text)},null,46,["onMousedown","onMouseenter","title","textContent"]))),128))],4),Object(l["g"])("div",{style:e.statsRowStyle,class:"absolute datv-stats_row"},[(Object(l["m"])(!0),Object(l["d"])(l["a"],null,Object(l["r"])(e.columns,e=>(Object(l["m"])(),Object(l["d"])("div",{key:e.offset,class:["datv-stat",{"datv-col--border":e.border,"datv-byte--selected":e.selected}],style:{width:e.widthPx+"px",transform:`translate(${e.leftPx}px, 0)`}},[e.stat?(Object(l["m"])(),Object(l["d"])(l["a"],{key:0},[e.stat.string?(Object(l["m"])(),Object(l["d"])("div",qe)):Object(l["e"])("",!0),e.stat.array?(Object(l["m"])(),Object(l["d"])("div",Ge)):Object(l["e"])("",!0),e.stat.zero?(Object(l["m"])(),Object(l["d"])("div",Ue)):e.stat.nullable?(Object(l["m"])(),Object(l["d"])("div",Xe)):Object(l["e"])("",!0),Object(l["g"])("div",{class:"datv-stat__max",textContent:Object(l["x"])(e.stat.max)},null,8,["textContent"])],64)):Object(l["e"])("",!0)],6))),128))],4)])}function Je(e,t,n){const l=Object(oe["readColumn"])(e,n),a=Array.from({length:n.rowCount},(e,t)=>t);return e.type.array?a.sort((e,n)=>{const a=l[e],r=l[n];return(r.length-a.length)*t}):e.type.boolean?a.sort((e,n)=>{const a=Number(l[e]),r=Number(l[n]);return(a-r)*t}):e.type.string?a.sort((e,n)=>{const a=l[e],r=l[n];return a.localeCompare(r)*t}):e.type.integer||e.type.decimal?a.sort((e,n)=>{const a=l[e],r=l[n];return(r-a)*t}):e.type.key&&(e.type.key.foreign?a.sort((e,n)=>{const a=l[e],r=l[n];return(((null===r||void 0===r?void 0:r.rid)||0)-((null===a||void 0===a?void 0:a.rid)||0))*t}):a.sort((e,n)=>{const a=Number(l[e]),r=Number(l[n]);return(r-a)*t})),a}var Ze=n("f0db");function Qe(e,t){t.text=String(e),t.color="#098658"}function et(e,t){t.text=`[${e.join(", ")}]`,t.color="#098658"}function tt(e,t){t.text=String(e),t.color="#0000ff"}function nt(e,t){t.text=`[${e.join(", ")}]`,t.color="#0000ff"}function lt(e,t){""===e?(t.text="null",t.color="#0000ff"):(t.text=String(e),t.color="#001080")}function at(e,t){t.text=`[${e.map(e=>'"'+e+'"').join(", ")}]`,t.color="#001080"}function rt(e,t){null===e?(t.text="null",t.color="#0000ff"):(t.text=`<${e}, self>`,t.color="#098658")}function ot(e,t){t.text=`[${e.map(e=>`<${e}, self>`).join(", ")}]`,t.color="#098658"}function it(e,t){null===e?(t.text="null",t.color="#0000ff"):(t.text=`<${e.rid}, ${e.unknown}>`,t.color="#098658")}function ct(e,t){t.text=`[${e.map(e=>`<${e.rid}, ${e.unknown}>`).join(", ")}]`,t.color="#098658"}function st(e,t,n,l){const a=Object(Ze["getFieldReader"])(t,n),r={text:"",color:""},o=(()=>{if(t.type.array){if(t.type.boolean)return nt;if(t.type.string)return at;if(t.type.integer||t.type.decimal)return et;if(t.type.key&&t.type.key.foreign)return ct;if(t.type.key&&!t.type.key.foreign)return ot}else{if(t.type.boolean)return tt;if(t.type.string)return lt;if(t.type.integer||t.type.decimal)return Qe;if(t.type.key&&t.type.key.foreign)return it;if(t.type.key&&!t.type.key.foreign)return rt}throw new Error("never")})();let i=0,c="";for(const s of l)o(a(s),r),c!==r.color&&(e.fillStyle=r.color,c=r.color),e.fillText(r.text,0,i),i+=yt}function ut(e,t,n,l,a,r){e.fillStyle="#000";let o=0;for(const i of l){const l=n.dataFixed.subarray(i*n.rowLength+t.offset+a,i*n.rowLength+t.offset+r),c=Array.from(l,e=>e.toString(16).padStart(2,"0")).join(" ");e.fillText(c,a*(3*ht),o),o+=yt}}function dt(e,t,n,l,a){e.fillStyle="#000";const r=a.refArray,o=Math.max(r.keyForeign?n.fieldSize.KEY_FOREIGN:0,r.keySelf?n.fieldSize.KEY:0,r.string?n.fieldSize.STRING:0,r.longLong?n.fieldSize.LONGLONG:0,r.long?n.fieldSize.LONG:0,r.short?n.fieldSize.SHORT:0,n.fieldSize.BYTE),i=Math.ceil(t.textLength/3);let c=0;for(const s of l){const l=n.readerFixed.getSizeT(s*n.rowLength+t.offset);if(0===l)e.fillText("[]",0,c);else{const a=n.readerFixed.getSizeT(s*n.rowLength+t.offset+n.memsize),r=n.dataVariable.subarray(a,a+Math.min(o*l,i)),u=Array.from(r,e=>e.toString(16).padStart(2,"0")).join(" ");e.fillText(`${l} { ${u} }`,0,c)}c+=yt}}const bt='Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',ft=14,ht=kt(ft,bt),pt=zt(ft,bt),yt=19,vt=3,gt=1,mt=7,Ot=Math.round(3*ht),jt=2*Ot+3*mt;function xt(e){const t=String(e-1).length;return Math.max(t,vt)}function wt(e){return Math.ceil(xt(e)*ht)}function St(e){return wt(e)+16}function kt(e,t){const n=document.createElement("canvas"),l=n.getContext("2d");l.font=`${e}px ${t}`;const a=l.measureText("0");return a.width}function zt(e,t){const n=document.createElement("canvas"),l=n.getContext("2d");l.font=`${e}px ${t}`,l.textBaseline="middle";const a=l.measureText("0"),r=e/2+(void 0!==a.alphabeticBaseline?-a.alphabeticBaseline:a.actualBoundingBoxDescent);return r}function _t(e){return 1+(e-ft)/2+pt}function Mt(e){const{ctx:t}=e;t.fillStyle="#fff",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.save(),t.translate(-e.left,0),Ct(t,e.columns),t.restore(),t.font=`${ft}px ${bt}`,t.fillStyle="#000";const n=Tt(e.viewer,e.left,e.left+e.paintWidth);for(const l of n)t.save(),t.beginPath(),t.translate(l.left-e.left,0),t.rect(0,0,l.width,t.canvas.height),t.clip(),t.translate(ht/2,e.top+_t(yt)),l.exec(t,e.rows),t.restore()}function Ct(e,t){for(const n of t)n.selected&&(e.fillStyle="#bee3f8",e.fillRect(n.leftPx+(n.border?gt:0),0,n.widthPx,e.canvas.height)),n.border&&(e.fillStyle="#bdbdbd",e.fillRect(n.leftPx,0,gt,e.canvas.height))}function Tt(e,t,n){const l=e.headers.value,a=e.columnStats.value,r=e.datFile,o=[];let i=0;for(const c of l){const e=$t(c);if(i+e.borderWidth>=t)if(c.type.byteView)if(c.type.byteView.array)o.push({left:i+(e.borderWidth?gt:0),width:e.paddingWidth,exec:(e,t)=>dt(e,c,r,t,a[c.offset])});else{const l=Math.max(0,Math.floor((t-i)/(3*ht))),a=Math.min(c.length,Math.ceil((n-i)/(3*ht)));o.push({left:i+(e.borderWidth?gt:0),width:e.paddingWidth,exec:(e,t)=>ut(e,c,r,t,l,a)})}else o.push({left:i+(e.borderWidth?gt:0),width:e.paddingWidth,exec:(e,t)=>st(e,c,r,t)});if(i+=e.borderWidth,i>=n)return o}return o}function $t(e){const t=e.type.byteView&&!e.type.byteView.array?3*e.length-1:e.textLength;return{paddingWidth:Math.ceil((t+1)*ht),borderWidth:Math.ceil((t+1)*ht)+(e.offset>0?gt:0),hasBorder:e.offset>0}}function Pt(e){let t=0;for(const n of e){const e=$t(n);t+=e.borderWidth}return t}function It(e,t,n){const l=[];let a=0;for(const r of e){const e=$t(r);if(a+e.borderWidth>=t&&l.push({offset:r.offset,border:e.hasBorder,widthPx:e.borderWidth,leftPx:a,name:r.name}),a+=e.borderWidth,a>=n)return l}return l}var Et=Object(l["h"])({props:{left:{type:Number,required:!0},width:{type:Number,required:!0},columns:{type:Array,required:!0}},setup(e){const t=Object(l["w"])(0);let n=-1,a=[];const r=Object(l["i"])("viewer");function o(e){function t(){n=-1,document.removeEventListener("mouseup",t),document.removeEventListener("mouseleave",t)}n=e,a=[...r.columnSelection.value],ue(r.columnSelection.value,n,n,r.headers.value),Object(l["y"])(r.columnSelection),document.addEventListener("mouseup",t),document.addEventListener("mouseleave",t)}function i(e,t){if(-1===n||1!==t.buttons)return;const{memsize:l}=r.datFile,o=e-n;o>=l?e=n+2*l-1:o>=4?e=n+8-1:o>=2&&(e=n+4-1),o<=-l?e=n-2*l+1:o<=-4?e=n-8+1:o<=-2&&(e=n-4+1),r.columnSelection.value=[...a],ue(r.columnSelection.value,n,e,r.headers.value)}function c(e){const n=r.headers.value.find(t=>t.offset===e);r.editHeader.value!==n||n.type.byteView&&!n.type.byteView.array?(r.editHeader.value=n,t.value=0):(0===t.value?t.value=1:1===t.value?t.value=-1:-1===t.value&&(t.value=1),r.rowSorting.value=Je(n,t.value,r.datFile))}function s(e,t){t.preventDefault();const n=r.headers.value.find(t=>t.offset===e);null!=n.textLength&&(n.textLength=Math.max(1,n.textLength-Math.sign(t.deltaY)*(t.ctrlKey?10:1)),Object(l["y"])(r.headers),Ce(r))}const u=Object(l["b"])(()=>It(r.headers.value,e.left,e.left+e.width));return{headers:u,selectStart:o,selectContinue:i,editHeader:c,handleHeaderWheel:s,headersRowStyle:Object(l["b"])(()=>({transform:`translate(${-e.left}px, 0)`,lineHeight:Ot+"px",fontFamily:bt,fontSize:ft+"px"})),colsRowStyle:Object(l["b"])(()=>({transform:`translate(${-e.left}px, ${Ot}px)`,lineHeight:Ot+"px",fontFamily:bt,fontSize:ft+"px"})),statsRowStyle:Object(l["b"])(()=>({transform:`translate(${-e.left}px, ${2*Ot}px)`,fontFamily:bt,fontSize:ft+"px"}))}}});n("81b1");Et.render=Ke;var Rt=Et;const Lt={key:0,style:{width:"300px"},class:"relative overflow-hidden"},Ft={class:"m-2 shadow border border-gray-400 bg-white absolute inset-0 flex flex-col"},At={class:"p-2 bg-gray-200 text-gray-700 shadow flex justify-between items-baseline"},Ht=Object(l["g"])("span",{class:"px-2"},"Column properties",-1),Vt=Object(l["g"])("i",{class:"codicon codicon-close"},null,-1),Dt={key:0,class:"p-4"},Bt={key:1,class:"p-4 overflow-auto"},Nt={class:"mb-4"},Wt=Object(l["g"])("label",{for:"datv-header-name"},"Name",-1),Yt={class:"mb-4 flex items-baseline"},qt=Object(l["g"])("div",{class:"mr-2"},"View mode",-1),Gt={class:"space-x-px flex"},Ut={class:"mb-4"},Xt={class:"mb-2 flex justify-between items-baseline"},Kt=Object(l["g"])("span",null,"Data type",-1),Jt={class:"inline-flex items-center"},Zt={class:"ml-2 cursor-pointer"},Qt={key:0,class:"mt-3"},en=Object(l["g"])("div",{class:"mb-1"},"of ...",-1),tn={class:"inline-flex items-center"},nn={class:"ml-2 cursor-pointer"},ln={key:0,class:"mb-4"},an={class:"inline-flex items-center"},rn=Object(l["g"])("span",{class:"ml-2 cursor-pointer"},"Unsigned",-1),on={key:1,class:"mb-4 border-t pt-4"},cn=Object(l["g"])("label",{class:"mr-4"},"Width",-1),sn=Object(l["f"])(" chars ");function un(e,t,n,a,r,o){return e.isVisible?(Object(l["m"])(),Object(l["d"])("div",Lt,[Object(l["g"])("div",{style:{height:e.HEADERS_HEIGHT+"px"},class:"bg-gray-200"},null,4),Object(l["g"])("div",Ft,[Object(l["g"])("div",At,[Ht,Object(l["g"])("button",{onClick:t[1]||(t[1]=(...t)=>e.close(...t)),class:"px-2 py-1",title:"Close"},[Vt])]),null===e.header.name?(Object(l["m"])(),Object(l["d"])("div",Dt,[Object(l["g"])("div",null,Object(l["x"])(e.header.length)+" bytes of unidentified data",1)])):(Object(l["m"])(),Object(l["d"])("div",Bt,[Object(l["g"])("div",Nt,[Wt,Object(l["E"])(Object(l["g"])("input",{id:"datv-header-name",placeholder:"Unnamed","onUpdate:modelValue":t[2]||(t[2]=t=>e.header.name=t),class:"border p-1 mt-1 w-full focus:border-blue-500",spellcheck:"false"},null,512),[[l["B"],e.header.name,void 0,{trim:!0}]])]),Object(l["g"])("div",Yt,[qt,Object(l["g"])("div",Gt,[(Object(l["m"])(!0),Object(l["d"])(l["a"],null,Object(l["r"])(e.viewModeOpts,t=>(Object(l["m"])(),Object(l["d"])("button",{key:t.value,class:["px-2",e.byteViewMode===t.value?"bg-blue-500 text-white":"bg-gray-200 hover:bg-gray-400"],onClick:n=>e.byteViewMode=t.value,disabled:t.disabled,textContent:Object(l["x"])(t.label)},null,10,["onClick","disabled","textContent"]))),128))])]),Object(l["g"])("div",Ut,[Object(l["g"])("div",Xt,[Kt,Object(l["g"])("button",{class:"text-red-700 bg-red-100 px-2",onClick:t[3]||(t[3]=(...t)=>e.remove(...t))},"Delete")]),Object(l["g"])("div",null,[(Object(l["m"])(!0),Object(l["d"])(l["a"],null,Object(l["r"])(e.dataTypeOpts,n=>(Object(l["m"])(),Object(l["d"])("div",{key:n.value,class:"mb-0.5"},[Object(l["g"])("label",Jt,[Object(l["E"])(Object(l["g"])("input",{type:"radio","onUpdate:modelValue":t[4]||(t[4]=t=>e.dataType=t),value:n.value},null,8,["value"]),[[l["A"],e.dataType]]),Object(l["g"])("span",Zt,Object(l["x"])(n.label),1)])]))),128)),e.arrayTypeOpts.length?(Object(l["m"])(),Object(l["d"])("div",Qt,[en,(Object(l["m"])(!0),Object(l["d"])(l["a"],null,Object(l["r"])(e.arrayTypeOpts,n=>(Object(l["m"])(),Object(l["d"])("div",{key:n.value,class:"mb-0.5"},[Object(l["g"])("label",tn,[Object(l["E"])(Object(l["g"])("input",{type:"radio","onUpdate:modelValue":t[5]||(t[5]=t=>e.arrayType=t),value:n.value},null,8,["value"]),[[l["A"],e.arrayType]]),Object(l["g"])("span",nn,Object(l["x"])(n.label),1)])]))),128))])):Object(l["e"])("",!0)])]),e.header.type.integer?(Object(l["m"])(),Object(l["d"])("div",ln,[Object(l["g"])("label",an,[Object(l["E"])(Object(l["g"])("input",{type:"checkbox","onUpdate:modelValue":t[6]||(t[6]=t=>e.header.type.integer.unsigned=t)},null,512),[[l["z"],e.header.type.integer.unsigned]]),rn])])):Object(l["e"])("",!0),e.dataType?(Object(l["m"])(),Object(l["d"])("div",on,[cn,Object(l["E"])(Object(l["g"])("input",{"onUpdate:modelValue":t[7]||(t[7]=t=>e.header.textLength=t),class:"border w-16 text-center"},null,512),[[l["B"],e.header.textLength,void 0,{number:!0}]]),sn])):Object(l["e"])("",!0)]))])])):Object(l["e"])("",!0)}function dn(e,t,n){const l=[],{fieldSize:a}=n,r=e.length;return r===a.ARRAY&&t.refArray&&l.push({label:"Array",value:"array"}),r===a.STRING&&t.refString&&l.push({label:"String",value:"string"}),r===a.KEY&&t.keySelf&&l.push({label:"Key (self)",value:"key_self"}),r===a.KEY_FOREIGN&&l.push({label:"Key (foreign)",value:"key_foreign"}),8!==r&&4!==r&&2!==r&&1!==r||l.push({label:"Integer",value:"integer"}),8!==r&&4!==r||l.push({label:"Decimal",value:"decimal"}),1===r&&t.bMax<=1&&l.push({label:"Boolean",value:"boolean"}),l}function bn(e,t){const n=[];if(!e.type.array||!t.refArray)return n;const l=t.refArray;return l.string&&n.push({label:"String",value:"string"}),l.keySelf&&n.push({label:"Key (self)",value:"key_self"}),l.keyForeign&&n.push({label:"Key (foreign)",value:"key_foreign"}),l.longLong&&n.push({label:"Integer - 8 bytes",value:"integer_8"}),l.long&&n.push({label:"Integer - 4 bytes",value:"integer_4"}),l.short&&n.push({label:"Integer - 2 bytes",value:"integer_2"}),l.longLong&&n.push({label:"Decimal - 8 bytes",value:"decimal_8"}),l.long&&n.push({label:"Decimal - 4 bytes",value:"decimal_4"}),l.boolean&&n.push({label:"Boolean",value:"boolean"}),n.push({label:"Integer - byte",value:"integer_1"}),n}var fn=Object(l["h"])({setup(){const e=Object(l["i"])("viewer"),t=Object(l["b"])(()=>e.editHeader.value&&Object(l["o"])(e.editHeader.value));{let n=null;Object(l["C"])(t,t=>{n&&(n(),n=null),t&&(n=Object(l["C"])(t,()=>{Object(l["y"])(e.headers),Ce(e)},{deep:!0}))})}const n=Object(l["b"])(()=>e.columnStats.value[t.value.offset]),a=Object(l["b"])({get(){const e=t.value.type;return e.array?"array":e.string?"string":e.key?e.key.foreign?"key_foreign":"key_self":e.integer?"integer":e.decimal?"decimal":e.boolean?"boolean":void 0},set(e){const n=t.value;n.type={},"array"===e?(n.type.array=!0,n.type.byteView={array:!0}):"string"===e?n.type.string={}:"key_foreign"===e?n.type.key={foreign:!0}:"key_self"===e?n.type.key={foreign:!1}:"integer"===e?n.type.integer={unsigned:!0,size:n.length}:"decimal"===e?n.type.decimal={size:n.length}:"boolean"===e&&(n.type.boolean={})}}),r=Object(l["b"])({get(){const e=t.value.type;return e.string?"string":e.key?e.key.foreign?"key_foreign":"key_self":e.integer?"integer_"+e.integer.size:e.decimal?"decimal_"+e.decimal.size:e.boolean?"boolean":void 0},set(e){const n=t.value;n.type={array:!0},"string"===e?n.type.string={}:"key_foreign"===e?n.type.key={foreign:!0}:"key_self"===e?n.type.key={foreign:!1}:"integer_1"===e?n.type.integer={unsigned:!0,size:1}:"integer_2"===e?n.type.integer={unsigned:!0,size:2}:"integer_4"===e?n.type.integer={unsigned:!0,size:4}:"integer_8"===e?n.type.integer={unsigned:!0,size:8}:"decimal_4"===e?n.type.decimal={size:4}:"decimal_8"===e?n.type.decimal={size:8}:"boolean"===e&&(n.type.boolean={})}}),o=Object(l["b"])(()=>{const e=[],n=t.value.type;return e.push({label:"Bytes",value:"bytes"}),n.array&&e.push({label:"Var. bytes",value:"array-bytes"}),e.push({label:"Data",value:"data",disabled:!a.value||"array"===a.value&&!r.value}),e}),i=Object(l["b"])({get(){const e=t.value.type;return e.byteView?e.byteView.array?"array-bytes":"bytes":"data"},set(e){const n=t.value.type;n.byteView="data"===e?void 0:{array:"array-bytes"===e}}});function c(){e.editHeader.value=null}function s(){ye(t.value,e.headers.value),e.editHeader.value=null,Object(l["y"])(e.headers),Ce(e)}return{isVisible:Object(l["b"])(()=>null!=e.editHeader.value),HEADERS_HEIGHT:jt,header:t,byteViewMode:i,dataType:a,arrayType:r,close:c,remove:s,viewModeOpts:o,dataTypeOpts:Object(l["b"])(()=>dn(t.value,n.value,e.datFile)),arrayTypeOpts:Object(l["b"])(()=>bn(t.value,n.value))}}});fn.render=un;var hn=fn;const pn=Math.ceil(3*ht);function yn(e,t,n,l,a){const r=[];let o=0;for(const i of n){const n=$t(i);if(i.type.byteView&&!i.type.byteView.array){let c=o;for(let o=0;o<i.length;++o){const s=n.hasBorder&&0===o,u=3*ht+(s?gt:0);if(Math.ceil(c)+u<l){c+=u;continue}const d=i.offset+o;if(r.push({offset:d,selected:e[d],border:s,widthPx:pn,leftPx:Math.ceil(c),text:String(d%100).padStart(2,"0"),stat:t[d]}),c+=u,Math.ceil(c)>=a)return r}}else o+n.borderWidth>=l&&r.push({offset:i.offset,selected:!1,border:n.hasBorder,widthPx:n.paddingWidth,leftPx:o,text:String(i.offset%100).padStart(2,"0")});if(o+=n.borderWidth,o>=a)return r}return r}function vn(e,t){const n=e.map(e=>({max:e.bMax.toString(16).padStart(2,"0"),array:!1,string:!1,nullable:!1,zero:0===e.bMax})),{fieldSize:l}=t;for(let a=0;a<e.length;++a){const r=e[a];if(r.refString)for(let e=0;e<l.STRING;++e)n[a+e].string=!0;if(r.refArray)for(let e=0;e<l.ARRAY;++e)n[a+e].array=!0;if(r.nullableMemsize)for(let e=0;e<t.memsize;++e)n[a+e].nullable=!0}return n}var gn=Object(l["h"])({components:{ResizeObserver:q,CanvasScroll:re,ViewerActions:Be,ViewerHead:Rt,HeaderProps:hn},emits:["update:kaState"],props:{args:{type:Object,required:!0},kaState:{type:Object,default:void 0}},setup(e,t){let n;e.kaState?n=e.kaState:(n=ke(e.args.fullPath,e.args.fileContent),t.emit("update:kaState",n)),Object(l["n"])("viewer",n);const a=Object(l["q"])(null),r=Object(l["q"])(null);Object(l["l"])(()=>{r.value.scrollTo(n.scrollPos.x,n.scrollPos.y)});const o=Object(l["b"])(()=>n.rowSorting.value?n.rowSorting.value:Array.from({length:n.datFile.rowCount},(e,t)=>t)),i=Object(l["q"])(0),c=Object(l["q"])(0);function s(e){i.value=e.width,c.value=e.height}const{scrollPos:u}=n;function d(e){u.x=e.x,u.y=e.y}const b=Object(l["b"])(()=>Pt(n.headers.value)),f=Object(l["b"])(()=>n.datFile.rowCount*yt),h=Object(l["b"])(()=>St(n.datFile.rowCount)),p=Object(l["b"])(()=>Math.max(0,i.value-h.value)),y=Object(l["b"])(()=>Math.max(0,c.value-jt));Object(l["C"])([p,y],()=>{const e=devicePixelRatio;a.value.style.width=p.value+"px",a.value.style.height=y.value+"px",a.value.width=p.value*e,a.value.height=y.value*e;const t=a.value.getContext("2d",{alpha:!1});t.scale(e,e),m()});const v=Object(l["b"])(()=>vn(n.columnStats.value,n.datFile)),g=Object(l["b"])(()=>yn(n.columnSelection.value,v.value,n.headers.value,u.x,u.x+Math.min(b.value,p.value)));function m(){const e=a.value.getContext("2d",{alpha:!1});Mt({left:u.x,paintWidth:p.value,top:O.value.top,rows:O.value.ids,columns:g.value,viewer:n,ctx:e})}Object(l["C"])([u,g,o],()=>{m()});const O=Object(l["b"])(()=>{const e=u.y,t=Math.ceil(y.value/yt)+1,n=Math.floor(e/yt),l=n*yt-e;return{top:l,ids:o.value.slice(n,n+t)}});return{headerBlockStyle:Object(l["b"])(()=>({height:jt+"px",width:i.value+"px"})),headerOverlayContentStyle:Object(l["b"])(()=>({left:h.value+"px",height:jt+"px",width:p.value+"px"})),scrollableStyle:Object(l["b"])(()=>({top:jt+"px",left:h.value+"px"})),scrollablePaintSize:Object(l["b"])(()=>({width:p.value,height:y.value})),scrollableFullSize:Object(l["b"])(()=>({width:b.value,height:f.value})),rowsOverlayStyle:Object(l["b"])(()=>({top:jt+"px",width:h.value+"px",height:y.value+"px",fontFamily:bt,fontSize:ft+"px",lineHeight:yt+"px"})),handleScroll:d,handleResize:s,renderItems:O,canvasRef:a,renderColumns:g,scrollLeft:Object(l["b"])(()=>u.x),rowsWidth:Object(l["b"])(()=>Math.min(b.value,p.value)),LINE_HEIGHT:yt,canvasScroll:r,rowsNumberWidth:wt(n.datFile.rowCount)+"px"}}}),mn=n("cfcf");const On=gn.__cssModules={};On["$style"]=mn["default"],gn.render=N;var jn=gn,xn=Object(l["h"])({setup(){const e=Object(l["q"])(localStorage.getItem("POE_PATCH_VER")||""),t=Object(l["q"])(!1);async function n(e){const t=e.target.files[0],n=new Uint8Array(await t.arrayBuffer()),l=t.name;Cn({id:"file@"+l,title:l,type:jn,args:{fileContent:n,fullPath:l}})}async function a(){let n;try{t.value=!0,n=await C(e.value,"_.index.bin")}finally{t.value=!1}try{await V(n),localStorage.setItem("POE_PATCH_VER",e.value)}catch(l){throw window.alert(l.message),l}}return e.value&&!A.value&&a(),{poePatch:e,isCdnImportRunning:t,handleFile:n,cdnImport:a}}}),wn=n("d70b");const Sn=xn.__cssModules={};Sn["$style"]=wn["default"],xn.render=z;var kn=xn;const zn=Object(l["w"])("poe-dat-viewer@import");function _n(e){zn.value=e}const Mn=Object(l["w"])([{id:"poe-dat-viewer@import",title:"Import",type:kn,args:void 0,kaState:void 0}]);function Cn(e){const t=Mn.value.find(t=>t.id===e.id);t||Mn.value.push({id:e.id,title:e.title,type:e.type,args:e.args,kaState:void 0}),_n(e.id),Object(l["y"])(Mn)}function Tn(e){const t=Mn.value.findIndex(t=>t.id===e);e===zn.value&&(t+1<Mn.value.length?_n(Mn.value[t+1].id):_n(0!==t?Mn.value[t-1].id:null)),Mn.value=Mn.value.filter(t=>t.id!==e)}var $n=Object(l["h"])({setup(){const e=Object(l["b"])(()=>Mn.value.map(e=>({id:e.id,title:e.title,isActive:e.id===zn.value})));function t(){Cn({id:"poe-dat-viewer@import",title:"Import",type:kn,args:void 0})}return{tabs:e,setActiveTab:_n,closeTab:Tn,openImport:t}}}),Pn=n("772a");const In=$n.__cssModules={};In["$style"]=Pn["default"],$n.render=g;var En=$n;const Rn={class:"flex p-1 items-center mb-px"},Ln=Object(l["g"])("i",{class:"codicon codicon-list-flat"},null,-1),Fn={key:0,class:"flex gap-x-1 border-b pb-1.5 px-2 justify-end"},An={key:1,class:"italic text-center text-gray-600 p-2"},Hn={key:2,class:"italic text-center text-gray-600 p-2"},Vn={key:0,class:"codicon codicon-folder pr-3"};function Dn(e,t,n,a,r,o){const i=Object(l["t"])("virtual-scroll");return Object(l["m"])(),Object(l["d"])("div",{class:"layout-column flex-shrink-0",style:{width:e.showTree?"300px":void 0}},[Object(l["g"])("div",Rn,[Object(l["g"])("button",{title:"Toggle tree visibility",class:e.$style.treeToggle,onClick:t[1]||(t[1]=(...t)=>e.toggleTree(...t))},[Ln],2),e.showTree?Object(l["E"])((Object(l["m"])(),Object(l["d"])("input",{key:0,"onUpdate:modelValue":t[2]||(t[2]=t=>e.searchText=t),placeholder:"Search in current folder",class:e.$style.searchInput,type:"search",spellcheck:"false"},null,2)),[[l["B"],e.searchText,void 0,{trim:!0}]]):Object(l["e"])("",!0)]),e.showTree?(Object(l["m"])(),Object(l["d"])(l["a"],{key:0},[e.extensionOpts?(Object(l["m"])(),Object(l["d"])("div",Fn,[(Object(l["m"])(!0),Object(l["d"])(l["a"],null,Object(l["r"])(e.extensionOpts,e=>(Object(l["m"])(),Object(l["d"])("button",{key:e.value,onClick:e.handleClick,class:["px-2",e.active?"bg-gray-300":"hover:bg-gray-200"],textContent:Object(l["x"])(e.value)},null,10,["onClick","textContent"]))),128))])):Object(l["e"])("",!0),e.isIndexLoaded?Object(l["e"])("",!0):(Object(l["m"])(),Object(l["d"])("div",An,"Waiting for Index bundle...")),e.isIndexLoaded&&!e.tree.length?(Object(l["m"])(),Object(l["d"])("div",Hn,"No results found")):Object(l["e"])("",!0),Object(l["g"])(i,{class:"flex-1","scrollable-props":{style:"background: #fff;",widthY:10},items:e.tree,"item-height":22},{default:Object(l["D"])(t=>[(Object(l["m"])(!0),Object(l["d"])(l["a"],null,Object(l["r"])(t.entries,t=>(Object(l["m"])(),Object(l["d"])("button",{key:t.item.fullPath,class:e.$style.itemBtn,style:{transform:`translate(0, ${t.top}px`},onClick:n=>e.handleTreeNav(t.item)},[t.item.isFile?Object(l["e"])("",!0):(Object(l["m"])(),Object(l["d"])("i",Vn)),Object(l["f"])(Object(l["x"])(t.item.label),1)],14,["onClick"]))),128))]),_:1},8,["items"])],64)):Object(l["e"])("",!0)],4)}function Bn(e,t,n,a,r,o){const i=Object(l["t"])("canvas-scroll"),c=Object(l["t"])("resize-observer");return Object(l["m"])(),Object(l["d"])(c,{onResize:e.handleResize,class:"relative"},{default:Object(l["D"])(()=>[Object(l["g"])(i,Object(l["j"])({ref:"scrollable"},e.scrollableProps,{class:"absolute","paint-size":e.paintSize,"full-size":e.fullSize}),{default:Object(l["D"])(()=>[Object(l["s"])(e.$slots,"default",{entries:e.renderItems})]),_:3},16,["paint-size","full-size"])]),_:1},8,["onResize"])}var Nn=Object(l["h"])({components:{ResizeObserver:q,CanvasScroll:re},props:{items:{type:Array,required:!0},itemHeight:{type:Number,required:!0},scrollableProps:{type:Object,default:()=>({})}},setup(e){const t=Object(l["v"])({width:0,height:0}),n=Object(l["b"])(()=>({width:t.width,height:e.items.length*e.itemHeight}));function a(e){t.width=e.width,t.height=e.height}const r=Object(l["q"])(null),o=Object(l["b"])(()=>{var n,l;const a=null!==(l=null===(n=r.value)||void 0===n?void 0:n.scrollPos.y)&&void 0!==l?l:0,o=Math.ceil(t.height/e.itemHeight)+1,i=Math.floor(a/e.itemHeight),c=i*e.itemHeight-a;return e.items.slice(i,i+o).map((t,n)=>({top:c+n*e.itemHeight,item:t}))});return{handleResize:a,paintSize:t,fullSize:n,scrollable:r,renderItems:o}}});Nn.render=Bn;var Wn=Nn,Yn=n("f4ae");function qn(){return Date.now()}function Gn(e,t){const n=Date.now()-t;console.log(`${e}. Done in -> ${n} ms`)}function Un(e,t){const n=qn(),l=t();return Gn(e,n),l}function Xn(){const e=Object(l["w"])("");Object(l["C"])(A,()=>{e.value=""});const t=Object(l["b"])(()=>{if(!A.value)return[];if(""===e.value){const e=Un("Getting root dirs",()=>Object(Yn["getRootDirs"])(A.value.pathReps,A.value.dirsInfo));return e.map(e=>({label:e,fullPath:e,isFile:!1})).sort((e,t)=>e.label.localeCompare(t.label))}const t=Un(`Getting "${e.value}" dir`,()=>Object(Yn["getDirContent"])(e.value,A.value.pathReps,A.value.dirsInfo));return[{label:"../",fullPath:-1===e.value.indexOf("/")?"":e.value.split("/").slice(0,-1).join("/"),isFile:!1},...t.dirs.map(t=>({label:t.substr(e.value.length+1),fullPath:t,isFile:!1})).sort((e,t)=>e.label.localeCompare(t.label)),...t.files.map(t=>({label:t.substr(e.value.length+1),fullPath:t,isFile:!0})).sort((e,t)=>e.label.localeCompare(t.label))]});async function n(t){if(t.isFile){const e=await H(t.fullPath);t.fullPath.endsWith(".dat")||t.fullPath.endsWith(".dat64")?Cn({id:"bundles@"+t.fullPath,title:t.label,type:jn,args:{fileContent:e,fullPath:t.fullPath}}):Ae.a.saveAs(new File([e],t.fullPath.substring(t.fullPath.lastIndexOf("/")+1),{type:"application/octet-stream"}))}else e.value=t.fullPath}return{currentDir:e,tree:t,handleTreeNav:n}}var Kn=Object(l["h"])({components:{VirtualScroll:Wn},setup(){const e=Object(l["w"])(!0);function t(){e.value=!e.value}const n=Object(l["b"])(()=>Boolean(A.value)),{tree:a,handleTreeNav:r,currentDir:o}=Xn(),i=Object(l["w"])(".dat64"),c=Object(l["b"])(()=>o.value.startsWith("Data")?[".dat",".dat64",".datl",".datl64"].map(e=>({value:e,active:i.value===e,handleClick:()=>{i.value=e}})):null),s=Object(l["w"])(""),u=Object(l["b"])(()=>{const e=s.value.toLowerCase(),t=c.value?i.value:"";return a.value.filter(n=>n.label.toLowerCase().includes(e)&&(!n.isFile||n.label.endsWith(t)))});return{showTree:e,toggleTree:t,tree:u,handleTreeNav:r,searchText:s,isIndexLoaded:n,extensionOpts:c}}}),Jn=n("1189");const Zn=Kn.__cssModules={};Zn["$style"]=Jn["default"],Kn.render=Dn;var Qn=Kn;const el=Object(l["g"])("div",{class:"bg-gray-300 h-1"},null,-1),tl={class:"p-3"},nl={class:"font-semibold truncate"},ll={class:"text-grey text-sm"},al=Object(l["f"])("Downloading...");function rl(e,t,n,a,r,o){return e.active?(Object(l["m"])(),Object(l["d"])("div",{key:0,class:e.$style.notification},[e.totalSize?(Object(l["m"])(),Object(l["d"])(l["a"],{key:0},[el,Object(l["g"])("div",{class:"bg-blue-500 h-1 absolute top-0",style:{width:e.received/e.totalSize*100+"%"}},null,4)],64)):Object(l["e"])("",!0),Object(l["g"])("div",tl,[Object(l["g"])("div",nl,Object(l["x"])(e.bundleName),1),Object(l["g"])("div",ll,[e.totalSize?(Object(l["m"])(),Object(l["d"])(l["a"],{key:0},[Object(l["f"])(Object(l["x"])((e.totalSize/1e6).toFixed(1))+" MB",1)],64)):(Object(l["m"])(),Object(l["d"])(l["a"],{key:1},[al],64))])])],2)):Object(l["e"])("",!0)}var ol=Object(l["h"])({setup(){return M}}),il=n("81ee");const cl=ol.__cssModules={};cl["$style"]=il["default"],ol.render=rl;var sl=ol,ul=Object(l["h"])({components:{IndexTree:Qn,ViewerTabs:En,DownloadProgress:sl},setup(){const e=Object(l["b"])(()=>Mn.value.find(e=>e.id===zn.value));return{activeTab:e,appVersion:"3.0.0-beta"}}});n("54fc");ul.render=b;var dl=ul;Object(l["c"])(dl).mount("#app")},cfcf:function(e,t,n){"use strict";var l=n("1956"),a=n.n(l);n.d(t,"default",(function(){return a.a}))},d438:function(e,t,n){"use strict";var l=n("1735"),a=n.n(l);n.d(t,"default",(function(){return a.a}))},d70b:function(e,t,n){"use strict";var l=n("f17d"),a=n.n(l);n.d(t,"default",(function(){return a.a}))},e21f:function(e,t,n){},f17d:function(e,t,n){e.exports={input:"ImportDialog_input_BOtpT",label:"ImportDialog_label_2ZOy1"}}});
//# sourceMappingURL=app.fd0712ef.js.map